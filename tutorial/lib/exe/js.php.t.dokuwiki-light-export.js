var DOKU_BASE='/';var DOKU_TPL='/lib/tpl/dokuwiki-light-export/';var DOKU_COOKIE_PARAM={"path":"\/","secure":true};var DOKU_UHN=0;var DOKU_UHC=0;LANG={"willexpire":"Your lock for editing this page is about to expire in a minute.\\nTo avoid conflicts use the preview button to reset the locktimer.","notsavedyet":"Unsaved changes will be lost.","searchmedia":"Search for files","keepopen":"Keep window open on selection","hidedetails":"Hide Details","mediatitle":"Link settings","mediadisplay":"Link type","mediaalign":"Alignment","mediasize":"Image size","mediatarget":"Link target","mediaclose":"Close","mediainsert":"Insert","mediadisplayimg":"Show the image.","mediadisplaylnk":"Show only the link.","mediasmall":"Small version","mediamedium":"Medium version","medialarge":"Large version","mediaoriginal":"Original version","medialnk":"Link to detail page","mediadirect":"Direct link to original","medianolnk":"No link","medianolink":"Do not link the image","medialeft":"Align the image on the left.","mediaright":"Align the image on the right.","mediacenter":"Align the image in the middle.","medianoalign":"Use no align.","nosmblinks":"Linking to Windows shares only works in Microsoft Internet Explorer.\\nYou still can copy and paste the link.","linkwiz":"Link Wizard","linkto":"Link to:","del_confirm":"Really delete selected item(s)?","restore_confirm":"Really restore this version?","media_diff":"View differences:","media_diff_both":"Side by Side","media_diff_opacity":"Shine-through","media_diff_portions":"Swipe","media_select":"Select files\u2026","media_upload_btn":"Upload","media_done_btn":"Done","media_drop":"Drop files here to upload","media_cancel":"remove","media_overwrt":"Overwrite existing files","plugins":{"styling":{"loader":"Preview is loading...<br \/>if this does not goes away, your values may be faulty","popup":"Open as a popup"},"move":{"rename":"Rename","cancel":"Cancel","newname":"New name:","inprogress":"renaming page and adjusting links...","complete":"Move operation finished.","renameitem":"Rename this item","add":"Create a new namespace","duplicate":"Sorry, \"%s\" already exists in this namespace."},"extension":{"reallydel":"Really uninstall this extension?","display_viewoptions":"View Options:","display_enabled":"enabled","display_disabled":"disabled","display_updatable":"updatable"}}};var toolbar=[];(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else{factory(jQuery);}}(function($){var pluses=/\+/g;function raw(s){return s;}function decoded(s){return decodeURIComponent(s.replace(pluses,' '));}function converted(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');}try{return config.json?JSON.parse(s):s;}catch(er){}}var config=$.cookie=function(key,value,options){if(value!==undefined){options=$.extend({},config.defaults,options);if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days);}value=config.json?JSON.stringify(value):String(value);return(document.cookie=[config.raw?key:encodeURIComponent(key),'=',config.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}var decode=config.raw?raw:decoded;var cookies=document.cookie.split('; ');var result=key?undefined:{};for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split('=');var name=decode(parts.shift());var cookie=decode(parts.join('='));if(key&&key===name){result=converted(cookie);break;}if(!key){result[name]=converted(cookie);}}return result;};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)!==undefined){$.cookie(key,'',$.extend({},options,{expires:-1}));return true;}return false;};}));var qq=qq||{};qq.extend=function(first,second){for(var prop in second){first[prop]=second[prop];}};qq.indexOf=function(arr,elt,from){if(arr.indexOf)return arr.indexOf(elt,from);from=from||0;var len=arr.length;if(from<0)from+=len;for(;from<len;from++){if(from in arr&&arr[from]===elt){return from;}}return-1;};qq.getUniqueId=(function(){var id=0;return function(){return id++;};})();qq.attach=function(element,type,fn){if(element.addEventListener){element.addEventListener(type,fn,false);}else if(element.attachEvent){element.attachEvent('on'+type,fn);}};qq.detach=function(element,type,fn){if(element.removeEventListener){element.removeEventListener(type,fn,false);}else if(element.attachEvent){element.detachEvent('on'+type,fn);}};qq.preventDefault=function(e){if(e.preventDefault){e.preventDefault();}else{e.returnValue=false;}};qq.insertBefore=function(a,b){b.parentNode.insertBefore(a,b);};qq.remove=function(element){element.parentNode.removeChild(element);};qq.contains=function(parent,descendant){if(parent==descendant)return true;if(parent.contains){return parent.contains(descendant);}else{return!!(descendant.compareDocumentPosition(parent)&8);}};qq.toElement=(function(){var div=document.createElement('div');return function(html){div.innerHTML=html;var element=div.firstChild;div.removeChild(element);return element;};})();qq.css=function(element,styles){if(styles.opacity!=null){if(typeof element.style.opacity!='string'&&typeof(element.filters)!='undefined'){styles.filter='alpha(opacity='+Math.round(100*styles.opacity)+')';}}qq.extend(element.style,styles);};qq.hasClass=function(element,name){var re=new RegExp('(^| )'+name+'( |$)');return re.test(element.className);};qq.addClass=function(element,name){if(!qq.hasClass(element,name)){element.className+=' '+name;}};qq.removeClass=function(element,name){var re=new RegExp('(^| )'+name+'( |$)');element.className=element.className.replace(re,' ').replace(/^\s+|\s+$/g,"");};qq.setText=function(element,text){element.innerText=text;element.textContent=text;};qq.children=function(element){var children=[],child=element.firstChild;while(child){if(child.nodeType==1){children.push(child);}child=child.nextSibling;}return children;};qq.getByClass=function(element,className){if(element.querySelectorAll){return element.querySelectorAll('.'+className);}var result=[];var candidates=element.getElementsByTagName("*");var len=candidates.length;for(var i=0;i<len;i++){if(qq.hasClass(candidates[i],className)){result.push(candidates[i]);}}return result;};qq.obj2url=function(obj,temp,prefixDone){var uristrings=[],prefix='&',add=function(nextObj,i){var nextTemp=temp?(/\[\]$/.test(temp))?temp:temp+'['+i+']':i;if((nextTemp!='undefined')&&(i!='undefined')){uristrings.push((typeof nextObj==='object')?qq.obj2url(nextObj,nextTemp,true):(Object.prototype.toString.call(nextObj)==='[object Function]')?encodeURIComponent(nextTemp)+'='+encodeURIComponent(nextObj()):encodeURIComponent(nextTemp)+'='+encodeURIComponent(nextObj));}};if(!prefixDone&&temp){prefix=(/\?/.test(temp))?(/\?$/.test(temp))?'':'&':'?';uristrings.push(temp);uristrings.push(qq.obj2url(obj));}else if((Object.prototype.toString.call(obj)==='[object Array]')&&(typeof obj!='undefined')){for(var i=0,len=obj.length;i<len;++i){add(obj[i],i);}}else if((typeof obj!='undefined')&&(obj!==null)&&(typeof obj==="object")){for(var i in obj){if(obj.hasOwnProperty(i)&&typeof obj[i]!='function'){add(obj[i],i);}}}else{uristrings.push(encodeURIComponent(temp)+'='+encodeURIComponent(obj));}return uristrings.join(prefix).replace(/^&/,'').replace(/%20/g,'+');};var qq=qq||{};qq.FileUploaderBasic=function(o){this._options={debug:false,action:'/server/upload',params:{},button:null,multiple:true,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(id,fileName){},onProgress:function(id,fileName,loaded,total){},onComplete:function(id,fileName,responseJSON){},onCancel:function(id,fileName){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(message){alert(message);}};qq.extend(this._options,o);this._filesInProgress=0;this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button);}this._preventLeaveInProgress();};qq.FileUploaderBasic.prototype={setParams:function(params){this._options.params=params;},getInProgress:function(){return this._filesInProgress;},_createUploadButton:function(element){var self=this;return new qq.UploadButton({element:element,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(input){self._onInputChange(input);}});},_createUploadHandler:function(){var self=this,handlerClass;if(qq.UploadHandlerXhr.isSupported()){handlerClass='UploadHandlerXhr';}else{handlerClass='UploadHandlerForm';}var handler=new qq[handlerClass]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(id,fileName,loaded,total){self._onProgress(id,fileName,loaded,total);self._options.onProgress(id,fileName,loaded,total);},onComplete:function(id,fileName,result){self._onComplete(id,fileName,result);self._options.onComplete(id,fileName,result);},onCancel:function(id,fileName){self._onCancel(id,fileName);self._options.onCancel(id,fileName);}});return handler;},_preventLeaveInProgress:function(){var self=this;qq.attach(window,'beforeunload',function(e){if(!self._filesInProgress){return;}var e=e||window.event;e.returnValue=self._options.messages.onLeave;return self._options.messages.onLeave;});},_onSubmit:function(id,fileName){this._filesInProgress++;},_onProgress:function(id,fileName,loaded,total){},_onComplete:function(id,fileName,result){this._filesInProgress--;if(result.error){this._options.showMessage(result.error);}},_onCancel:function(id,fileName){this._filesInProgress--;},_onInputChange:function(input){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(input.files);}else{if(this._validateFile(input)){this._uploadFile(input);}}this._button.reset();},_uploadFileList:function(files){for(var i=0;i<files.length;i++){if(!this._validateFile(files[i])){return;}}for(var i=0;i<files.length;i++){this._uploadFile(files[i]);}},_uploadFile:function(fileContainer){var id=this._handler.add(fileContainer);var fileName=this._handler.getName(id);if(this._options.onSubmit(id,fileName)!==false){this._onSubmit(id,fileName);this._handler.upload(id,this._options.params);}},_validateFile:function(file){var name,size;if(file.value){name=file.value.replace(/.*(\/|\\)/,"");}else{name=file.fileName!=null?file.fileName:file.name;size=file.fileSize!=null?file.fileSize:file.size;}if(!this._isAllowedExtension(name)){this._error('typeError',name);return false;}else if(size===0){this._error('emptyError',name);return false;}else if(size&&this._options.sizeLimit&&size>this._options.sizeLimit){this._error('sizeError',name);return false;}else if(size&&size<this._options.minSizeLimit){this._error('minSizeError',name);return false;}return true;},_error:function(code,fileName){var message=this._options.messages[code];function r(name,replacement){message=message.replace(name,replacement);}r('{file}',this._formatFileName(fileName));r('{extensions}',this._options.allowedExtensions.join(', '));r('{sizeLimit}',this._formatSize(this._options.sizeLimit));r('{minSizeLimit}',this._formatSize(this._options.minSizeLimit));this._options.showMessage(message);},_formatFileName:function(name){if(name.length>33){name=name.slice(0,19)+'...'+name.slice(-13);}return name;},_isAllowedExtension:function(fileName){var ext=(-1!==fileName.indexOf('.'))?fileName.replace(/.*[.]/,'').toLowerCase():'';var allowed=this._options.allowedExtensions;if(!allowed.length){return true;}for(var i=0;i<allowed.length;i++){if(allowed[i].toLowerCase()==ext){return true;}}return false;},_formatSize:function(bytes){var i=-1;do{bytes=bytes/1024;i++;}while(bytes>99);return Math.max(bytes,0.1).toFixed(1)+['kB','MB','GB','TB','PB','EB'][i];}};qq.FileUploader=function(o){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader">'+'<div class="qq-upload-drop-area"><span>Drop files here to upload</span></div>'+'<div class="qq-upload-button">Upload a file</div>'+'<ul class="qq-upload-list"></ul>'+'</div>',fileTemplate:'<li>'+'<span class="qq-upload-file"></span>'+'<span class="qq-upload-spinner"></span>'+'<span class="qq-upload-size"></span>'+'<a class="qq-upload-cancel" href="#">Cancel</a>'+'<span class="qq-upload-failed-text">Failed</span>'+'</li>',classes:{button:'qq-upload-button',drop:'qq-upload-drop-area',dropActive:'qq-upload-drop-area-active',list:'qq-upload-list',file:'qq-upload-file',spinner:'qq-upload-spinner',size:'qq-upload-size',cancel:'qq-upload-cancel',success:'qq-upload-success',fail:'qq-upload-fail'}});qq.extend(this._options,o);this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,'list');this._classes=this._options.classes;this._button=this._createUploadButton(this._find(this._element,'button'));this._bindCancelEvent();this._setupDragDrop();};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{_find:function(parent,type){var element=qq.getByClass(parent,this._options.classes[type])[0];if(!element){throw new Error('element not found '+type);}return element;},_setupDragDrop:function(){var self=this,dropArea=this._find(this._element,'drop');var dz=new qq.UploadDropZone({element:dropArea,onEnter:function(e){qq.addClass(dropArea,self._classes.dropActive);e.stopPropagation();},onLeave:function(e){e.stopPropagation();},onLeaveNotDescendants:function(e){qq.removeClass(dropArea,self._classes.dropActive);},onDrop:function(e){dropArea.style.display='none';qq.removeClass(dropArea,self._classes.dropActive);self._uploadFileList(e.dataTransfer.files);}});dropArea.style.display='none';qq.attach(document,'dragenter',function(e){if(!dz._isValidFileDrag(e))return;dropArea.style.display='block';});qq.attach(document,'dragleave',function(e){if(!dz._isValidFileDrag(e))return;var relatedTarget=document.elementFromPoint(e.clientX,e.clientY);if(!relatedTarget||relatedTarget.nodeName=="HTML"){dropArea.style.display='none';}});},_onSubmit:function(id,fileName){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(id,fileName);},_onProgress:function(id,fileName,loaded,total){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var item=this._getItemByFileId(id);var size=this._find(item,'size');size.style.display='inline';var text;if(loaded!=total){text=Math.round(loaded/total*100)+'% from '+this._formatSize(total);}else{text=this._formatSize(total);}qq.setText(size,text);},_onComplete:function(id,fileName,result){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var item=this._getItemByFileId(id);qq.remove(this._find(item,'cancel'));qq.remove(this._find(item,'spinner'));if(result.success){qq.addClass(item,this._classes.success);}else{qq.addClass(item,this._classes.fail);}},_addToList:function(id,fileName){var item=qq.toElement(this._options.fileTemplate);item.qqFileId=id;var fileElement=this._find(item,'file');qq.setText(fileElement,this._formatFileName(fileName));this._find(item,'size').style.display='none';this._listElement.appendChild(item);},_getItemByFileId:function(id){var item=this._listElement.firstChild;while(item){if(item.qqFileId==id)return item;item=item.nextSibling;}},_bindCancelEvent:function(){var self=this,list=this._listElement;qq.attach(list,'click',function(e){e=e||window.event;var target=e.target||e.srcElement;if(qq.hasClass(target,self._classes.cancel)){qq.preventDefault(e);var item=target.parentNode;self._handler.cancel(item.qqFileId);qq.remove(item);}});}});qq.UploadDropZone=function(o){this._options={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}};qq.extend(this._options,o);this._element=this._options.element;this._disableDropOutside();this._attachEvents();};qq.UploadDropZone.prototype={_disableDropOutside:function(e){if(!qq.UploadDropZone.dropOutsideDisabled){qq.attach(document,'dragover',function(e){if(e.dataTransfer){e.dataTransfer.dropEffect='none';e.preventDefault();}});qq.UploadDropZone.dropOutsideDisabled=true;}},_attachEvents:function(){var self=this;qq.attach(self._element,'dragover',function(e){if(!self._isValidFileDrag(e))return;var effect=e.dataTransfer.effectAllowed;if(effect=='move'||effect=='linkMove'){e.dataTransfer.dropEffect='move';}else{e.dataTransfer.dropEffect='copy';}e.stopPropagation();e.preventDefault();});qq.attach(self._element,'dragenter',function(e){if(!self._isValidFileDrag(e))return;self._options.onEnter(e);});qq.attach(self._element,'dragleave',function(e){if(!self._isValidFileDrag(e))return;self._options.onLeave(e);var relatedTarget=document.elementFromPoint(e.clientX,e.clientY);if(qq.contains(this,relatedTarget))return;self._options.onLeaveNotDescendants(e);});qq.attach(self._element,'drop',function(e){if(!self._isValidFileDrag(e))return;e.preventDefault();self._options.onDrop(e);});},_isValidFileDrag:function(e){var dt=e.dataTransfer,isWebkit=navigator.userAgent.indexOf("AppleWebKit")>-1;return dt&&dt.effectAllowed!='none'&&(dt.files||(!isWebkit&&dt.types.contains&&dt.types.contains('Files')));}};qq.UploadButton=function(o){this._options={element:null,multiple:false,name:'file',onChange:function(input){},hoverClass:'qq-upload-button-hover',focusClass:'qq-upload-button-focus'};qq.extend(this._options,o);this._element=this._options.element;qq.css(this._element,{position:'relative',overflow:'hidden',direction:'ltr'});this._input=this._createInput();};qq.UploadButton.prototype={getInput:function(){return this._input;},reset:function(){if(this._input.parentNode){qq.remove(this._input);}qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput();},_createInput:function(){var input=document.createElement("input");if(this._options.multiple){input.setAttribute("multiple","multiple");}input.setAttribute("type","file");input.setAttribute("name",this._options.name);qq.css(input,{position:'absolute',right:0,top:0,fontFamily:'Arial',fontSize:'118px',margin:0,padding:0,cursor:'pointer',opacity:0});this._element.appendChild(input);var self=this;qq.attach(input,'change',function(){self._options.onChange(input);});qq.attach(input,'mouseover',function(){qq.addClass(self._element,self._options.hoverClass);});qq.attach(input,'mouseout',function(){qq.removeClass(self._element,self._options.hoverClass);});qq.attach(input,'focus',function(){qq.addClass(self._element,self._options.focusClass);});qq.attach(input,'blur',function(){qq.removeClass(self._element,self._options.focusClass);});if(window.attachEvent){input.setAttribute('tabIndex',"-1");}return input;}};qq.UploadHandlerAbstract=function(o){this._options={debug:false,action:'/upload.php',maxConnections:999,onProgress:function(id,fileName,loaded,total){},onComplete:function(id,fileName,response){},onCancel:function(id,fileName){}};qq.extend(this._options,o);this._queue=[];this._params=[];};qq.UploadHandlerAbstract.prototype={log:function(str){if(this._options.debug&&window.console)console.log('[uploader] '+str);},add:function(file){},upload:function(id,params){var len=this._queue.push(id);var copy={};qq.extend(copy,params);this._params[id]=copy;if(len<=this._options.maxConnections){this._upload(id,this._params[id]);}},cancel:function(id){this._cancel(id);this._dequeue(id);},cancelAll:function(){for(var i=0;i<this._queue.length;i++){this._cancel(this._queue[i]);}this._queue=[];},getName:function(id){},getSize:function(id){},getQueue:function(){return this._queue;},_upload:function(id){},_cancel:function(id){},_dequeue:function(id){var i=qq.indexOf(this._queue,id);this._queue.splice(i,1);var max=this._options.maxConnections;if(this._queue.length>=max&&i<max){var nextId=this._queue[max-1];this._upload(nextId,this._params[nextId]);}}};qq.UploadHandlerForm=function(o){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={};};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(fileInput){fileInput.setAttribute('name','qqfile');var id='qq-upload-handler-iframe'+qq.getUniqueId();this._inputs[id]=fileInput;if(fileInput.parentNode){qq.remove(fileInput);}return id;},getName:function(id){return this._inputs[id].value.replace(/.*(\/|\\)/,"");},_cancel:function(id){this._options.onCancel(id,this.getName(id));delete this._inputs[id];var iframe=document.getElementById(id);if(iframe){iframe.setAttribute('src','javascript:false;');qq.remove(iframe);}},_upload:function(id,params){var input=this._inputs[id];if(!input){throw new Error('file with passed id was not added, or already uploaded or cancelled');}var fileName=this.getName(id);var iframe=this._createIframe(id);var form=this._createForm(iframe,params);form.appendChild(input);var self=this;this._attachLoadEvent(iframe,function(){self.log('iframe loaded');var response=self._getIframeContentJSON(iframe);self._options.onComplete(id,fileName,response);self._dequeue(id);delete self._inputs[id];setTimeout(function(){qq.remove(iframe);},1);});form.submit();qq.remove(form);return id;},_attachLoadEvent:function(iframe,callback){qq.attach(iframe,'load',function(){if(!iframe.parentNode){return;}if(iframe.contentDocument&&iframe.contentDocument.body&&iframe.contentDocument.body.innerHTML=="false"){return;}callback();});},_getIframeContentJSON:function(iframe){var doc=iframe.contentDocument?iframe.contentDocument:iframe.contentWindow.document,response;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+doc.body.innerHTML);try{response=eval("("+doc.body.innerHTML+")");}catch(err){response={};}return response;},_createIframe:function(id){var iframe=qq.toElement('<iframe src="javascript:false;" name="'+id+'" />');iframe.setAttribute('id',id);iframe.style.display='none';document.body.appendChild(iframe);return iframe;},_createForm:function(iframe,params){var form=qq.toElement('<form method="post" enctype="multipart/form-data"></form>');var queryString=qq.obj2url(params,this._options.action);form.setAttribute('action',queryString);form.setAttribute('target',iframe.name);form.style.display='none';document.body.appendChild(form);return form;}});qq.UploadHandlerXhr=function(o){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[];};qq.UploadHandlerXhr.isSupported=function(){var input=document.createElement('input');input.type='file';return('multiple'in input&&typeof File!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined");};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(file){if(!(file instanceof File)){throw new Error('Passed obj in not a File (in qq.UploadHandlerXhr)');}return this._files.push(file)-1;},getName:function(id){var file=this._files[id];return file.fileName!=null?file.fileName:file.name;},getSize:function(id){var file=this._files[id];return file.fileSize!=null?file.fileSize:file.size;},getLoaded:function(id){return this._loaded[id]||0;},_upload:function(id,params){var file=this._files[id],name=this.getName(id),size=this.getSize(id);this._loaded[id]=0;var xhr=this._xhrs[id]=new XMLHttpRequest();var self=this;xhr.upload.onprogress=function(e){if(e.lengthComputable){self._loaded[id]=e.loaded;self._options.onProgress(id,name,e.loaded,e.total);}};xhr.onreadystatechange=function(){if(xhr.readyState==4){self._onComplete(id,xhr);}};params=params||{};params['qqfile']=name;var queryString=qq.obj2url(params,this._options.action);xhr.open("POST",queryString,true);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("X-File-Name",encodeURIComponent(name));xhr.setRequestHeader("Content-Type","application/octet-stream");xhr.send(file);},_onComplete:function(id,xhr){if(!this._files[id])return;var name=this.getName(id);var size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200){this.log("xhr - server response received");this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")");}catch(err){response={};}this._options.onComplete(id,name,response);}else{this._options.onComplete(id,name,{});}this._files[id]=null;this._xhrs[id]=null;this._dequeue(id);},_cancel:function(id){this._options.onCancel(id,this.getName(id));this._files[id]=null;if(this._xhrs[id]){this._xhrs[id].abort();this._xhrs[id]=null;}}});qq.extend(qq.FileUploader.prototype,{_createUploadHandler:function(){var self=this,handlerClass;if(qq.UploadHandlerXhr.isSupported()){handlerClass='UploadHandlerXhr';}else{handlerClass='UploadHandlerForm';}var handler=new qq[handlerClass]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(id,fileName,loaded,total){self._onProgress(id,fileName,loaded,total);self._options.onProgress(id,fileName,loaded,total);},onComplete:function(id,fileName,result){self._onComplete(id,fileName,result);self._options.onComplete(id,fileName,result);},onCancel:function(id,fileName){self._onCancel(id,fileName);self._options.onCancel(id,fileName);},onUpload:function(){self._onUpload();}});return handler;},_onUpload:function(){this._handler.uploadAll(this._options.params);},_uploadFile:function(fileContainer){var id=this._handler.add(fileContainer);var fileName=this._handler.getName(id);if(this._options.onSubmit(id,fileName)!==false){this._onSubmit(id,fileName);}},_addToList:function(id,fileName){var item=qq.toElement(this._options.fileTemplate);item.qqFileId=id;var fileElement=this._find(item,'file');qq.setText(fileElement,fileName);this._find(item,'size').style.display='none';var nameElement=this._find(item,'nameInput');fileName=fileName.toLowerCase();fileName=fileName.replace(/([ !"#$%&\'()+,\/;<=>?@[\]^`{|}~:]+)/g,'_');fileName=fileName.replace(/^_+/,'');nameElement.value=fileName;nameElement.id='mediamanager__upload_item'+id;this._listElement.appendChild(item);}});qq.FileUploaderExtended=function(o){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader">'+'<div class="qq-upload-drop-area"><span>'+LANG.media_drop+'</span></div>'+'<div class="qq-upload-button">'+LANG.media_select+'</div>'+'<ul class="qq-upload-list"></ul>'+'<div class="qq-action-container">'+'  <button class="qq-upload-action" type="submit" id="mediamanager__upload_button">'+LANG.media_upload_btn+'</button>'+'  <label class="qq-overwrite-check"><input type="checkbox" value="1" name="ow" class="dw__ow"> <span>'+LANG.media_overwrt+'</span></label>'+'</div>'+'</div>',fileTemplate:'<li>'+'<span class="qq-upload-file hidden"></span>'+'  <input class="qq-upload-name-input edit" type="text" value="" />'+'  <span class="qq-upload-spinner hidden"></span>'+'  <span class="qq-upload-size"></span>'+'  <a class="qq-upload-cancel" href="#">'+LANG.media_cancel+'</a>'+'  <span class="qq-upload-failed-text error">Failed</span>'+'</li>',classes:{button:'qq-upload-button',drop:'qq-upload-drop-area',dropActive:'qq-upload-drop-area-active',list:'qq-upload-list',nameInput:'qq-upload-name-input',overwriteInput:'qq-overwrite-check',uploadButton:'qq-upload-action',file:'qq-upload-file',spinner:'qq-upload-spinner',size:'qq-upload-size',cancel:'qq-upload-cancel',success:'qq-upload-success',fail:'qq-upload-fail',failedText:'qq-upload-failed-text'}});qq.extend(this._options,o);this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,'list');this._classes=this._options.classes;this._button=this._createUploadButton(this._find(this._element,'button'));this._bindCancelEvent();this._bindUploadEvent();this._setupDragDrop();};qq.extend(qq.FileUploaderExtended.prototype,qq.FileUploader.prototype);qq.extend(qq.FileUploaderExtended.prototype,{_bindUploadEvent:function(){var self=this,list=this._listElement;qq.attach(document.getElementById('mediamanager__upload_button'),'click',function(e){e=e||window.event;var target=e.target||e.srcElement;qq.preventDefault(e);self._handler._options.onUpload();jQuery(".qq-upload-name-input").each(function(i){jQuery(this).attr('disabled','disabled');});});},_onComplete:function(id,fileName,result){this._filesInProgress--;var item=this._getItemByFileId(id);qq.remove(this._find(item,'cancel'));qq.remove(this._find(item,'spinner'));var nameInput=this._find(item,'nameInput');var fileElement=this._find(item,'file');qq.setText(fileElement,nameInput.value);qq.removeClass(fileElement,'hidden');qq.remove(nameInput);jQuery('.qq-upload-button, #mediamanager__upload_button').remove();jQuery('.dw__ow').parent().hide();jQuery('.qq-upload-drop-area').remove();if(result.success){qq.addClass(item,this._classes.success);$link='<a href="'+result.link+'" id="h_:'+result.id+'" class="select">'+nameInput.value+'</a>';jQuery(fileElement).html($link);}else{qq.addClass(item,this._classes.fail);var fail=this._find(item,'failedText');if(result.error)qq.setText(fail,result.error);}if(document.getElementById('media__content')&&!document.getElementById('mediamanager__done_form')){var action=document.location.href;var i=action.indexOf('?');if(i)action=action.substr(0,i);var button='<form method="post" action="'+action+'" id="mediamanager__done_form"><div>';button+='<input type="hidden" value="'+result.ns+'" name="ns">';button+='<input type="hidden" value="1" name="recent">';button+='<button type="submit">'+LANG.media_done_btn+'</button></div></form>';jQuery('#mediamanager__uploader').append(button);}}});qq.extend(qq.UploadHandlerForm.prototype,{uploadAll:function(params){this._uploadAll(params);},getName:function(id){var file=this._inputs[id];var name=document.getElementById('mediamanager__upload_item'+id);if(name!=null){return name.value;}else{if(file!=null){return file.value.replace(/.*(\/|\\)/,"");}else{return null;}}},_uploadAll:function(params){jQuery(".qq-upload-spinner").each(function(i){jQuery(this).removeClass('hidden');});for(key in this._inputs){this.upload(key,params);}},_upload:function(id,params){var input=this._inputs[id];if(!input){throw new Error('file with passed id was not added, or already uploaded or cancelled');}var fileName=this.getName(id);var iframe=this._createIframe(id);var form=this._createForm(iframe,params);form.appendChild(input);var nameInput=qq.toElement('<input name="mediaid" value="'+fileName+'" type="text">');form.appendChild(nameInput);var checked=jQuery('.dw__ow').is(':checked');var owCheckbox=jQuery('.dw__ow').clone();owCheckbox.attr('checked',checked);jQuery(form).append(owCheckbox);var self=this;this._attachLoadEvent(iframe,function(){self.log('iframe loaded');var response=self._getIframeContentJSON(iframe);self._options.onComplete(id,fileName,response);self._dequeue(id);delete self._inputs[id];setTimeout(function(){qq.remove(iframe);},1);});form.submit();qq.remove(form);return id;}});qq.extend(qq.UploadHandlerXhr.prototype,{uploadAll:function(params){this._uploadAll(params);},getName:function(id){var file=this._files[id];var name=document.getElementById('mediamanager__upload_item'+id);if(name!=null){return name.value;}else{if(file!=null){return file.fileName!=null?file.fileName:file.name;}else{return null;}}},getSize:function(id){var file=this._files[id];if(file==null)return null;return file.fileSize!=null?file.fileSize:file.size;},_upload:function(id,params){var file=this._files[id],name=this.getName(id),size=this.getSize(id);if(name==null||size==null)return;this._loaded[id]=0;var xhr=this._xhrs[id]=new XMLHttpRequest();var self=this;xhr.upload.onprogress=function(e){if(e.lengthComputable){self._loaded[id]=e.loaded;self._options.onProgress(id,name,e.loaded,e.total);}};xhr.onreadystatechange=function(){if(xhr.readyState==4){self._onComplete(id,xhr);}};params=params||{};params['qqfile']=name;params['ow']=jQuery('.dw__ow').is(':checked');var queryString=qq.obj2url(params,this._options.action);xhr.open("POST",queryString,true);xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");xhr.setRequestHeader("X-File-Name",encodeURIComponent(name));xhr.setRequestHeader("Content-Type","application/octet-stream");xhr.send(file);},_uploadAll:function(params){jQuery(".qq-upload-spinner").each(function(i){jQuery(this).removeClass('hidden');});for(key in this._files){this.upload(key,params);}}});function substr_replace(str,replace,start,length){var a2,b1;a2=(start<0?str.length:0)+start;if(typeof length==='undefined'){length=str.length-a2;}else if(length<0&&start<0&&length<=start){length=0;}b1=(length<0?str.length:a2)+length;return str.substring(0,a2)+replace+str.substring(b1);}function bind(fnc){var Aps=Array.prototype.slice,static_args=Aps.call(arguments,1);return function(){return fnc.apply(this,static_args.concat(Aps.call(arguments,0)));};}function logError(e,file){if(window.console&&console.error){console.error('The error "%s: %s" occurred in file "%s". '+'If this is in a plugin try updating or disabling the plugin, '+'if this is in a template try updating the template or switching to the "dokuwiki" template.',e.name,e.message,file);if(e.stack){console.error(e.stack);}}}var timer={_cur_id:0,_handlers:{},execDispatch:function(id){timer._handlers[id]();},add:function(func,timeout){var id=++timer._cur_id;timer._handlers[id]=func;return window.setTimeout('timer.execDispatch('+id+')',timeout);}};function Delay(func,timeout){this.func=func;if(timeout){this.timeout=timeout;}}Delay.prototype={func:null,timeout:500,delTimer:function(){if(this.timer!==null){window.clearTimeout(this.timer);this.timer=null;}},start:function(){DEPRECATED('don\'t use the Delay object, use window.timeout with a callback instead');this.delTimer();var _this=this;this.timer=timer.add(function(){_this.exec.call(_this);},this.timeout);this._data={_this:arguments[0],_params:Array.prototype.slice.call(arguments,2)};},exec:function(){this.delTimer();this.func.call(this._data._this,this._data._params);}};var DokuCookie={data:{},name:'DOKU_PREFS',setValue:function(key,val){var text=[],_this=this;this.init();this.data[key]=val;jQuery.each(_this.data,function(key,val){if(_this.data.hasOwnProperty(key)){text.push(encodeURIComponent(key)+'#'+encodeURIComponent(val));}});jQuery.cookie(this.name,text.join('#'),{expires:365,path:DOKU_COOKIE_PARAM.path,secure:DOKU_COOKIE_PARAM.secure});},getValue:function(key){this.init();return this.data[key];},init:function(){var text,parts,i;if(!jQuery.isEmptyObject(this.data)){return;}text=jQuery.cookie(this.name);if(text){parts=text.split('#');for(i=0;i<parts.length;i+=2){this.data[decodeURIComponent(parts[i])]=decodeURIComponent(parts[i+1]);}}}};if('function'===typeof jQuery&&'function'===typeof jQuery.noConflict){jQuery.noConflict();}var clientPC=navigator.userAgent.toLowerCase();var is_macos=navigator.appVersion.indexOf('Mac')!=-1;var is_gecko=((clientPC.indexOf('gecko')!=-1)&&(clientPC.indexOf('spoofer')==-1)&&(clientPC.indexOf('khtml')==-1)&&(clientPC.indexOf('netscape/7.0')==-1));var is_safari=((clientPC.indexOf('applewebkit')!=-1)&&(clientPC.indexOf('spoofer')==-1));var is_khtml=(navigator.vendor=='KDE'||(document.childNodes&&!document.all&&!navigator.taintEnabled));if(clientPC.indexOf('opera')!=-1){var is_opera=true;var is_opera_preseven=(window.opera&&!document.childNodes);var is_opera_seven=(window.opera&&document.childNodes);}function showLoadBar(){document.write('<img src="'+DOKU_BASE+'lib/images/loading.gif" '+'width="150" height="12" alt="..." />');}function hideLoadBar(id){jQuery('#'+id).hide();}function closePopups(){jQuery('div.JSpopup').hide();}jQuery(function(){jQuery(document).click(closePopups);});jQuery.fn.dw_qsearch=function(overrides){var dw_qsearch={output:'#qsearch__out',$inObj:this,$outObj:null,timer:null,curRequest:null,init:function(){var do_qsearch;dw_qsearch.$outObj=jQuery(dw_qsearch.output);if(dw_qsearch.$inObj.length===0||dw_qsearch.$outObj.length===0){return;}do_qsearch=function(){if(dw_qsearch.curRequest!=null){dw_qsearch.curRequest.abort();}var value=dw_qsearch.getSearchterm();if(value===''){dw_qsearch.clear_results();return;}dw_qsearch.$inObj.parents('form').addClass('searching');dw_qsearch.curRequest=jQuery.post(DOKU_BASE+'lib/exe/ajax.php',{call:'qsearch',q:encodeURI(value)},dw_qsearch.onCompletion,'html');};dw_qsearch.$inObj.keyup(function(){if(dw_qsearch.timer){window.clearTimeout(dw_qsearch.timer);dw_qsearch.timer=null;}dw_qsearch.timer=window.setTimeout(do_qsearch,500);});dw_qsearch.$outObj.click(dw_qsearch.clear_results);},getSearchterm:function(){return dw_qsearch.$inObj.val();},clear_results:function(){dw_qsearch.$inObj.parents('form').removeClass('searching');dw_qsearch.$outObj.hide();dw_qsearch.$outObj.text('');},onCompletion:function(data){var max,$links,too_big;dw_qsearch.$inObj.parents('form').removeClass('searching');dw_qsearch.curRequest=null;if(data===''){dw_qsearch.clear_results();return;}dw_qsearch.$outObj .html(data).show().css('white-space','nowrap');dw_qsearch.$outObj.find('li').css('overflow','visible');$links=dw_qsearch.$outObj.find('a');max=dw_qsearch.$outObj[0].clientWidth;if(document.documentElement.dir==='rtl'){max-=parseInt(dw_qsearch.$outObj.css('padding-left'));too_big=function(l){return l.offsetLeft<0;};}else{max-=parseInt(dw_qsearch.$outObj.css('padding-right'));too_big=function(l){return l.offsetWidth+l.offsetLeft>max;};}$links.each(function(){var start,length,replace,nsL,nsR,eli,runaway;if(!too_big(this)){return;}nsL=this.textContent.indexOf('(');nsR=this.textContent.indexOf(')');eli=0;runaway=0;while((nsR-nsL>3)&&too_big(this)&&runaway++<500){if(eli!==0){if((eli-nsL)>(nsR-eli)){start=eli-2;length=2;}else{start=eli+1;length=1;}replace='';}else{start=Math.floor(nsL+((nsR-nsL)/2));length=1;replace='…';}this.textContent=substr_replace(this.textContent,replace,start,length);eli=this.textContent.indexOf('…');nsL=this.textContent.indexOf('(');nsR=this.textContent.indexOf(')');}});dw_qsearch.$outObj.find('li').css('overflow','hidden').css('text-overflow','ellipsis');}};jQuery.extend(dw_qsearch,overrides);if(!overrides.deferInit){dw_qsearch.init();}return dw_qsearch;};jQuery(function(){jQuery('#qsearch__in').dw_qsearch({output:'#qsearch__out'});});jQuery.fn.dw_tree=function(overrides){var dw_tree={throbber_delay:500,$obj:this,toggle_selector:'a.idx_dir',init:function(){this.$obj.on('click',this.toggle_selector,this,this.toggle);jQuery('ul:first',this.$obj).attr('role','tree');jQuery('ul',this.$obj).not(':first').attr('role','group');jQuery('li',this.$obj).attr('role','treeitem');jQuery('li.open > ul',this.$obj).attr('aria-expanded','true');jQuery('li.closed > ul',this.$obj).attr('aria-expanded','false');jQuery('li.closed',this.$obj).attr('aria-live','assertive');},toggle:function(e){var $listitem,$sublist,timeout,$clicky,show_sublist,dw_tree,opening;e.preventDefault();dw_tree=e.data;$clicky=jQuery(this);$listitem=$clicky.closest('li');$sublist=$listitem.find('ul').first();opening=$listitem.hasClass('closed');dw_tree.toggle_display($clicky,opening);if($sublist.is(':visible')){$listitem.removeClass('open').addClass('closed');$sublist.attr('aria-expanded','false');}else{$listitem.removeClass('closed').addClass('open');$sublist.attr('aria-expanded','true');}if(!opening){$sublist.dw_hide();return;}show_sublist=function(data){$sublist.hide();if(typeof data!=='undefined'){$sublist.html(data);$sublist.parent().attr('aria-busy','false').removeAttr('aria-live');jQuery('li.closed',$sublist).attr('aria-live','assertive');}if($listitem.hasClass('open')){$sublist.dw_show();}};if($sublist.length>0){show_sublist();return;}$sublist=jQuery('<ul class="idx" role="group"/>');$listitem.append($sublist);timeout=window.setTimeout(bind(show_sublist,'<li aria-busy="true"><img src="'+DOKU_BASE+'lib/images/throbber.gif" alt="loading..." title="loading..." /></li>'),dw_tree.throbber_delay);dw_tree.load_data(function(data){window.clearTimeout(timeout);show_sublist(data);},$clicky);},toggle_display:function($clicky,opening){},load_data:function(show_data,$clicky){show_data();}};jQuery.extend(dw_tree,overrides);if(!overrides.deferInit){dw_tree.init();}return dw_tree;};var dw_index=jQuery('#index__tree').dw_tree({deferInit:true,load_data:function(show_sublist,$clicky){jQuery.post(DOKU_BASE+'lib/exe/ajax.php',$clicky[0].search.substr(1)+'&call=index',show_sublist,'html');}});jQuery(function(){var $tree=jQuery('#index__tree');dw_index.$obj=$tree;dw_index.init();});function selection_class(){this.start=0;this.end=0;this.obj=null;this.scroll=0;this.fix=0;this.getLength=function(){return this.end-this.start;};this.getText=function(){return(!this.obj)?'':this.obj.value.substring(this.start,this.end);};}function DWgetSelection(textArea){var sel=new selection_class();textArea.focus();sel.obj=textArea;sel.start=textArea.selectionStart;sel.end=textArea.selectionEnd;sel.scroll=textArea.scrollTop;return sel;}function DWsetSelection(selection){selection.obj.setSelectionRange(selection.start,selection.end);if(selection.scroll)selection.obj.scrollTop=selection.scroll;}function pasteText(selection,text,opts){if(!opts)opts={};selection.obj.value=selection.obj.value.substring(0,selection.start)+text+selection.obj.value.substring(selection.end,selection.obj.value.length);if(is_opera){selection.end=selection.start+text.replace(/\r?\n/g,'\r\n').length;}else{selection.end=selection.start+text.length;}if(opts.startofs)selection.start+=opts.startofs;if(opts.endofs)selection.end-=opts.endofs;if(opts.nosel)selection.start=selection.end;DWsetSelection(selection);}function insertTags(textAreaID,tagOpen,tagClose,sampleText){var txtarea=jQuery('#'+textAreaID)[0];var selection=DWgetSelection(txtarea);var text=selection.getText();var opts;if(text.charAt(text.length-1)==' '){selection.end--;text=selection.getText();}if(!text){text=sampleText;opts={startofs:tagOpen.length,endofs:tagClose.length};}else{opts={nosel:true};}text=tagOpen+text+tagClose;pasteText(selection,text,opts);}function insertAtCarret(textAreaID,text){var txtarea=jQuery('#'+textAreaID)[0];var selection=DWgetSelection(txtarea);pasteText(selection,text,{nosel:true});}var pickercounter=0;function initToolbar(tbid,edid,tb,allowblock){var $toolbar,$edit;if(typeof tbid=='string'){$toolbar=jQuery('#'+tbid);}else{$toolbar=jQuery(tbid);}$edit=jQuery('#'+edid);if($toolbar.length==0||$edit.length==0||$edit.attr('readOnly')){return;}if(typeof allowblock==='undefined'){allowblock=true;}$toolbar.html('');jQuery.each(tb,function(k,val){if(!tb.hasOwnProperty(k)||(!allowblock&&val.block===true)){return;}var actionFunc,$btn;$btn=jQuery(createToolButton(val.icon,val.title,val.key,val.id,val['class']));actionFunc='tb_'+val.type;if(jQuery.isFunction(window[actionFunc])){$btn.on('click',bind(window[actionFunc],$btn,val,edid));$toolbar.append($btn);return;}actionFunc='addBtnAction'+val.type.charAt(0).toUpperCase()+val.type.substring(1);if(jQuery.isFunction(window[actionFunc])){var pickerid=window[actionFunc]($btn,val,edid);if(pickerid!==''){$toolbar.append($btn);$btn.attr('aria-controls',pickerid);if(actionFunc==='addBtnActionPicker'){$btn.attr('aria-haspopup','true');}}return;}alert('unknown toolbar type: '+val.type+'  '+actionFunc);});}function tb_format(btn,props,edid){var sample=props.sample||props.title;insertTags(edid,fixtxt(props.open),fixtxt(props.close),fixtxt(sample));pickerClose();return false;}function tb_formatln(btn,props,edid){var sample=props.sample||props.title,opts,selection=DWgetSelection(jQuery('#'+edid)[0]);sample=fixtxt(sample);props.open=fixtxt(props.open);props.close=fixtxt(props.close);if(selection.getLength()){sample=selection.getText();opts={nosel:true};}else{opts={startofs:props.open.length,endofs:props.close.length};}sample=sample.split("\n").join(props.close+"\n"+props.open);sample=props.open+sample+props.close;pasteText(selection,sample,opts);pickerClose();return false;}function tb_insert(btn,props,edid){insertAtCarret(edid,fixtxt(props.insert));pickerClose();return false;}function tb_mediapopup(btn,props,edid){window.open(DOKU_BASE+props.url+encodeURIComponent(NS)+'&edid='+encodeURIComponent(edid),props.name,props.options);return false;}function tb_autohead(btn,props,edid){var lvl=currentHeadlineLevel(edid),tags;lvl+=props.mod;if(lvl<1)lvl=1;if(lvl>5)lvl=5;tags=(new Array(8-lvl)).join('=');insertTags(edid,tags+' ',' '+tags+"\n",props.text);pickerClose();return false;}function addBtnActionPicker($btn,props,edid){var pickerid='picker'+(pickercounter++);var picker=createPicker(pickerid,props,edid);jQuery(picker).attr('aria-hidden','true');$btn.click(function(e){pickerToggle(pickerid,$btn);e.preventDefault();return'';});return pickerid;}function addBtnActionLinkwiz($btn,props,edid){dw_linkwiz.init(jQuery('#'+edid));jQuery($btn).click(function(e){dw_linkwiz.val=props;dw_linkwiz.toggle();e.preventDefault();return'';});return'link__wiz';}function pickerToggle(pickerid,$btn){var $picker=jQuery('#'+pickerid),pos=$btn.offset();if($picker.hasClass('a11y')){$picker.removeClass('a11y').attr('aria-hidden','false');}else{$picker.addClass('a11y').attr('aria-hidden','true');}var picker_left=pos.left+3,picker_width=$picker.width(),window_width=jQuery(window).width();if(picker_width>300){$picker.css("max-width","300");picker_width=300;}if((picker_left+picker_width+40)>window_width){picker_left=window_width-picker_width-40;}if(picker_left<0){picker_left=0;}$picker.offset({left:picker_left,top:pos.top+$btn[0].offsetHeight+3});}function pickerClose(){jQuery('.picker').addClass('a11y');}function fixtxt(str){return str.replace(/\\n/g,"\n");}jQuery(function(){initToolbar('tool__bar','wiki__text',toolbar);jQuery('#tool__bar').attr('role','toolbar');});function createToolButton(icon,label,key,id,classname){var $btn=jQuery(document.createElement('button')),$ico=jQuery(document.createElement('img'));$btn.addClass('toolbutton');if(classname){$btn.addClass(classname);}$btn.attr('title',label).attr('aria-controls','wiki__text');if(key){$btn.attr('title',label+' ['+key.toUpperCase()+']').attr('accessKey',key);}if(id){$btn.attr('id',id);$ico.attr('id',id+'_ico');}if(icon.substr(0,1)!=='/'){icon=DOKU_BASE+'lib/images/toolbar/'+icon;}$ico.attr('src',icon);$ico.attr('alt','');$ico.attr('width',16);$ico.attr('height',16);$btn.append($ico);return $btn[0];}function createPicker(id,props,edid){var $picker=jQuery(document.createElement('div'));$picker.addClass('picker a11y');if(props['class']){$picker.addClass(props['class']);}$picker.attr('id',id).css('position','absolute');function $makebutton(title){var $btn=jQuery(document.createElement('button')).addClass('pickerbutton').attr('title',title).attr('aria-controls',edid).on('click',bind(pickerInsert,title,edid)).appendTo($picker);return $btn;}jQuery.each(props.list,function(key,item){if(!props.list.hasOwnProperty(key)){return;}if(isNaN(key)){if(item.substr(0,1)!=='/'){item=DOKU_BASE+'lib/images/'+props.icobase+'/'+item;}jQuery(document.createElement('img')).attr('src',item).attr('alt','').appendTo($makebutton(key));}else if(typeof item=='string'){$makebutton(item).text(item);}else{initToolbar($picker,edid,props.list);return false;}});jQuery('body').append($picker);return $picker[0];}function pickerInsert(text,edid){insertAtCarret(edid,text);pickerClose();}function addBtnActionSignature($btn,props,edid){if(typeof SIG!='undefined'&&SIG!=''){$btn.on('click',function(e){insertAtCarret(edid,SIG);e.preventDefault();});return edid;}return'';}function currentHeadlineLevel(textboxId){var field=jQuery('#'+textboxId)[0],s=false,opts=[field.value.substr(0,DWgetSelection(field).start)];if(field.form.prefix){opts.push(field.form.prefix.value);}jQuery.each(opts,function(_,opt){var str="\n"+opt,lasthl=str.lastIndexOf("\n==");if(lasthl!==-1){s=str.substr(lasthl+1,6);return false;}});if(s===false){return 0;}return 7-s.match(/^={2,6}/)[0].length;}window.textChanged=false;window.doku_edit_text_content='';function deleteDraft(){if(is_opera||window.keepDraft){return;}var $dwform=jQuery('#dw__editform');if($dwform.length===0){return;}jQuery.post(DOKU_BASE+'lib/exe/ajax.php',{call:'draftdel',id:$dwform.find('input[name=id]').val()});}jQuery(function(){var $editform=jQuery('#dw__editform');if($editform.length==0){return;}var $edit_text=jQuery('#wiki__text');if($edit_text.length>0){if($edit_text.attr('readOnly')){return;}var sel=DWgetSelection($edit_text[0]);sel.start=0;sel.end=0;DWsetSelection(sel);$edit_text.focus();doku_edit_text_content=$edit_text.val();}var changeHandler=function(){doku_hasTextBeenModified();doku_summaryCheck();};$editform.change(changeHandler);$editform.keydown(changeHandler);window.onbeforeunload=function(){if(window.textChanged){return LANG.notsavedyet;}};window.onunload=deleteDraft;jQuery('#edbtn__save').click(function(){window.onbeforeunload='';textChanged=false;});jQuery('#edbtn__preview').click(function(){window.onbeforeunload='';textChanged=false;window.keepDraft=true;});var $summary=jQuery('#edit__summary');$summary.change(doku_summaryCheck);$summary.keyup(doku_summaryCheck);if(textChanged)doku_summaryCheck();});function doku_hasTextBeenModified(){if(!textChanged){var $edit_text=jQuery('#wiki__text');if($edit_text.length>0){textChanged=doku_edit_text_content!=$edit_text.val();}else{textChanged=true;}}}function doku_summaryCheck(){var $sum=jQuery('#edit__summary'),missing=$sum.val()==='';$sum.toggleClass('missing',missing).toggleClass('edit',!missing);}var dw_editor={init:function(){var $editor=jQuery('#wiki__text');if($editor.length===0){return;}dw_editor.initSizeCtl('#size__ctl',$editor);if($editor.attr('readOnly')){return;}$editor.keydown(dw_editor.keyHandler);},initSizeCtl:function(ctlarea,editor){var $ctl=jQuery(ctlarea),$textarea=jQuery(editor);if($ctl.length===0||$textarea.length===0){return;}$textarea.css('height',DokuCookie.getValue('sizeCtl')||'300px');var wrp=DokuCookie.getValue('wrapCtl');if(wrp){dw_editor.setWrap($textarea[0],wrp);}jQuery.each([['larger',function(){dw_editor.sizeCtl(editor,100);}],['smaller',function(){dw_editor.sizeCtl(editor,-100);}],['wrap',function(){dw_editor.toggleWrap(editor);}]],function(_,img){jQuery(document.createElement('img')).attr('src',DOKU_BASE+'lib/images/'+img[0]+'.gif').attr('alt','').click(img[1]).appendTo($ctl);});},sizeCtl:function(editor,val){var $textarea=jQuery(editor),height=parseInt($textarea.css('height'))+val;$textarea.css('height',height+'px');DokuCookie.setValue('sizeCtl',$textarea.css('height'));},toggleWrap:function(editor){var $textarea=jQuery(editor),wrap=$textarea.attr('wrap');dw_editor.setWrap($textarea[0],(wrap&&wrap.toLowerCase()=='off')?'soft':'off');DokuCookie.setValue('wrapCtl',$textarea.attr('wrap'));},setWrap:function(textarea,wrapAttrValue){textarea.setAttribute('wrap',wrapAttrValue);var parNod=textarea.parentNode;var nxtSib=textarea.nextSibling;parNod.removeChild(textarea);parNod.insertBefore(textarea,nxtSib);},keyHandler:function(e){if(jQuery.inArray(e.keyCode,[8,10,13,32])===-1){return;}var selection=DWgetSelection(this);if(selection.getLength()>0){return;}var search="\n"+this.value.substr(0,selection.start);var linestart=Math.max(search.lastIndexOf("\n"),search.lastIndexOf("\r"));search=search.substr(linestart);if((e.keyCode==13||e.keyCode==10)&&e.ctrlKey){jQuery('#edbtn__save').click();e.preventDefault();return false;}else if(e.keyCode==13){var match=search.match(/(\n  +([\*-] ?)?)/);if(match){var scroll=this.scrollHeight;var match2=search.match(/^\n  +[\*-]\s*$/);if(match2&&this.value.substr(selection.start).match(/^($|\r?\n)/)){this.value=this.value.substr(0,linestart)+"\n"+this.value.substr(selection.start);selection.start=linestart+1;selection.end=linestart+1;DWsetSelection(selection);}else{insertAtCarret(this.id,match[1]);}this.scrollTop+=(this.scrollHeight-scroll);e.preventDefault();return false;}}else if(e.keyCode==8){var match=search.match(/(\n  +)([*-] ?)$/);if(match){var spaces=match[1].length-1;if(spaces>3){this.value=this.value.substr(0,linestart)+this.value.substr(linestart+2);selection.start=selection.start-2;selection.end=selection.start;}else{this.value=this.value.substr(0,linestart)+this.value.substr(selection.start);selection.start=linestart;selection.end=linestart;}DWsetSelection(selection);e.preventDefault();return false;}}else if(e.keyCode==32){var match=search.match(/(\n  +)([*-] )$/);if(match){this.value=this.value.substr(0,linestart)+'  '+this.value.substr(linestart);selection.start=selection.start+2;selection.end=selection.start;DWsetSelection(selection);e.preventDefault();return false;}}}};jQuery(dw_editor.init);var dw_locktimer={timeout:0,draft:false,timerID:null,lasttime:null,msg:LANG.willexpire,pageid:'',init:function(timeout,draft,edid){var $edit;edid=edid||'wiki__text';$edit=jQuery('#'+edid);if($edit.length===0||$edit.attr('readonly')){return;}dw_locktimer.timeout=timeout*1000;dw_locktimer.draft=draft;dw_locktimer.lasttime=new Date();dw_locktimer.pageid=jQuery('#dw__editform').find('input[name=id]').val();if(!dw_locktimer.pageid){return;}$edit.keypress(dw_locktimer.refresh);dw_locktimer.reset();},reset:function(){dw_locktimer.clear();dw_locktimer.timerID=window.setTimeout(dw_locktimer.warning,dw_locktimer.timeout);},warning:function(){dw_locktimer.clear();alert(fixtxt(dw_locktimer.msg));},clear:function(){if(dw_locktimer.timerID!==null){window.clearTimeout(dw_locktimer.timerID);dw_locktimer.timerID=null;}},refresh:function(){var now=new Date(),params='call=lock&id='+dw_locktimer.pageid+'&';if(now.getTime()-dw_locktimer.lasttime.getTime()<=30*1000){return;}if(dw_locktimer.draft&&jQuery('#dw__editform').find('textarea[name=wikitext]').length>0){params+=jQuery('#dw__editform').find('input[name=prefix], '+'textarea[name=wikitext], '+'input[name=suffix], '+'input[name=date]').serialize();}jQuery.post(DOKU_BASE+'lib/exe/ajax.php',params,dw_locktimer.refreshed,'html');dw_locktimer.lasttime=now;},refreshed:function(data){var error=data.charAt(0);data=data.substring(1);jQuery('#draft__status').html(data);if(error!='1'){return;}dw_locktimer.reset();}};var dw_linkwiz={$wiz:null,$entry:null,result:null,timer:null,textArea:null,selected:null,selection:null,init:function($editor){var pos=$editor.position();if(dw_linkwiz.$wiz)return;dw_linkwiz.$wiz=jQuery(document.createElement('div')).dialog({autoOpen:false,draggable:true,title:LANG.linkwiz,resizable:false}).html('<div>'+LANG.linkto+' <input type="text" class="edit" id="link__wiz_entry" autocomplete="off" /></div>'+'<div id="link__wiz_result"></div>').parent().attr('id','link__wiz').css({'position':'absolute','top':(pos.top+20)+'px','left':(pos.left+80)+'px'}).hide().appendTo('.dokuwiki:first');dw_linkwiz.textArea=$editor[0];dw_linkwiz.result=jQuery('#link__wiz_result')[0];jQuery(dw_linkwiz.result).css('position','relative');dw_linkwiz.$entry=jQuery('#link__wiz_entry');if(JSINFO.namespace){dw_linkwiz.$entry.val(JSINFO.namespace+':');}jQuery('#link__wiz .ui-dialog-titlebar-close').click(dw_linkwiz.hide);dw_linkwiz.$entry.keyup(dw_linkwiz.onEntry);jQuery(dw_linkwiz.result).on('click','a',dw_linkwiz.onResultClick);},onEntry:function(e){if(e.keyCode==37||e.keyCode==39){return true;}if(e.keyCode==27){dw_linkwiz.hide();e.preventDefault();e.stopPropagation();return false;}if(e.keyCode==38){dw_linkwiz.select(dw_linkwiz.selected-1);e.preventDefault();e.stopPropagation();return false;}if(e.keyCode==40){dw_linkwiz.select(dw_linkwiz.selected+1);e.preventDefault();e.stopPropagation();return false;}if(e.keyCode==13){if(dw_linkwiz.selected>-1){var $obj=dw_linkwiz.$getResult(dw_linkwiz.selected);if($obj.length>0){dw_linkwiz.resultClick($obj.find('a')[0]);}}else if(dw_linkwiz.$entry.val()){dw_linkwiz.insertLink(dw_linkwiz.$entry.val());}e.preventDefault();e.stopPropagation();return false;}dw_linkwiz.autocomplete();},getResult:function(num){DEPRECATED('use dw_linkwiz.$getResult()[0] instead');return dw_linkwiz.$getResult()[0]||null;},$getResult:function(num){return jQuery(dw_linkwiz.result).find('div').eq(num);},select:function(num){if(num<0){dw_linkwiz.deselect();return;}var $obj=dw_linkwiz.$getResult(num);if($obj.length===0){return;}dw_linkwiz.deselect();$obj.addClass('selected');var childPos=$obj.position().top;var yDiff=childPos+$obj.outerHeight()-jQuery(dw_linkwiz.result).innerHeight();if(childPos<0){jQuery(dw_linkwiz.result)[0].scrollTop+=childPos;}else if(yDiff>0){jQuery(dw_linkwiz.result)[0].scrollTop+=yDiff;}dw_linkwiz.selected=num;},deselect:function(){if(dw_linkwiz.selected>-1){dw_linkwiz.$getResult(dw_linkwiz.selected).removeClass('selected');}dw_linkwiz.selected=-1;},onResultClick:function(e){if(!jQuery(this).is('a')){return;}e.stopPropagation();e.preventDefault();dw_linkwiz.resultClick(this);return false;},resultClick:function(a){dw_linkwiz.$entry.val(a.title);if(a.title==''||a.title.substr(a.title.length-1)==':'){dw_linkwiz.autocomplete_exec();}else{if(jQuery(a.nextSibling).is('span')){dw_linkwiz.insertLink(a.nextSibling.innerHTML);}else{dw_linkwiz.insertLink('');}}},insertLink:function(title){var link=dw_linkwiz.$entry.val(),sel,stxt;if(!link){return;}sel=DWgetSelection(dw_linkwiz.textArea);if(sel.start==0&&sel.end==0){sel=dw_linkwiz.selection;}stxt=sel.getText();if(stxt.charAt(stxt.length-1)==' '){sel.end--;stxt=sel.getText();}if(!stxt&&!DOKU_UHC){stxt=title;}if(dw_linkwiz.textArea.form.id.value.indexOf(':')!=-1&&link.indexOf(':')==-1){link=':'+link;}var so=link.length;var eo=0;if(dw_linkwiz.val){if(dw_linkwiz.val.open){so+=dw_linkwiz.val.open.length;link=dw_linkwiz.val.open+link;}link+='|';so+=1;if(stxt){link+=stxt;}if(dw_linkwiz.val.close){link+=dw_linkwiz.val.close;eo=dw_linkwiz.val.close.length;}}pasteText(sel,link,{startofs:so,endofs:eo});dw_linkwiz.hide();var externallinkpattern=new RegExp('^((f|ht)tps?:)?//','i'),entry_value;if(externallinkpattern.test(dw_linkwiz.$entry.val())){if(JSINFO.namespace){entry_value=JSINFO.namespace+':';}else{entry_value='';}}else{entry_value=dw_linkwiz.$entry.val().replace(/[^:]*$/,'')}dw_linkwiz.$entry.val(entry_value);},autocomplete:function(){if(dw_linkwiz.timer!==null){window.clearTimeout(dw_linkwiz.timer);dw_linkwiz.timer=null;}dw_linkwiz.timer=window.setTimeout(dw_linkwiz.autocomplete_exec,350);},autocomplete_exec:function(){var $res=jQuery(dw_linkwiz.result);dw_linkwiz.deselect();$res.html('<img src="'+DOKU_BASE+'lib/images/throbber.gif" alt="" width="16" height="16" />').load(DOKU_BASE+'lib/exe/ajax.php',{call:'linkwiz',q:dw_linkwiz.$entry.val()});},show:function(){dw_linkwiz.selection=DWgetSelection(dw_linkwiz.textArea);dw_linkwiz.$wiz.show();dw_linkwiz.$entry.focus();dw_linkwiz.autocomplete();var temp=dw_linkwiz.$entry.val();dw_linkwiz.$entry.val('');dw_linkwiz.$entry.val(temp);},hide:function(){dw_linkwiz.$wiz.hide();dw_linkwiz.textArea.focus();},toggle:function(){if(dw_linkwiz.$wiz.css('display')=='none'){dw_linkwiz.show();}else{dw_linkwiz.hide();}}};var dw_mediamanager={keepopen:false,hide:false,popup:false,display:false,ext:false,$popup:null,align:false,link:false,size:false,forbidden_opts:{},view_opts:{list:false,sort:false},layout_width:0,minHeights:{thumbs:200,rows:100},init:function(){var $content,$tree;$content=jQuery('#media__content');$tree=jQuery('#media__tree');if(!$tree.length)return;dw_mediamanager.prepare_content($content);dw_mediamanager.attachoptions();dw_mediamanager.initpopup();$content .on('change','#upload__file',dw_mediamanager.suggest).on('click','a.select',dw_mediamanager.select).on('click','#media__content a.btn_media_delete',dw_mediamanager.confirmattach).on('submit','#mediamanager__done_form',dw_mediamanager.list);$tree.dw_tree({toggle_selector:'img',load_data:function(show_sublist,$clicky){var $link=$clicky.parent().find('div.li a.idx_dir');jQuery.post(DOKU_BASE+'lib/exe/ajax.php',$link[0].search.substr(1)+'&call=medians',show_sublist,'html');},toggle_display:function($clicky,opening){$clicky.attr('src',DOKU_BASE+'lib/images/'+(opening?'minus':'plus')+'.gif');}});$tree.on('click','a',dw_mediamanager.list);dw_mediamanager.set_fileview_list();dw_mediamanager.init_options();dw_mediamanager.image_diff();dw_mediamanager.init_ajax_uploader();var $page=jQuery('#mediamanager__page');$page.find('div.filelist').on('click','ul.tabs a',dw_mediamanager.list).on('click','div.panelContent a',dw_mediamanager.details).on('submit','#dw__mediasearch',dw_mediamanager.list).on('change','#upload__file',dw_mediamanager.suggest).on('click','.qq-upload-file a',dw_mediamanager.details);$page.find('div.file').on('click','ul.tabs a',dw_mediamanager.details).on('submit','#mediamanager__btn_update',dw_mediamanager.list).on('submit','#page__revisions',dw_mediamanager.details).on('click','#page__revisions a',dw_mediamanager.details).on('submit','#mediamanager__save_meta',dw_mediamanager.details).on('submit','#mediamanager__btn_delete',dw_mediamanager.details).on('submit','#mediamanager__btn_restore',dw_mediamanager.details).on('submit','.btn_newer, .btn_older',dw_mediamanager.details);dw_mediamanager.update_resizable();dw_mediamanager.layout_width=$page.width();jQuery(window).resize(dw_mediamanager.window_resize);},init_options:function(){var $options=jQuery('div.filelist div.panelHeader form.options'),$listType,$sortBy,$both;if($options.length===0){return;}$listType=$options.find('li.listType');$sortBy=$options.find('li.sortBy');$both=$listType.add($sortBy);$options.find('button[type=submit]').parent().hide();$both.find('label').each(function(){var $this=jQuery(this);$this.children('input').appendTo($this.parent());});$both.find("input[type='radio']").checkboxradio({icon:false});$both.controlgroup();$listType.children('input').change(function(){dw_mediamanager.set_fileview_list();});$sortBy.children('input').change(function(event){dw_mediamanager.set_fileview_sort();dw_mediamanager.list.call(jQuery('#dw__mediasearch')[0]||this,event);});},initpopup:function(){var opts,$insp,$insbtn;dw_mediamanager.$popup=jQuery(document.createElement('div')).attr('id','media__popup_content').dialog({autoOpen:false,width:280,modal:true,draggable:true,title:LANG.mediatitle,resizable:false});opts=[{id:'link',label:LANG.mediatarget,btns:['lnk','direct','nolnk','displaylnk']},{id:'align',label:LANG.mediaalign,btns:['noalign','left','center','right']},{id:'size',label:LANG.mediasize,btns:['small','medium','large','original']}];jQuery.each(opts,function(_,opt){var $p,$l;$p=jQuery(document.createElement('p')).attr('id','media__'+opt.id);if(dw_mediamanager.display==="2"){$p.hide();}$l=jQuery(document.createElement('label')).text(opt.label);$p.append($l);jQuery.each(opt.btns,function(i,text){var $btn,$img;$btn=jQuery(document.createElement('button')).addClass('button').attr('id',"media__"+opt.id+"btn"+(i+1)).attr('title',LANG['media'+text]).click(bind(dw_mediamanager.setOpt,opt.id));$img=jQuery(document.createElement('img')).attr('src',DOKU_BASE+'lib/images/media_'+opt.id+'_'+text+'.png');$btn.append($img);$p.append($btn);});dw_mediamanager.$popup.append($p);});$insp=jQuery(document.createElement('p'));dw_mediamanager.$popup.append($insp);$insbtn=jQuery(document.createElement('input')).attr('id','media__sendbtn').attr('type','button').addClass('button').val(LANG.mediainsert);$insp.append($insbtn);},insert:function(id){var opts,cb,edid,s;dw_mediamanager.$popup.dialog('close');opts='';if({img:1,swf:1}[dw_mediamanager.ext]===1){if(dw_mediamanager.link==='4'){opts='?linkonly';}else{if(dw_mediamanager.link==="3"&&dw_mediamanager.ext==='img'){opts='?nolink';}else if(dw_mediamanager.link==="2"&&dw_mediamanager.ext==='img'){opts='?direct';}s=parseInt(dw_mediamanager.size,10);var size=s*200;if(s&&s>=1&&s<4){opts+=(opts.length)?'&':'?';opts+=size;if(dw_mediamanager.ext==='swf'){switch(s){case 1:opts+='x62';break;case 2:opts+='x123';break;case 3:opts+='x185';break;}}}}}edid=String.prototype.match.call(document.location,/&edid=([^&]+)/);edid=edid?edid[1]:'wiki__text';cb=String.prototype.match.call(document.location,/&onselect=([^&]+)/);cb=cb?cb[1].replace(/[^\w]+/,''):'dw_mediamanager_item_select';opener[cb](edid,id,opts,dw_mediamanager.align);if(!dw_mediamanager.keepopen){window.close();}opener.focus();return false;},suggest:function(){var $file,$name,text;$file=jQuery(this);$name=jQuery('#upload__name');if($name.val()!='')return;if(!$file.length||!$name.length){return;}text=$file.val();text=text.substr(text.lastIndexOf('/')+1);text=text.substr(text.lastIndexOf('\\')+1);$name.val(text);},list:function(event){var $link,$content,params;if(event){event.preventDefault();}jQuery('div.success, div.info, div.error, div.notify').remove();$link=jQuery(this);$content=jQuery('#media__content');if($content.length===0){$content=jQuery('div.filelist');if($link.hasClass('idx_dir')){jQuery('div.file').empty();jQuery('div.namespaces .selected').removeClass('selected');$link.addClass('selected');}}params='call=medialist&';if($link[0].search){params+=$link[0].search.substr(1);}else if($link.is('form')){params+=dw_mediamanager.form_params($link);}else if($link.closest('form').length>0){params+=dw_mediamanager.form_params($link.closest('form'));}dw_mediamanager.update_content($content,params);},form_params:function($form){if(!$form.length)return;var action='';var i=$form[0].action.indexOf('?');if(i>=0){action=$form[0].action.substr(i+1);}return action+'&'+$form.serialize();},set_fileview_list:function(new_type){dw_mediamanager.set_fileview_opt(['list','listType',function(new_type){jQuery('div.filelist div.panelContent ul').toggleClass('rows',new_type==='rows').toggleClass('thumbs',new_type==='thumbs');}],new_type);dw_mediamanager.resize();},set_fileview_sort:function(new_sort){dw_mediamanager.set_fileview_opt(['sort','sortBy',function(new_sort){}],new_sort);},set_fileview_opt:function(opt,new_val){if(typeof new_val==='undefined'){new_val=jQuery('form.options li.'+opt[1]+' input').filter(':checked').val();if(typeof new_val==='undefined'){new_val='thumbs';}}if(new_val!==dw_mediamanager.view_opts[opt[0]]){opt[2](new_val);DokuCookie.setValue(opt[0],new_val);dw_mediamanager.view_opts[opt[0]]=new_val;}},details:function(event){var $link,$content,params,update_list;$link=jQuery(this);event.preventDefault();jQuery('div.success, div.info, div.error, div.notify').remove();if($link[0].id=='mediamanager__btn_delete'&&!confirm(LANG.del_confirm)){return false;}if($link[0].id=='mediamanager__btn_restore'&&!confirm(LANG.restore_confirm)){return false;}$content=jQuery('div.file');params='call=mediadetails&';if($link[0].search){params+=$link[0].search.substr(1);}else if($link.is('form')){params+=dw_mediamanager.form_params($link);}else if($link.closest('form').length>0){params+=dw_mediamanager.form_params($link.closest('form'));}update_list=($link[0].id=='mediamanager__btn_delete'||$link[0].id=='mediamanager__btn_restore');dw_mediamanager.update_content($content,params,update_list);},update_content:function($content,params,update_list){var $container;jQuery.post(DOKU_BASE+'lib/exe/ajax.php',params,function(data){dw_mediamanager.$resizables().resizable('destroy');if(update_list){dw_mediamanager.list.call(jQuery('#mediamanager__page').find('form.options button[type="submit"]')[0]);}$content.html(data);dw_mediamanager.prepare_content($content);dw_mediamanager.updatehide();dw_mediamanager.update_resizable();dw_behaviour.revisionBoxHandler();dw_mediamanager.set_fileview_list(dw_mediamanager.view_opts.list);dw_mediamanager.image_diff();dw_mediamanager.init_ajax_uploader();dw_mediamanager.init_options();},'html');$container=$content.find('div.panelContent');if($container.length===0){$container=$content;}$container.html('<img src="'+DOKU_BASE+'lib/images/loading.gif" alt="..." class="load" />');},window_resize:function(){dw_mediamanager.resize();dw_mediamanager.opacity_slider();dw_mediamanager.portions_slider();},$resizables:function(){return jQuery('#mediamanager__page').find('div.namespaces, div.filelist');},update_resizable:function(){var $resizables=dw_mediamanager.$resizables();$resizables.resizable({handles:(jQuery('html[dir=rtl]').length?'w':'e'),resize:function(event,ui){var $page=jQuery('#mediamanager__page');var widthFull=$page.width();var widthResizables=0;$resizables.each(function(){widthResizables+=jQuery(this).width();});var $filePanel=$page.find('div.panel.file');var widthOtherResizable=widthResizables-jQuery(this).width();var minWidthNonResizable=parseFloat($filePanel.css("min-width"));var maxWidth=widthFull-(widthOtherResizable+minWidthNonResizable)-1;$resizables.resizable("option","maxWidth",maxWidth);var relWidthNonResizable=99.9-(100*widthResizables/widthFull);$filePanel.width(relWidthNonResizable+'%');dw_mediamanager.resize();dw_mediamanager.opacity_slider();dw_mediamanager.portions_slider();}});dw_mediamanager.resize();},resize:function(){var $contents=jQuery('#mediamanager__page').find('div.panelContent'),height=jQuery(window).height()-jQuery(document.body).height()+Math.max.apply(null,jQuery.map($contents,function(v){return jQuery(v).height();}));if(height<dw_mediamanager.minHeights[dw_mediamanager.view_opts.list]){$contents.add(dw_mediamanager.$resizables()).height('auto');}else{$contents.height(height);dw_mediamanager.$resizables().each(function(){var $this=jQuery(this);$this.height(height+$this.find('div.panelContent').offset().top-$this.offset().top);});}},image_diff:function(){if(jQuery('#mediamanager__difftype').length)return;var $form=jQuery('#mediamanager__form_diffview');if(!$form.length)return;var $label=jQuery(document.createElement('label'));$label.append('<span>'+LANG.media_diff+'</span> ');var $select=jQuery(document.createElement('select')).attr('id','mediamanager__difftype').attr('name','difftype').change(dw_mediamanager.change_diff_type);$select.append(new Option(LANG.media_diff_both,"both"));$select.append(new Option(LANG.media_diff_opacity,"opacity"));$select.append(new Option(LANG.media_diff_portions,"portions"));$label.append($select);$form.append($label);var select=document.getElementById('mediamanager__difftype');select.options[0].text=LANG.media_diff_both;select.options[1].text=LANG.media_diff_opacity;select.options[2].text=LANG.media_diff_portions;},change_diff_type:function(){var $select=jQuery('#mediamanager__difftype');var $content=jQuery('#mediamanager__diff');var params=dw_mediamanager.form_params($select.closest('form'))+'&call=mediadiff';jQuery.post(DOKU_BASE+'lib/exe/ajax.php',params,function(data){$content.html(data);dw_mediamanager.portions_slider();dw_mediamanager.opacity_slider();},'html');},opacity_slider:function(){var $diff=jQuery("#mediamanager__diff");var $slider=$diff.find("div.slider");if(!$slider.length)return;var $image=$diff.find('div.imageDiff.opacity div.image1 img');if(!$image.length)return;$slider.width($image.width()-20);$slider.slider();$slider.slider("option","min",0);$slider.slider("option","max",0.999);$slider.slider("option","step",0.001);$slider.slider("option","value",0.5);$slider.on("slide",function(event,ui){jQuery('#mediamanager__diff').find('div.imageDiff.opacity div.image2 img').css({opacity:$slider.slider("option","value")});});},portions_slider:function(){var $diff=jQuery("#mediamanager__diff");if(!$diff.length)return;var $image1=$diff.find('div.imageDiff.portions div.image1 img');var $image2=$diff.find('div.imageDiff.portions div.image2 img');if(!$image1.length||!$image2.length)return;$diff.width('100%');$image2.parent().width('97%');$image1.width('100%');$image2.width('100%');if($image1.width()<$diff.width()){$diff.width($image1.width());}$image2.parent().width('50%');$image2.width($image1.width());$image1.width($image1.width());var $slider=$diff.find("div.slider");if(!$slider.length)return;$slider.width($image1.width()-20);$slider.slider();$slider.slider("option","min",0);$slider.slider("option","max",97);$slider.slider("option","step",1);$slider.slider("option","value",50);$slider.on("slide",function(event,ui){jQuery('#mediamanager__diff').find('div.imageDiff.portions div.image2').css({width:$slider.slider("option","value")+'%'});});},params_toarray:function(str){var vars=[],hash;var hashes=str.split('&');for(var i=0;i<hashes.length;i++){hash=hashes[i].split('=');vars[decodeURIComponent(hash[0])]=decodeURIComponent(hash[1]);}return vars;},init_ajax_uploader:function(){if(!jQuery('#mediamanager__uploader').length)return;if(jQuery('.qq-upload-list').length)return;var params=dw_mediamanager.form_params(jQuery('#dw__upload'))+'&call=mediaupload';params=dw_mediamanager.params_toarray(params);var uploader=new qq.FileUploaderExtended({element:document.getElementById('mediamanager__uploader'),action:DOKU_BASE+'lib/exe/ajax.php',params:params});},prepare_content:function($content){$content.find('div.example:visible').hide();},select:function(event){var $link,id,dot,ext;event.preventDefault();$link=jQuery(this);id=$link.attr('id').substr(2);if(!opener){jQuery(document.getElementById('ex_'+id.replace(/:/g,'_').replace(/^_/,''))).dw_toggle();return;}dw_mediamanager.ext=false;dot=id.lastIndexOf(".");if(-1===dot){dw_mediamanager.insert(id);return;}ext=id.substr(dot);if({'.jpg':1,'.jpeg':1,'.png':1,'.gif':1,'.swf':1}[ext]!==1){dw_mediamanager.insert(id);return;}var $sendbtn=jQuery('#media__sendbtn');$sendbtn.off().click(bind(dw_mediamanager.insert,id));dw_mediamanager.unforbid('ext');if(ext==='.swf'){dw_mediamanager.ext='swf';dw_mediamanager.forbid('ext',{link:['1','2'],size:['4']});}else{dw_mediamanager.ext='img';}dw_mediamanager.setOpt('link');dw_mediamanager.setOpt('align');dw_mediamanager.setOpt('size');jQuery('#media__linkbtn1, #media__linkbtn2, #media__sizebtn4').toggle(dw_mediamanager.ext==='img');dw_mediamanager.$popup.dialog('open');$sendbtn.focus();},confirmattach:function(e){if(!confirm(LANG.del_confirm+"\n"+jQuery(this).attr('title'))){e.preventDefault();}},attachoptions:function(){var $obj,opts;$obj=jQuery('#media__opts');if($obj.length===0){return;}opts=[];if(opener){opts.push(['keepopen','keepopen']);}opts.push(['hide','hidedetails']);jQuery.each(opts,function(_,opt){var $box,$lbl;$box=jQuery(document.createElement('input')).attr('type','checkbox').attr('id','media__'+opt[0]).click(bind(dw_mediamanager.toggleOption,opt[0]));if(DokuCookie.getValue(opt[0])){$box.prop('checked',true);dw_mediamanager[opt[0]]=true;}$lbl=jQuery(document.createElement('label')).attr('for','media__'+opt[0]).text(LANG[opt[1]]);$obj.append($box,$lbl,document.createElement('br'));});dw_mediamanager.updatehide();},toggleOption:function(variable){if(jQuery(this).prop('checked')){DokuCookie.setValue(variable,1);dw_mediamanager[variable]=true;}else{DokuCookie.setValue(variable,'');dw_mediamanager[variable]=false;}if(variable==='hide'){dw_mediamanager.updatehide();}},updatehide:function(){jQuery('#media__content').find('div.detail').dw_toggle(!dw_mediamanager.hide);},setOpt:function(opt,e){var val,i;if(typeof e!=='undefined'){val=this.id.substring(this.id.length-1);}else{val=dw_mediamanager.getOpt(opt);}if(val===false){DokuCookie.setValue(opt,'');dw_mediamanager[opt]=false;return;}if(opt==='link'){if(val!=='4'&&dw_mediamanager.link==='4'){dw_mediamanager.unforbid('linkonly');dw_mediamanager.setOpt('align');dw_mediamanager.setOpt('size');}else if(val==='4'){dw_mediamanager.forbid('linkonly',{align:false,size:false});}jQuery("#media__size, #media__align").dw_toggle(val!=='4');}DokuCookie.setValue(opt,val);dw_mediamanager[opt]=val;for(i=1;i<=4;i++){jQuery("#media__"+opt+"btn"+i).removeClass('selected');}jQuery('#media__'+opt+'btn'+val).addClass('selected');},unforbid:function(group){delete dw_mediamanager.forbidden_opts[group];},forbid:function(group,forbids){dw_mediamanager.forbidden_opts[group]=forbids;},allowedOpt:function(opt,val){var ret=true;jQuery.each(dw_mediamanager.forbidden_opts,function(_,forbids){ret=forbids[opt]!==false&&jQuery.inArray(val,forbids[opt])===-1;return ret;});return ret;},getOpt:function(opt){var allowed=bind(dw_mediamanager.allowedOpt,opt);if(dw_mediamanager[opt]!==false&&allowed(dw_mediamanager[opt])){return dw_mediamanager[opt];}if(DokuCookie.getValue(opt)&&allowed(DokuCookie.getValue(opt))){return DokuCookie.getValue(opt);}if(opt==='size'&&allowed('2')){return'2';}return jQuery.grep(['1','2','3','4'],allowed)[0]||false;}};function dw_mediamanager_item_select(edid,mediaid,opts,align){var alignleft='';var alignright='';if(align!=='1'){alignleft=align==='2'?'':' ';alignright=align==='4'?'':' ';}insertTags(edid,'{{'+alignleft+mediaid+opts+alignright+'|','}}','');}jQuery(dw_mediamanager.init);function DEPRECATED(msg){if(!window.console)return;if(!msg)msg='';var func;if(arguments.callee)func=arguments.callee.caller.name;if(func)func=' '+func+'()';var line='DEPRECATED function call'+func+'. '+msg;if(console.warn){console.warn(line);}else{console.log(line);}if(console.trace)console.trace();}function DEPRECATED_WRAP(func,context){return function(){DEPRECATED();return func.apply(context||this,arguments);};}jQuery.fn.dw_hide=function(fn,noaria){if(!noaria)this.attr('aria-expanded','false');return this.slideUp('fast',fn);};jQuery.fn.dw_show=function(fn,noaria){if(!noaria)this.attr('aria-expanded','true');return this.slideDown('fast',fn);};jQuery.fn.dw_toggle=function(state,fn,noaria){return this.each(function(){var $this=jQuery(this);if(typeof state==='undefined'){state=$this.is(':hidden');}$this[state?"dw_show":"dw_hide"](fn,noaria);});};var dw_behaviour={init:function(){dw_behaviour.focusMarker();dw_behaviour.scrollToMarker();dw_behaviour.removeHighlightOnClick();dw_behaviour.quickSelect();dw_behaviour.checkWindowsShares();dw_behaviour.subscription();dw_behaviour.revisionBoxHandler();jQuery(document).on('click','#page__revisions input[type=checkbox]',dw_behaviour.revisionBoxHandler);jQuery('.bounce').effect('bounce',{times:10},2000);},scrollToMarker:function(){var $obj=jQuery('#scroll__here');if($obj.length){if($obj.offset().top!=0){jQuery('html, body').animate({scrollTop:$obj.offset().top-100},500);}else{$obj[0].scrollIntoView();}}},focusMarker:function(){jQuery('#focus__this').focus();},removeHighlightOnClick:function(){jQuery('span.search_hit').click(function(e){jQuery(e.target).removeClass('search_hit',1000);});},quickSelect:function(){jQuery('select.quickselect').change(function(e){e.target.form.submit();}).closest('form').find(':button').not('.show').hide();},checkWindowsShares:function(){if(!LANG.nosmblinks||navigator.userAgent.match(/(Trident|MSIE)/)){return;}jQuery('a.windows').on('click',function(){alert(LANG.nosmblinks.replace(/\\n/,"\n"));});},subscription:function(){var $form,$list,$digest;$form=jQuery('#subscribe__form');if(0===$form.length)return;$list=$form.find("input[name='sub_style'][value='list']");$digest=$form.find("input[name='sub_style'][value='digest']");$form.find("input[name='sub_target']").click(function(){var $this=jQuery(this),show_list;if(!$this.prop('checked')){return;}show_list=$this.val().match(/:$/);$list.parent().dw_toggle(show_list);if(!show_list&&$list.prop('checked')){$digest.prop('checked','checked');}}).filter(':checked').click();},revisionBoxHandler:function(){var $revisions=jQuery('#page__revisions');var $all=jQuery('input[type=checkbox]',$revisions);var $checked=$all.filter(':checked');var $button=jQuery('button',$revisions);if($checked.length<2){$all.removeAttr('disabled');$button.attr('disabled',true);}else{$all.attr('disabled',true);$button.removeAttr('disabled');$checked.each(function(i){jQuery(this).removeAttr('disabled');if(i>1){jQuery(this).attr('checked',false);}});}}};jQuery(dw_behaviour.init);dw_page={init:function(){dw_page.sectionHighlight();jQuery('a.fn_top').mouseover(dw_page.footnoteDisplay);dw_page.makeToggle('#dw__toc h3','#dw__toc > div');},sectionHighlight:function(){jQuery('form.btn_secedit').mouseover(function(){var $tgt=jQuery(this).parent(),nr=$tgt.attr('class').match(/(\s+|^)editbutton_(\d+)(\s+|$)/)[2],$highlight=jQuery(),$highlightWrap=jQuery('<div class="section_highlight"></div>');while($tgt.length>0&&!($tgt.hasClass('sectionedit'+nr)||$tgt.find('.sectionedit'+nr).length)){$tgt=$tgt.prev();$highlight=$highlight.add($tgt);}$highlight.filter(':last').before($highlightWrap);$highlight.detach().appendTo($highlightWrap);}).mouseout(function(){var $highlightWrap=jQuery('.section_highlight');$highlightWrap.before($highlightWrap.children().detach());$highlightWrap.detach();});},insituPopup:function(target,popup_id){var $fndiv=jQuery('#'+popup_id);if($fndiv.length===0){$fndiv=jQuery(document.createElement('div')).attr('id',popup_id).addClass('insitu-footnote JSpopup').attr('aria-hidden','true').mouseleave(function(){jQuery(this).hide().attr('aria-hidden','true');}).attr('role','tooltip');jQuery('.dokuwiki:first').append($fndiv);}$fndiv.show().position({my:'left top',at:'left center',of:target}).hide();return $fndiv;},footnoteDisplay:function(){var $content=jQuery(jQuery(this).attr('href')).parent().siblings('.content').clone();if(!$content){return;}jQuery('[id]',$content).each(function(){var id=jQuery(this).attr('id');jQuery(this).attr('id','insitu__'+id);});var content=$content.html().trim();dw_page.insituPopup(this,'insitu__fn').html(content).show().attr('aria-hidden','false');},makeToggle:function(handle,content,state){var $handle,$content,$clicky,$child,setClicky;$handle=jQuery(handle);if(!$handle.length)return;$content=jQuery(content);if(!$content.length)return;$child=$content.children();setClicky=function(hiding){if(hiding){$clicky.html('<span>+</span>');$handle.addClass('closed');$handle.removeClass('open');}else{$clicky.html('<span>−</span>');$handle.addClass('open');$handle.removeClass('closed');}};$handle[0].setState=function(state){var hidden;if(!state)state=1;$content.css('min-height',$content.height()).show();$child.stop(true,true);if(state===-1){hidden=false;}else if(state===1){hidden=true;}else{hidden=$child.is(':hidden');}setClicky(!hidden);$child.dw_toggle(hidden,function(){$content.toggle(hidden);$content.attr('aria-expanded',hidden);$content.css('min-height','');},true);};$clicky=jQuery(document.createElement('strong'));$handle.css('cursor','pointer').click($handle[0].setState).prepend($clicky);$handle[0].setState(state);}};jQuery(dw_page.init);var device_class='';var device_classes='desktop mobile tablet phone';function tpl_dokuwiki_mobile(){var screen_mode=jQuery('#screen__mode').css('z-index')+'';switch(screen_mode){case'1':if(device_class.match(/tablet/))return;device_class='mobile tablet';break;case'2':if(device_class.match(/phone/))return;device_class='mobile phone';break;default:if(device_class=='desktop')return;device_class='desktop';}jQuery('html').removeClass(device_classes).addClass(device_class);var $handle=jQuery('#dokuwiki__aside h3.toggle');var $toc=jQuery('#dw__toc h3');if(device_class=='desktop'){if($handle.length){$handle[0].setState(1);$handle.hide();}if($toc.length){$toc[0].setState(1);}}if(device_class.match(/mobile/)){if($handle.length){$handle.show();$handle[0].setState(-1);}if($toc.length){$toc[0].setState(-1);}}}jQuery(function(){var resizeTimer;dw_page.makeToggle('#dokuwiki__aside h3.toggle','#dokuwiki__aside div.content');tpl_dokuwiki_mobile();jQuery(window).on('resize',function(){if(resizeTimer)clearTimeout(resizeTimer);resizeTimer=setTimeout(tpl_dokuwiki_mobile,200);});var $sidebar=jQuery('.desktop #dokuwiki__aside');if($sidebar.length){var $content=jQuery('#dokuwiki__content div.page');$content.css('min-height',$sidebar.height());}});(function($,undef){var _html,nonGradientIE,gradientType,vendorPrefixes,_css,Iris,UA,isIE,IEVersion;_html='<div class="iris-picker"><div class="iris-picker-inner"><div class="iris-square"><a class="iris-square-value" href="#"><span class="iris-square-handle ui-slider-handle"></span></a><div class="iris-square-inner iris-square-horiz"></div><div class="iris-square-inner iris-square-vert"></div></div><div class="iris-slider iris-strip"><div class="iris-slider-offset"></div></div></div></div>';_css='.iris-picker{display:block;position:relative}.iris-picker,.iris-picker *{-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input+.iris-picker{margin-top:4px}.iris-error{background-color:#ffafaf}.iris-border{border-radius:3px;border:1px solid #aaa;width:200px;background-color:#fff}.iris-picker-inner{position:absolute;top:0;right:0;left:0;bottom:0}.iris-border .iris-picker-inner{top:10px;right:10px;left:10px;bottom:10px}.iris-picker .iris-square-inner{position:absolute;left:0;right:0;top:0;bottom:0}.iris-picker .iris-square,.iris-picker .iris-slider,.iris-picker .iris-square-inner,.iris-picker .iris-palette{border-radius:3px;box-shadow:inset 0 0 5px rgba(0,0,0,.4);height:100%;width:12.5%;float:left;margin-right:5%}.iris-picker .iris-square{width:76%;margin-right:10%;position:relative}.iris-picker .iris-square-inner{width:auto;margin:0}.iris-ie-9 .iris-square,.iris-ie-9 .iris-slider,.iris-ie-9 .iris-square-inner,.iris-ie-9 .iris-palette{box-shadow:none;border-radius:0}.iris-ie-9 .iris-square,.iris-ie-9 .iris-slider,.iris-ie-9 .iris-palette{outline:1px solid rgba(0,0,0,.1)}.iris-ie-lt9 .iris-square,.iris-ie-lt9 .iris-slider,.iris-ie-lt9 .iris-square-inner,.iris-ie-lt9 .iris-palette{outline:1px solid #aaa}.iris-ie-lt9 .iris-square .ui-slider-handle{outline:1px solid #aaa;background-color:#fff;-ms-filter:"alpha(Opacity=30)"}.iris-ie-lt9 .iris-square .iris-square-handle{background:0;border:3px solid #fff;-ms-filter:"alpha(Opacity=50)"}.iris-picker .iris-strip{margin-right:0;position:relative}.iris-picker .iris-strip .ui-slider-handle{position:absolute;background:0;margin:0;right:-3px;left:-3px;border:4px solid #aaa;border-width:4px 3px;width:auto;height:6px;border-radius:4px;box-shadow:0 1px 2px rgba(0,0,0,.2);opacity:.9;z-index:5;cursor:ns-resize}.iris-strip .ui-slider-handle:before{content:" ";position:absolute;left:-2px;right:-2px;top:-3px;bottom:-3px;border:2px solid #fff;border-radius:3px}.iris-picker .iris-slider-offset{position:absolute;top:11px;left:0;right:0;bottom:-3px;width:auto;height:auto;background:transparent;border:0;border-radius:0}.iris-picker .iris-square-handle{background:transparent;border:5px solid #aaa;border-radius:50%;border-color:rgba(128,128,128,.5);box-shadow:none;width:12px;height:12px;position:absolute;left:-10px;top:-10px;cursor:move;opacity:1;z-index:10}.iris-picker .ui-state-focus .iris-square-handle{opacity:.8}.iris-picker .iris-square-handle:hover{border-color:#999}.iris-picker .iris-square-value:focus .iris-square-handle{box-shadow:0 0 2px rgba(0,0,0,.75);opacity:.8}.iris-picker .iris-square-handle:hover::after{border-color:#fff}.iris-picker .iris-square-handle::after{position:absolute;bottom:-4px;right:-4px;left:-4px;top:-4px;border:3px solid #f9f9f9;border-color:rgba(255,255,255,.8);border-radius:50%;content:" "}.iris-picker .iris-square-value{width:8px;height:8px;position:absolute}.iris-ie-lt9 .iris-square-value,.iris-mozilla .iris-square-value{width:1px;height:1px}.iris-palette-container{position:absolute;bottom:0;left:0;margin:0;padding:0}.iris-border .iris-palette-container{left:10px;bottom:10px}.iris-picker .iris-palette{margin:0;cursor:pointer}.iris-square-handle,.ui-slider-handle{border:0;outline:0}';UA=navigator.userAgent.toLowerCase();isIE=navigator.appName==='Microsoft Internet Explorer';IEVersion=isIE?parseFloat(UA.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0;nonGradientIE=(isIE&&IEVersion<10);gradientType=false;vendorPrefixes=['-moz-','-webkit-','-o-','-ms-'];if(nonGradientIE&&IEVersion<=7){$.fn.iris=$.noop;$.support.iris=false;return;}$.support.iris=true;function testGradientType(){var el,base,bgImageString='backgroundImage';if(nonGradientIE){gradientType='filter';}else{el=$('<div id="iris-gradtest" />');base='linear-gradient(top,#fff,#000)';$.each(vendorPrefixes,function(i,val){el.css(bgImageString,val+base);if(el.css(bgImageString).match('gradient')){gradientType=i;return false;}});if(gradientType===false){el.css('background','-webkit-gradient(linear,0% 0%,0% 100%,from(#fff),to(#000))');if(el.css(bgImageString).match('gradient')){gradientType='webkit';}}el.remove();}}function createGradient(origin,stops){origin=(origin==='top')?'top':'left';stops=$.isArray(stops)?stops:Array.prototype.slice.call(arguments,1);if(gradientType==='webkit'){return legacyWebkitGradient(origin,stops);}else{return vendorPrefixes[gradientType]+'linear-gradient('+origin+', '+stops.join(', ')+')';}}function stupidIEGradient(origin,stops){var type,self,lastIndex,filter,startPosProp,endPosProp,dimensionProp,template,html;origin=(origin==='top')?'top':'left';stops=$.isArray(stops)?stops:Array.prototype.slice.call(arguments,1);type=(origin==='top')?0:1;self=$(this);lastIndex=stops.length-1;filter='filter';startPosProp=(type===1)?'left':'top';endPosProp=(type===1)?'right':'bottom';dimensionProp=(type===1)?'height':'width';template='<div class="iris-ie-gradient-shim" style="position:absolute;'+dimensionProp+':100%;'+startPosProp+':%start%;'+endPosProp+':%end%;'+filter+':%filter%;" data-color:"%color%"></div>';html='';if(self.css('position')==='static'){self.css({position:'relative'});}stops=fillColorStops(stops);$.each(stops,function(i,startColor){var endColor,endStop,filterVal;if(i===lastIndex){return false;}endColor=stops[i+1];if(startColor.stop===endColor.stop){return;}endStop=100-parseFloat(endColor.stop)+'%';startColor.octoHex=new Color(startColor.color).toIEOctoHex();endColor.octoHex=new Color(endColor.color).toIEOctoHex();filterVal='progid:DXImageTransform.Microsoft.Gradient(GradientType='+type+', StartColorStr=\''+startColor.octoHex+'\', EndColorStr=\''+endColor.octoHex+'\')';html+=template.replace('%start%',startColor.stop).replace('%end%',endStop).replace('%filter%',filterVal);});self.find('.iris-ie-gradient-shim').remove();$(html).prependTo(self);}function legacyWebkitGradient(origin,colorList){var stops=[];origin=(origin==='top')?'0% 0%,0% 100%,':'0% 100%,100% 100%,';colorList=fillColorStops(colorList);$.each(colorList,function(i,val){stops.push('color-stop('+(parseFloat(val.stop)/100)+', '+val.color+')');});return'-webkit-gradient(linear,'+origin+stops.join(',')+')';}function fillColorStops(colorList){var colors=[],percs=[],newColorList=[],lastIndex=colorList.length-1;$.each(colorList,function(index,val){var color=val,perc=false,match=val.match(/1?[0-9]{1,2}%$/);if(match){color=val.replace(/\s?1?[0-9]{1,2}%$/,'');perc=match.shift();}colors.push(color);percs.push(perc);});if(percs[0]===false){percs[0]='0%';}if(percs[lastIndex]===false){percs[lastIndex]='100%';}percs=backFillColorStops(percs);$.each(percs,function(i){newColorList[i]={color:colors[i],stop:percs[i]};});return newColorList;}function backFillColorStops(stops){var first=0,last=stops.length-1,i=0,foundFirst=false,incr,steps,step,firstVal;if(stops.length<=2||$.inArray(false,stops)<0){return stops;}while(i<stops.length-1){if(!foundFirst&&stops[i]===false){first=i-1;foundFirst=true;}else if(foundFirst&&stops[i]!==false){last=i;i=stops.length;}i++;}steps=last-first;firstVal=parseInt(stops[first].replace('%'),10);incr=(parseFloat(stops[last].replace('%'))-firstVal)/steps;i=first+1;step=1;while(i<last){stops[i]=(firstVal+(step*incr))+'%';step++;i++;}return backFillColorStops(stops);}$.fn.gradient=function(){var args=arguments;return this.each(function(){if(nonGradientIE){stupidIEGradient.apply(this,args);}else{$(this).css('backgroundImage',createGradient.apply(this,args));}});};$.fn.raninbowGradient=function(origin,args){var opts,template,i,steps;origin=origin||'top';opts=$.extend({},{s:100,l:50},args);template='hsl(%h%,'+opts.s+'%,'+opts.l+'%)';i=0;steps=[];while(i<=360){steps.push(template.replace('%h%',i));i+=30;}return this.each(function(){$(this).gradient(origin,steps);});};Iris={options:{color:false,mode:'hsl',controls:{horiz:'s',vert:'l',strip:'h'},hide:true,border:true,target:false,width:200,palettes:false},_color:'',_palettes:['#000','#fff','#d33','#d93','#ee2','#81d742','#1e73be','#8224e3'],_inited:false,_defaultHSLControls:{horiz:'s',vert:'l',strip:'h'},_defaultHSVControls:{horiz:'h',vert:'v',strip:'s'},_scale:{h:360,s:100,l:100,v:100},_create:function(){var self=this,el=self.element,color=self.options.color||el.val();if(gradientType===false){testGradientType();}if(el.is('input')){if(self.options.target){self.picker=$(_html).appendTo(self.options.target);}else{self.picker=$(_html).insertAfter(el);}self._addInputListeners(el);}else{el.append(_html);self.picker=el.find('.iris-picker');}if(isIE){if(IEVersion===9){self.picker.addClass('iris-ie-9');}else if(IEVersion<=8){self.picker.addClass('iris-ie-lt9');}}else if(UA.indexOf('compatible')<0&&UA.indexOf('khtml')<0&&UA.match(/mozilla/)){self.picker.addClass('iris-mozilla');}if(self.options.palettes){self._addPalettes();}self._color=new Color(color).setHSpace(self.options.mode);self.options.color=self._color.toString();self.controls={square:self.picker.find('.iris-square'),squareDrag:self.picker.find('.iris-square-value'),horiz:self.picker.find('.iris-square-horiz'),vert:self.picker.find('.iris-square-vert'),strip:self.picker.find('.iris-strip'),stripSlider:self.picker.find('.iris-strip .iris-slider-offset')};if(self.options.mode==='hsv'&&self._has('l',self.options.controls)){self.options.controls=self._defaultHSVControls;}else if(self.options.mode==='hsl'&&self._has('v',self.options.controls)){self.options.controls=self._defaultHSLControls;}self.hue=self._color.h();if(self.options.hide){self.picker.hide();}if(self.options.border){self.picker.addClass('iris-border');}self._initControls();self.active='external';self._dimensions();self._change();},_has:function(needle,haystack){var ret=false;$.each(haystack,function(i,v){if(needle===v){ret=true;return false;}});return ret;},_addPalettes:function(){var container=$('<div class="iris-palette-container" />'),palette=$('<a class="iris-palette" tabindex="0" />'),colors=$.isArray(this.options.palettes)?this.options.palettes:this._palettes;if(this.picker.find('.iris-palette-container').length){container=this.picker.find('.iris-palette-container').detach().html('');}$.each(colors,function(index,val){palette.clone().data('color',val).css('backgroundColor',val).appendTo(container).height(10).width(10);});this.picker.append(container);},_paint:function(){var self=this;self._paintDimension('top','strip');self._paintDimension('top','vert');self._paintDimension('left','horiz');},_paintDimension:function(origin,control){var self=this,c=self._color,mode=self.options.mode,color=self._getHSpaceColor(),target=self.controls[control],controlOpts=self.options.controls,stops;if(control===self.active||(self.active==='square'&&control!=='strip')){return;}switch(controlOpts[control]){case'h':if(mode==='hsv'){color=c.clone();switch(control){case'horiz':color[controlOpts.vert](100);break;case'vert':color[controlOpts.horiz](100);break;case'strip':color.setHSpace('hsl');break;}stops=color.toHsl();}else{if(control==='strip'){stops={s:color.s,l:color.l};}else{stops={s:100,l:color.l};}}target.raninbowGradient(origin,stops);break;case's':if(mode==='hsv'){if(control==='vert'){stops=[c.clone().a(0).s(0).toCSS('rgba'),c.clone().a(1).s(0).toCSS('rgba')];}else if(control==='strip'){stops=[c.clone().s(100).toCSS('hsl'),c.clone().s(0).toCSS('hsl')];}else if(control==='horiz'){stops=['#fff','hsl('+color.h+',100%,50%)'];}}else{if(control==='vert'&&self.options.controls.horiz==='h'){stops=['hsla(0, 0%, '+color.l+'%, 0)','hsla(0, 0%, '+color.l+'%, 1)'];}else{stops=['hsl('+color.h+',0%,50%)','hsl('+color.h+',100%,50%)'];}}target.gradient(origin,stops);break;case'l':if(control==='strip'){stops=['hsl('+color.h+',100%,100%)','hsl('+color.h+', '+color.s+'%,50%)','hsl('+color.h+',100%,0%)'];}else{stops=['#fff','rgba(255,255,255,0) 50%','rgba(0,0,0,0) 50%','rgba(0,0,0,1)'];}target.gradient(origin,stops);break;case'v':if(control==='strip'){stops=[c.clone().v(100).toCSS(),c.clone().v(0).toCSS()];}else{stops=['rgba(0,0,0,0)','#000'];}target.gradient(origin,stops);break;default:break;}},_getHSpaceColor:function(){return(this.options.mode==='hsv')?this._color.toHsv():this._color.toHsl();},_dimensions:function(reset){var self=this,opts=self.options,controls=self.controls,square=controls.square,strip=self.picker.find('.iris-strip'),squareWidth='77.5%',stripWidth='12%',totalPadding=20,innerWidth=opts.border?opts.width-totalPadding:opts.width,controlsHeight,paletteCount=$.isArray(opts.palettes)?opts.palettes.length:self._palettes.length,paletteMargin,paletteWidth,paletteContainerWidth;if(reset){square.css('width','');strip.css('width','');self.picker.css({width:'',height:''});}squareWidth=innerWidth*(parseFloat(squareWidth)/100);stripWidth=innerWidth*(parseFloat(stripWidth)/100);controlsHeight=opts.border?squareWidth+totalPadding:squareWidth;square.width(squareWidth).height(squareWidth);strip.height(squareWidth).width(stripWidth);self.picker.css({width:opts.width,height:controlsHeight});if(!opts.palettes){return self.picker.css('paddingBottom','');}paletteMargin=squareWidth*2/100;paletteContainerWidth=squareWidth-((paletteCount-1)*paletteMargin);paletteWidth=paletteContainerWidth/paletteCount;self.picker.find('.iris-palette').each(function(i){var margin=i===0?0:paletteMargin;$(this).css({width:paletteWidth,height:paletteWidth,marginLeft:margin});});self.picker.css('paddingBottom',paletteWidth+paletteMargin);strip.height(paletteWidth+paletteMargin+squareWidth);},_addInputListeners:function(input){var self=this,debounceTimeout=100,callback=function(event){var color=new Color(input.val()),val=input.val().replace(/^#/,'');input.removeClass('iris-error');if(color.error){if(val!==''){input.addClass('iris-error');}}else{if(color.toString()!==self._color.toString()){if(!(event.type==='keyup'&&val.match(/^[0-9a-fA-F]{3}$/))){self._setOption('color',color.toString());}}}};input.on('change',callback).on('keyup',self._debounce(callback,debounceTimeout));if(self.options.hide){input.one('focus',function(){self.show();});}},_initControls:function(){var self=this,controls=self.controls,square=controls.square,controlOpts=self.options.controls,stripScale=self._scale[controlOpts.strip];controls.stripSlider.slider({orientation:'vertical',max:stripScale,slide:function(event,ui){self.active='strip';if(controlOpts.strip==='h'){ui.value=stripScale-ui.value;}self._color[controlOpts.strip](ui.value);self._change.apply(self,arguments);}});controls.squareDrag.draggable({containment:controls.square.find('.iris-square-inner'),zIndex:1000,cursor:'move',drag:function(event,ui){self._squareDrag(event,ui);},start:function(){square.addClass('iris-dragging');$(this).addClass('ui-state-focus');},stop:function(){square.removeClass('iris-dragging');$(this).removeClass('ui-state-focus');}}).on('mousedown mouseup',function(event){var focusClass='ui-state-focus';event.preventDefault();if(event.type==='mousedown'){self.picker.find('.'+focusClass).removeClass(focusClass).blur();$(this).addClass(focusClass).focus();}else{$(this).removeClass(focusClass);}}).on('keydown',function(event){var container=controls.square,draggable=controls.squareDrag,position=draggable.position(),distance=self.options.width/100;if(event.altKey){distance*=10;}switch(event.keyCode){case 37:position.left-=distance;break;case 38:position.top-=distance;break;case 39:position.left+=distance;break;case 40:position.top+=distance;break;default:return true;}position.left=Math.max(0,Math.min(position.left,container.width()));position.top=Math.max(0,Math.min(position.top,container.height()));draggable.css(position);self._squareDrag(event,{position:position});event.preventDefault();});square.mousedown(function(event){var squareOffset,pos;if(event.which!==1){return;}if(!$(event.target).is('div')){return;}squareOffset=self.controls.square.offset();pos={top:event.pageY-squareOffset.top,left:event.pageX-squareOffset.left};event.preventDefault();self._squareDrag(event,{position:pos});event.target=self.controls.squareDrag.get(0);self.controls.squareDrag.css(pos).trigger(event);});if(self.options.palettes){self._paletteListeners();}},_paletteListeners:function(){var self=this;self.picker.find('.iris-palette-container').on('click.palette','.iris-palette',function(){self._color.fromCSS($(this).data('color'));self.active='external';self._change();}).on('keydown.palette','.iris-palette',function(event){if(!(event.keyCode===13||event.keyCode===32)){return true;}event.stopPropagation();$(this).click();});},_squareDrag:function(event,ui){var self=this,controlOpts=self.options.controls,dimensions=self._squareDimensions(),vertVal=Math.round((dimensions.h-ui.position.top)/dimensions.h*self._scale[controlOpts.vert]),horizVal=self._scale[controlOpts.horiz]-Math.round((dimensions.w-ui.position.left)/dimensions.w*self._scale[controlOpts.horiz]);self._color[controlOpts.horiz](horizVal)[controlOpts.vert](vertVal);self.active='square';self._change.apply(self,arguments);},_setOption:function(key,value){var self=this,oldValue=self.options[key],doDimensions=false,hexLessColor,newColor,method;self.options[key]=value;switch(key){case'color':value=''+value;hexLessColor=value.replace(/^#/,'');newColor=new Color(value).setHSpace(self.options.mode);if(newColor.error){self.options[key]=oldValue;}else{self._color=newColor;self.options.color=self.options[key]=self._color.toString();self.active='external';self._change();}break;case'palettes':doDimensions=true;if(value){self._addPalettes();}else{self.picker.find('.iris-palette-container').remove();}if(!oldValue){self._paletteListeners();}break;case'width':doDimensions=true;break;case'border':doDimensions=true;method=value?'addClass':'removeClass';self.picker[method]('iris-border');break;case'mode':case'controls':if(oldValue===value){return;}method=self.element;oldValue=self.options;oldValue.hide=!self.picker.is(':visible');self.destroy();self.picker.remove();return $(self.element).iris(oldValue);}if(doDimensions){self._dimensions(true);}},_squareDimensions:function(forceRefresh){var square=this.controls.square,dimensions,control;if(forceRefresh!==undef&&square.data('dimensions')){return square.data('dimensions');}control=this.controls.squareDrag;dimensions={w:square.width(),h:square.height()};square.data('dimensions',dimensions);return dimensions;},_isNonHueControl:function(active,type){if(active==='square'&&this.options.controls.strip==='h'){return true;}else if(type==='external'||(type==='h'&&active==='strip')){return false;}return true;},_change:function(){var self=this,controls=self.controls,color=self._getHSpaceColor(),actions=['square','strip'],controlOpts=self.options.controls,type=controlOpts[self.active]||'external',oldHue=self.hue;if(self.active==='strip'){actions=[];}else if(self.active!=='external'){actions.pop();}$.each(actions,function(index,item){var value,dimensions,cssObj;if(item!==self.active){switch(item){case'strip':value=(controlOpts.strip==='h')?self._scale[controlOpts.strip]-color[controlOpts.strip]:color[controlOpts.strip];controls.stripSlider.slider('value',value);break;case'square':dimensions=self._squareDimensions();cssObj={left:color[controlOpts.horiz]/self._scale[controlOpts.horiz]*dimensions.w,top:dimensions.h-(color[controlOpts.vert]/self._scale[controlOpts.vert]*dimensions.h)};self.controls.squareDrag.css(cssObj);break;}}});if(color.h!==oldHue&&self._isNonHueControl(self.active,type)){self._color.h(oldHue);}self.hue=self._color.h();self.options.color=self._color.toString();if(self._inited){self._trigger('change',{type:self.active},{color:self._color});}if(self.element.is(':input')&&!self._color.error){self.element.removeClass('iris-error');if(self.element.val()!==self._color.toString()){self.element.val(self._color.toString());}}self._paint();self._inited=true;self.active=false;},_debounce:function(func,wait,immediate){var timeout,result;return function(){var context=this,args=arguments,later,callNow;later=function(){timeout=null;if(!immediate){result=func.apply(context,args);}};callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);}return result;};},show:function(){this.picker.show();},hide:function(){this.picker.hide();},toggle:function(){this.picker.toggle();},color:function(newColor){if(newColor===true){return this._color.clone();}else if(newColor===undef){return this._color.toString();}this.option('color',newColor);}};$.widget('a8c.iris',Iris);$('<style id="iris-css">'+_css+'</style>').appendTo('head');}(jQuery));(function(global,undef){var Color=function(color,type){if(!(this instanceof Color))return new Color(color,type);return this._init(color,type);};Color.fn=Color.prototype={_color:0,_alpha:1,error:false,_hsl:{h:0,s:0,l:0},_hsv:{h:0,s:0,v:0},_hSpace:'hsl',_init:function(color){var func='noop';switch(typeof color){case'object':if(color.a!==undef)this.a(color.a);func=(color.r!==undef)?'fromRgb':(color.l!==undef)?'fromHsl':(color.v!==undef)?'fromHsv':func;return this[func](color);case'string':return this.fromCSS(color);case'number':return this.fromInt(parseInt(color,10));}return this;},_error:function(){this.error=true;return this;},clone:function(){var newColor=new Color(this.toInt()),copy=['_alpha','_hSpace','_hsl','_hsv','error'];for(var i=copy.length-1;i>=0;i--){newColor[copy[i]]=this[copy[i]];}return newColor;},setHSpace:function(space){this._hSpace=(space==='hsv')?space:'hsl';return this;},noop:function(){return this;},fromCSS:function(color){var list,leadingRE=/^(rgb|hs(l|v))a?\(/;this.error=false;color=color.replace(/^\s+/,'').replace(/\s+$/,'').replace(/;$/,'');if(color.match(leadingRE)&&color.match(/\)$/)){list=color.replace(/(\s|%)/g,'').replace(leadingRE,'').replace(/,?\);?$/,'').split(',');if(list.length<3)return this._error();if(list.length===4){this.a(parseFloat(list.pop()));if(this.error)return this;}for(var i=list.length-1;i>=0;i--){list[i]=parseInt(list[i],10);if(isNaN(list[i]))return this._error();}if(color.match(/^rgb/)){return this.fromRgb({r:list[0],g:list[1],b:list[2]});}else if(color.match(/^hsv/)){return this.fromHsv({h:list[0],s:list[1],v:list[2]});}else{return this.fromHsl({h:list[0],s:list[1],l:list[2]});}}else{return this.fromHex(color);}},fromRgb:function(rgb,preserve){if(typeof rgb!=='object'||rgb.r===undef||rgb.g===undef||rgb.b===undef)return this._error();this.error=false;return this.fromInt(parseInt((rgb.r<<16)+(rgb.g<<8)+rgb.b,10),preserve);},fromHex:function(color){color=color.replace(/^#/,'').replace(/^0x/,'');if(color.length===3){color=color[0]+color[0]+color[1]+color[1]+color[2]+color[2];}this.error=!/^[0-9A-F]{6}$/i.test(color);return this.fromInt(parseInt(color,16));},fromHsl:function(hsl){var r,g,b,q,p,h,s,l;if(typeof hsl!=='object'||hsl.h===undef||hsl.s===undef||hsl.l===undef)return this._error();this._hsl=hsl;this._hSpace='hsl';h=hsl.h/360;s=hsl.s/100;l=hsl.l/100;if(s===0){r=g=b=l;}else{q=l<0.5?l*(1+s):l+s-l*s;p=2*l-q;r=this.hue2rgb(p,q,h+1/3);g=this.hue2rgb(p,q,h);b=this.hue2rgb(p,q,h-1/3);}return this.fromRgb({r:r*255,g:g*255,b:b*255},true);},fromHsv:function(hsv){var h,s,v,r,g,b,i,f,p,q,t;if(typeof hsv!=='object'||hsv.h===undef||hsv.s===undef||hsv.v===undef)return this._error();this._hsv=hsv;this._hSpace='hsv';h=hsv.h/360;s=hsv.s/100;v=hsv.v/100;i=Math.floor(h*6);f=h*6-i;p=v*(1-s);q=v*(1-f*s);t=v*(1-(1-f)*s);switch(i%6){case 0:r=v;g=t;b=p;break;case 1:r=q;g=v;b=p;break;case 2:r=p;g=v;b=t;break;case 3:r=p;g=q;b=v;break;case 4:r=t;g=p;b=v;break;case 5:r=v;g=p;b=q;break;}return this.fromRgb({r:r*255,g:g*255,b:b*255},true);},fromInt:function(color,preserve){this._color=parseInt(color,10);if(isNaN(this._color))this._color=0;if(this._color>16777215)this._color=16777215;else if(this._color<0)this._color=0;if(preserve===undef){this._hsv.h=this._hsv.s=this._hsl.h=this._hsl.s=0;}return this;},hue2rgb:function(p,q,t){if(t<0){t+=1;}if(t>1){t-=1;}if(t<1/6){return p+(q-p)*6*t;}if(t<1/2){return q;}if(t<2/3){return p+(q-p)*(2/3-t)*6;}return p;},toString:function(){var hex=parseInt(this._color,10).toString(16);if(this.error)return'';if(hex.length<6){for(var i=6-hex.length-1;i>=0;i--){hex='0'+hex;}}return'#'+hex;},toCSS:function(type,alpha){type=type||'hex';alpha=parseFloat(alpha||this._alpha);switch(type){case'rgb':case'rgba':var rgb=this.toRgb();if(alpha<1){return"rgba( "+rgb.r+", "+rgb.g+", "+rgb.b+", "+alpha+" )";}else{return"rgb( "+rgb.r+", "+rgb.g+", "+rgb.b+" )";}break;case'hsl':case'hsla':var hsl=this.toHsl();if(alpha<1){return"hsla( "+hsl.h+", "+hsl.s+"%, "+hsl.l+"%, "+alpha+" )";}else{return"hsl( "+hsl.h+", "+hsl.s+"%, "+hsl.l+"% )";}break;default:return this.toString();}},toRgb:function(){return{r:255&(this._color>>16),g:255&(this._color>>8),b:255&(this._color)};},toHsl:function(){var rgb=this.toRgb();var r=rgb.r/255,g=rgb.g/255,b=rgb.b/255;var max=Math.max(r,g,b),min=Math.min(r,g,b);var h,s,l=(max+min)/2;if(max===min){h=s=0;}else{var d=max-min;s=l>0.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}h=Math.round(h*360);if(h===0&&this._hsl.h!==h){h=this._hsl.h;}s=Math.round(s*100);if(s===0&&this._hsl.s){s=this._hsl.s;}return{h:h,s:s,l:Math.round(l*100)};},toHsv:function(){var rgb=this.toRgb();var r=rgb.r/255,g=rgb.g/255,b=rgb.b/255;var max=Math.max(r,g,b),min=Math.min(r,g,b);var h,s,v=max;var d=max-min;s=max===0?0:d/max;if(max===min){h=s=0;}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}h/=6;}h=Math.round(h*360);if(h===0&&this._hsv.h!==h){h=this._hsv.h;}s=Math.round(s*100);if(s===0&&this._hsv.s){s=this._hsv.s;}return{h:h,s:s,v:Math.round(v*100)};},toInt:function(){return this._color;},toIEOctoHex:function(){var hex=this.toString();var AA=parseInt(255*this._alpha,10).toString(16);if(AA.length===1){AA='0'+AA;}return'#'+AA+hex.replace(/^#/,'');},toLuminosity:function(){var rgb=this.toRgb();return 0.2126*Math.pow(rgb.r/255,2.2)+0.7152*Math.pow(rgb.g/255,2.2)+0.0722*Math.pow(rgb.b/255,2.2);},getDistanceLuminosityFrom:function(color){if(!(color instanceof Color)){throw'getDistanceLuminosityFrom requires a Color object';}var lum1=this.toLuminosity();var lum2=color.toLuminosity();if(lum1>lum2){return(lum1+0.05)/(lum2+0.05);}else{return(lum2+0.05)/(lum1+0.05);}},getMaxContrastColor:function(){var lum=this.toLuminosity();var hex=(lum>=0.5)?'000000':'ffffff';return new Color(hex);},getReadableContrastingColor:function(bgColor,minContrast){if(!bgColor instanceof Color){return this;}var targetContrast=(minContrast===undef)?5:minContrast;var contrast=bgColor.getDistanceLuminosityFrom(this);var maxContrastColor=bgColor.getMaxContrastColor();var maxContrast=maxContrastColor.getDistanceLuminosityFrom(bgColor);if(maxContrast<=targetContrast){return maxContrastColor;}else if(contrast>=targetContrast){return this;}var incr=(0===maxContrastColor.toInt())?-1:1;while(contrast<targetContrast){this.l(incr,true);contrast=this.getDistanceLuminosityFrom(bgColor);if(this._color===0||this._color===16777215){break;}}return this;},a:function(val){if(val===undef)return this._alpha;var a=parseFloat(val);if(isNaN(a))return this._error();this._alpha=a;return this;},darken:function(amount){amount=amount||5;return this.l(-amount,true);},lighten:function(amount){amount=amount||5;return this.l(amount,true);},saturate:function(amount){amount=amount||15;return this.s(amount,true);},desaturate:function(amount){amount=amount||15;return this.s(-amount,true);},toGrayscale:function(){return this.setHSpace('hsl').s(0);},getComplement:function(){return this.h(180,true);},getSplitComplement:function(step){step=step||1;var incr=180+(step*30);return this.h(incr,true);},getAnalog:function(step){step=step||1;var incr=step*30;return this.h(incr,true);},getTetrad:function(step){step=step||1;var incr=step*60;return this.h(incr,true);},getTriad:function(step){step=step||1;var incr=step*120;return this.h(incr,true);},_partial:function(key){var prop=shortProps[key];return function(val,incr){var color=this._spaceFunc('to',prop.space);if(val===undef)return color[key];if(incr===true)val=color[key]+val;if(prop.mod)val=val%prop.mod;if(prop.range)val=(val<prop.range[0])?prop.range[0]:(val>prop.range[1])?prop.range[1]:val;color[key]=val;return this._spaceFunc('from',prop.space,color);};},_spaceFunc:function(dir,s,val){var space=s||this._hSpace,funcName=dir+space.charAt(0).toUpperCase()+space.substr(1);return this[funcName](val);}};var shortProps={h:{mod:360},s:{range:[0,100]},l:{space:'hsl',range:[0,100]},v:{space:'hsv',range:[0,100]},r:{space:'rgb',range:[0,255]},g:{space:'rgb',range:[0,255]},b:{space:'rgb',range:[0,255]}};for(var key in shortProps){if(shortProps.hasOwnProperty(key))Color.fn[key]=Color.fn._partial(key);}if(typeof exports==='object')module.exports=Color;else global.Color=Color;}(this));jQuery(function(){function applyPreview(target){var $style=target.jQuery('link[rel=stylesheet][href*="lib/exe/css.php"]');$style.attr('href','');var $loader=target.jQuery('#plugin__styling_loader');if(!$loader.length){$loader=target.jQuery('<div id="plugin__styling_loader">'+LANG.plugins.styling.loader+'</div>');$loader.css({'position':'absolute','width':'100%','height':'100%','top':0,'left':0,'z-index':5000,'background-color':'#fff','opacity':'0.7','color':'#000','font-size':'2.5em','text-align':'center','line-height':1.5,'padding-top':'2em'});target.jQuery('body').append($loader);}setTimeout(function(){var now=new Date().getTime();$style.attr('href',DOKU_BASE+'lib/exe/css.php?preview=1&tseed='+now);},500);}var doreload=1;var $styling_plugin=jQuery('#plugin__styling');if(!$styling_plugin.length){if(DokuCookie.getValue('styling_plugin')==1){applyPreview(window);}return;}$styling_plugin.find('.color').iris({});if(!$styling_plugin.hasClass('ispopup')){var $form=$styling_plugin.find('form.styling').first();var $btn=jQuery('<button>'+LANG.plugins.styling.popup+'</button>');$form.prepend($btn);$btn.click(function(e){var windowFeatures="menubar=no,location=no,resizable=yes,scrollbars=yes,status=false,width=500,height=500";window.open(DOKU_BASE+'lib/plugins/styling/popup.php','styling_popup',windowFeatures);e.preventDefault();e.stopPropagation();}).wrap('<p></p>');return;}window.onunload=function(e){if(doreload){window.opener.DokuCookie.setValue('styling_plugin',0);window.opener.document.location.reload();}return null;};jQuery(':button').click(function(e){doreload=false;});applyPreview(window.opener);window.opener.DokuCookie.setValue('styling_plugin',1);});var plugin_fastwiki=(function($){var m_viewMode,m_origViewMode,m_prevView;var m_isSecedit,m_wasSecedit;var m_hasDraft;var m_pageObjs={};var m_content;var m_initialId;var m_debug=document.location.host=='localhost';var m_cache=new CPageCache(JSINFO.fastwiki.preload_per_page,JSINFO.fastwiki.preload_batchsize,m_debug);var m_supportedActions={'':1,edit:1,draft:1,history:1,recent:1,revisions:1,show:1,subscribe:1,backlink:1,index:1,profile:1,media:1,diff:1,save:1};var m_modeClassElt;var m_browserHistory=new CBrowserHistory();$(function(){if(document.location.href.indexOf("detail.php")>=0)m_viewMode='unsupported';else{var urlParams=_urlToObj(document.location.href);m_viewMode=urlParams['do']||'show';if(!m_supportedActions[m_viewMode])m_viewMode='unsupported';else if(window.tpl_fastwiki_startmode_support&&!(m_viewMode in tpl_fastwiki_startmode_support))m_viewMode='unsupported';}m_origViewMode=m_viewMode;m_content=$('.plugin_fastwiki_marker').parent();m_content.addClass('content_initial');m_initialId=m_content.attr('id');m_modeClassElt=m_content.hasClass('dokuwiki')?m_content:$(m_content.parents('.dokuwiki')[0]||document.body);$(window).trigger('fastwiki:init',[m_viewMode]);if(JSINFO.fastwiki.fastpages)fixActionLinks(document.body);if(JSINFO.fastwiki.fastshow&&(m_origViewMode!='show'||!window.history||!history.pushState))JSINFO.fastwiki.fastshow=false;if(JSINFO.fastwiki.fastshow)m_browserHistory.init(load);});function fixActionLinks(elt){if(m_origViewMode=='unsupported')return;var formActions={search:1};var supportedFields={'do':1,rev:1,id:1};$('a[href *= "?do="]',elt).click(function(e){var curPathId=JSINFO.id.replace(/:/g,'/');var aPathId=this.href.replace(/\?.*$/,'').replace(/:/g,'/');if(aPathId.substr(-curPathId.length)==curPathId){var params=_urlToObj(this.href);if(!params['do'])params['do']='show';if(params['do']in m_supportedActions){e.preventDefault();load(params['do'],null,params);}}});$('input[type="submit"], input[type="button"], button',elt).click(function(e){var form=$(this).parents('form');if(form.length>0&&form[0]['do']&&form[0]['do'].value in m_supportedActions){var supported=true;$('input[type != "submit"]',form).each(function(idx,elt){if(elt.type!='button'&&(elt.type!='hidden'||!(elt.name in supportedFields)))supported=false;});if(supported){e.preventDefault();var params=_formToObj(form[0]);if(!params['do'])params['do']='show';load(params['do'],null,params);}}});if(m_origViewMode=='show'&&window.JSINFO){var pathId=JSINFO.id.replace(/:/g,'/');$('a',elt).click(function(e){var href=this.getAttribute('href');if(href&&href.indexOf('://')<0){if(href.match(m_browserHistory.getSelfRefRegex())){load('show');e.preventDefault();}else if(JSINFO.fastwiki.fastshow){var numParams=href.split('=').length;if(href.indexOf('id=')>=0)numParams--;if(numParams==1){if(m_browserHistory.switchBasePath(href)){m_viewMode=null;e.preventDefault();}}}}});}if(JSINFO.fastwiki.secedit){$('.editbutton_section .btn_secedit input[type=submit], .editbutton_section .btn_secedit button',elt).click(function(e){e.preventDefault();var form=$(this).parents('form');load('edit',form,_formToObj(form));});}if(JSINFO.fastwiki.preload)m_cache.load(elt,m_browserHistory);}function _preview(sectionForm){var body=$(document.body);var params=_formToObj($('#dw__editform'));params['do']='preview';_sendPartial(params,$('.dokuwiki .editBox'),function(data){var preview=$('<div id="preview_container">'+data+'</div>');var pvEditor=preview.find('#dw__editform');var editor=$('#dw__editform')[0];pvEditor.find('input[type=hidden]').each(function(idx,elt){editor[elt.name].value=elt.value;});preview.find('#scroll__here').prevAll().remove();var oldpreview=$('#preview_container');if(oldpreview.length>0)oldpreview.replaceWith(preview);else $('.content_partial').append(preview);setTimeout(function(){$('html,body').animate({scrollTop:$('#scroll__here').offset().top+'px'},300);},1);},'text');}function _getSection(sectionForm){var pieces=$();var target=sectionForm.parent();var nr=target.attr('class').match(/(\s+|^)editbutton_(\d+)(\s+|$)/)[2];while(target.length>0&&!(target.hasClass('sectionedit'+nr)||target.find('.sectionedit'+nr).length)){target=target.prev();if(target.hasClass('section_highlight'))pieces=pieces.add(target.children());pieces=pieces.add(target);}return pieces;}function _focusEdit(){var $edit_text=$('#wiki__text');if($edit_text.length>0&&!$edit_text.attr('readOnly')){var sel=DWgetSelection($edit_text[0]);sel.start=0;sel.end=0;try{DWsetSelection(sel);}catch(e){setTimeout(function(){try{DWsetSelection(sel);}catch(e){}},500);}$edit_text.focus();}}function _initEdit(){if(!window.doku_summaryCheck){window.doku_summaryCheck=window.summaryCheck;}dw_editor.init();dw_locktimer.init(JSINFO.fastwiki.locktime,JSINFO.fastwiki.usedraft);var $editform=$('#dw__editform');if($editform.length==0)return;var $edit_text=$('#wiki__text');$editform.on("change keydown",function(e){window.textChanged=true;doku_summaryCheck();});m_pageObjs.content=$edit_text.val();window.onbeforeunload=function(){if(window.textChanged&&m_pageObjs.content!=$edit_text.val())return LANG.notsavedyet;};window.onunload=deleteDraft;$('#edbtn__preview').click(function(e){if(JSINFO.fastwiki.preview){e.preventDefault();_preview(m_pageObjs.sectionForm);m_hasDraft=true;dw_locktimer.reset();}else{window.onbeforeunload='';textChanged=false;window.keepDraft=true;}});$('#edit__summary').on("change keyup",doku_summaryCheck);if(textChanged)doku_summaryCheck();initToolbar('tool__bar','wiki__text',toolbar);$('#tool__bar').attr('role','toolbar');$('#edbtn__save').click(function(e){textChanged=false;if(JSINFO.fastwiki.save&&m_origViewMode=='show'&&$edit_text.val().length>0&&m_pageObjs.content.length>0){e.preventDefault();load('save',null,_formToObj($('#dw__editform')));}else m_cache.remove(JSINFO.id);window.onbeforeunload='';dw_locktimer.clear();});$('input[name="do[draftdel]"]',$editform).click(function(e){e.preventDefault();var id=$editform.find('input[name=id]').val();load('show');if(!window.keepDraft){jQuery.post(DOKU_BASE+'lib/exe/ajax.php',{call:'draftdel',id:id,success:function(data,textStatus,jqXHR){m_hasDraft=false;}});}});$('input[name="do[show]"]',$editform).click(function(e){e.preventDefault();load('show');});$('.picker.pk_hl').addClass('dokuwiki');}function _setBodyClass(action,target){for(var k in m_supportedActions)m_modeClassElt.removeClass('mode_'+k);m_modeClassElt.addClass('mode_'+action);if(target=='section')m_modeClassElt.removeClass('mode_edit').addClass('mode_show mode_secedit');$('.content_partial').toggle(m_viewMode!=m_origViewMode);$('.content_initial').toggle(m_viewMode==m_origViewMode||target=='section');}function _updatePageObjsOnSwitch(){if(m_pageObjs.showOnSwitch)m_pageObjs.showOnSwitch.show();delete m_pageObjs.showOnSwitch;delete m_pageObjs.content;delete m_pageObjs.sectionForm;var hasToc={show:1,admin:1};$("#dw__toc, #dw_toc_head, #dw_toc").css('display',m_viewMode in hasToc?'':'none');}function _formToObj(form){var obj={};$(form).serializeArray().map(function(item){obj[item.name]=item.value;});return obj;}function _urlToObj(url){var obj={};var a=url.replace(/.*\?/,'').split('&');for(var x=0;x<a.length;x++){var parts=unescape(a[x]).split('=');var name=parts.shift();obj[name]=parts.join('=');}return obj;}var m_actionEffects={subscribe:function(params,extraData){function subscribeAction(sparams){_sendPartial(sparams,_getVisibleContent(),function(data){load(m_origViewMode);var body=$('<div class="message_partial"></div>').append(data);$('.content_initial').before(body);},'text');}var form=$('#subscribe__form');$('input[name="do[subscribe]"]',form).click(function(e){e.preventDefault();subscribeAction(_formToObj(form));});$('.content_partial .unsubscribe').click(function(e){e.preventDefault();subscribeAction(_urlToObj(this.href));});},index:function(params,extraData){dw_index.$obj=$('#index__tree');dw_index.init();},edit:function(params,extraData){var draft=params['do']=='draft';if(m_hasDraft===true)draft=true;else if(m_hasDraft===false)draft=params.rev=null;if(extraData.sectionForm){m_pageObjs.sectionForm=extraData.sectionForm;extraData.sectionParts=extraData.sectionParts.add('.editbutton_section');m_pageObjs.showOnSwitch=extraData.sectionParts;m_pageObjs.showOnSwitch.hide();_initEdit();_focusEdit();}else _initEdit();setTimeout(function(){_focusEdit();if(document.body.scrollTop>0)$('html,body').animate({scrollTop:Math.max(0,Math.floor($('.content_partial').offset().top)-20)+'px'},300);},1);},revisions:function(params,extraData){$('.content_partial form').each(function(idx,form){$('input[name="do[diff]"]',form).click(function(e){e.preventDefault();load('diff',null,_formToObj(form));});});},save:function(params,extraData){if($('.content_partial #a_newer_version_exists').length>0){m_viewMode='edit';m_actionEffects.edit(params,m_pageObjs.sectionForm?{sectionForm:m_pageObjs.sectionForm,sectionParts:_getSection(m_pageObjs.sectionForm)}:{});var editform=$('#dw__editform');$('input[name="do[save]"]',editform).click(function(e){e.preventDefault();load('save',null,_formToObj(editform));window.onbeforeunload='';dw_locktimer.clear();});$('input[name="do[cancel]"]',editform).click(function(e){e.preventDefault();var id=editform.find('input[name=id]').val();load('show');if(!window.keepDraft){jQuery.post(DOKU_BASE+'lib/exe/ajax.php',{call:'draftdel',id:id,success:function(data,textStatus,jqXHR){m_hasDraft=false;}});}});}else if($('.content_partial #dw__editform').length>0){m_viewMode='edit';m_actionEffects.edit(params,m_pageObjs.sectionForm?{sectionForm:m_pageObjs.sectionForm,sectionParts:_getSection(m_pageObjs.sectionForm)}:{});}else if($('.content_partial #preview').length>0){load('show');}else{$('.content_initial').html($('.content_partial').html());$('.content_partial').remove();fixActionLinks($('.content_initial'));m_browserHistory.refreshPageTitle(false);load('show');dw_page.sectionHighlight();jQuery('a.fn_top').mouseover(dw_page.footnoteDisplay);}},show:function(params,extraData){$('.content_initial').html($('.content_partial').html());$('.content_partial').remove();fixActionLinks($('.content_initial'));dw_page.sectionHighlight();jQuery('a.fn_top').mouseover(dw_page.footnoteDisplay);}};m_actionEffects.draft=m_actionEffects.edit;m_actionEffects.diff=m_actionEffects.revisions;function _action(action,params,callback,insertLoc,extraData){params['do']=action;function cb(data){$('.content_partial, .message_partial').remove();$('.content_initial').attr('id',m_initialId);var body=$('<div class="content_partial"></div>').append(data);if(insertLoc&&action=='edit'){var newform=$('#dw__editform',body);if(newform.find('input[name=prefix]').val()=='.'&&newform.find('input[name=suffix]').val()==''){delete m_pageObjs.sectionForm;if(extraData)delete extraData.sectionForm;insertLoc=null;}}if(insertLoc)$(insertLoc[insertLoc.length-1]).after(body);else{var initial=$('.content_initial');body.addClass(initial[0].className.replace(/content_initial/,'')).attr('id',m_initialId);initial.attr('id','').after(body);}var newToc=$('.content_partial #dw__toc').addClass('fwJustincase');var hasNewToc=newToc.length>0;_updatePageObjsOnSwitch();if(callback)callback(data,extraData);if(m_actionEffects[action])m_actionEffects[action](params,extraData||{});newToc=$('.fwJustincase').removeClass('fwJustincase');if(m_viewMode=='show')$(window).trigger('fastwiki:updateToc',[newToc]);if(hasNewToc)dw_page.makeToggle('#dw__toc h3','#dw__toc > div');fixActionLinks($('.content_partial'));_setBodyClass(m_viewMode,m_pageObjs.sectionForm?"section":null);if(m_viewMode=='show')m_cache.add(JSINFO.id,data,true);if(!insertLoc)dw_behaviour.init();$(window).trigger('fastwiki:afterSwitch',[m_pageObjs.sectionForm?'show':m_viewMode,!!m_pageObjs.sectionForm,m_prevView]);if(!m_isSecedit&&!m_wasSecedit){setTimeout(function(){$('html,body').animate({scrollTop:0},300);},1);}}if(action=='show'&&m_cache.get(JSINFO.id)){m_debug&&console.log("Getting from cache: "+JSINFO.id);cb(m_cache.get(JSINFO.id));}else _sendPartial(params,_getVisibleContent(),cb,'text');}function _sendPartial(params,spinnerParent,callback){if($('.partialsLoading').length==0){var spinnerCss=spinnerParent.height()+spinnerParent.offset().top>$(window).height()?{top:$(window).height()/2}:{top:'50%'};spinnerParent.append($('<div class="partialsLoading"></div>').css('display','none').css(spinnerCss));setTimeout(function(){$('.partialsLoading').css('display','');},500);}params.partial=1;jQuery[!params['do']||params['do']=='show'?'get':'post'](m_browserHistory.getBaseUrl(),params,function(data){if(data=='PERMISSION_CHANGE'){delete params.partial;delete params.fastwiki_compareid;var url=m_browserHistory.getBaseUrl()+'?'+$.param(params);document.location.href=url;}else callback(data);$('.partialsLoading').remove();},'text');}function _getVisibleContent(){var parentElt=$('.content_partial');if(parentElt.length==0)parentElt=$('.content_initial');return parentElt;}function load(page,sectionForm,params,force,callback){if((m_viewMode=='edit'||m_viewMode=='draft')&&(page!='save'&&page!='preview')&&m_pageObjs.content!=$('#wiki__text').val()){if(!confirm(LANG.notsavedyet))return;}m_prevView=m_viewMode;m_wasSecedit=m_isSecedit;m_isSecedit=!!sectionForm||(m_wasSecedit&&page=='save');m_viewMode=page;if(!params)params={};window.onbeforeunload='';dw_locktimer.clear();_updatePageObjsOnSwitch();if(page==m_origViewMode&&!force){$('.content_partial, .message_partial').remove();$('.content_initial').attr('id',m_initialId);if(m_prevView!=page){if(!m_isSecedit&&!m_wasSecedit){setTimeout(function(){$('html,body').animate({scrollTop:0},300);},1);}_setBodyClass(page);$(window).trigger('fastwiki:afterSwitch',[m_pageObjs.sectionForm?'show':m_viewMode,!!m_pageObjs.sectionForm]);}if(callback)callback();}else if((page=='draft'||page=='edit')&&sectionForm){var sectionParts=_getSection(sectionForm);_action(page,params,callback,sectionParts,{sectionForm:sectionForm,sectionParts:sectionParts});}else _action(page,params,callback);}return{load:load,fixActionLinks:fixActionLinks};function CPageCache(maxSize,batchSize,debug){var m_queue=[];var m_p1Queue=[];var m_pages={},m_p1Ids={};var m_maxSize=maxSize;var m_batchSize=batchSize;var m_maxP1Size=10;if(debug){window.cpagecache_pages=m_pages;window.cpagecache_queue=m_queue;}this.add=function(id,data,p1){if(p1)_addPage(id,m_p1Queue,m_p1Ids,1,m_maxP1Size);_addPage(id,m_queue,m_pages,data,m_maxSize,m_p1Queue);};this.remove=function(id){if(id in m_pages){m_queue.splice(m_queue.indexOf(id),1);delete m_pages[id];var p1Idx=m_p1Queue.indexOf(id);if(p1Idx>=0){m_queue.splice(p1Idx,1);delete m_p1Ids[id];}}};this.get=function(id){if(id in m_pages){_pushToFront(id,m_queue);_pushToFront(id,m_p1Queue);return m_pages[id];}return null;};this.has=function(id){return id in m_pages;};this.load=function(elt,history){var self=this;var ids={};$('a',elt).each(function(idx,a){var href=a.getAttribute('href');if(href&&href.indexOf('://')<0){var numParams=href.split('=').length;if(href.indexOf('id=')>=0)numParams--;if(numParams==1){var pageinfo=history.getSwitchId(href);if(pageinfo&&!m_cache.has(pageinfo.id))ids[pageinfo.id]=1;}}});var idsA=[];for(var id in ids)idsA.push(id);if(idsA.length>m_maxSize){}else if(idsA.length>0){if(idsA.length>m_maxSize)idsA.length=m_maxSize;var batchSize=m_batchSize;if(idsA.length/batchSize<4)batchSize=Math.ceil(idsA.length/4);var requests=[];for(var x=0;x<Math.ceil(idsA.length/batchSize);x++){var sublist=idsA.slice(x*batchSize,(x+1)*batchSize);var params={partial:1};params['do']='fastwiki_preload';params.fastwiki_preload_pages=sublist.join(',');requests.push(params);}function doPost(params){m_debug&&console.log("Preloading "+params.fastwiki_preload_pages);$.post(DOKU_BASE+'doku.php',params,function(data){var pages=data.split(JSINFO.fastwiki.preload_head);for(var p=0;p<pages.length;p++){var line1End=pages[p].indexOf('\n');var id=pages[p].substr(0,line1End);pages[p]=pages[p].substr(line1End+1);m_debug&&console.log("Loaded "+[id,pages[p].length]);if(pages[p].indexOf('<body')>=0)m_debug&&console.log("ERROR: Body found!");else self.add(id,pages[p]);}if(requests.length>0)doPost(requests.shift());},'text');}for(var x=0;x<Math.min(4,requests.length);x++)doPost(requests.shift());}};function _pushToFront(id,queue){var idx=queue.indexOf(id);if(idx>=0){queue.splice(idx,1);queue.push(id);}}function _addPage(id,queue,hash,data,maxSize,exclude){if(id in hash)_pushToFront(id,queue);else if(data){if(queue.length>maxSize){if(exclude){for(var x=0;x<queue.length;x++){if(!exclude[queue[x]]){delete hash[queue[x]];queue.splice(x,1);}}}else delete hash[queue.shift()];}queue.push(id);}if(data)hash[id]=data;}}function CBrowserHistory(){var m_inPopState=false;var m_curBaseUrl=document.location.pathname;var m_prevTitle='__UNDEFINED__';var m_loadPageFunc=null;var self=this;function base(url,withId){if(withId){var id=url.replace(/.*id=([^&]+).*/,'$1');if(id.match(/^[a-zA-Z0-9_\-:]+$/))return url.replace(/\?.*/,'')+'?id='+id;}return url.replace(/\?.*/,'');}function _getWikiTitle(){var titleElt;$('h1, h2, h3, h4, h5, h6',$('.content_initial')).each(function(idx,elt){if(elt.className.indexOf('sectionedit')>=0){titleElt=elt;return false;}});return titleElt?$(titleElt).text():'';}this.init=function(loadFunc){m_prevTitle=_getWikiTitle()||'__UNDEFINED__';m_loadPageFunc=loadFunc;window.addEventListener('popstate',function(e){document.title=e.state.title;m_inPopState=true;self.switchBasePath(e.state.url);});};this.getSwitchId=function(newpage,force){var pageid=newpage.substr(1).replace(/.*doku.php(\?id=|\/)/,'').replace(/\//g,':');var ns=pageid.replace(/:[^:]+$/,'');if(!force){if(JSINFO.fastwiki.fastshow_same_ns&&ns!=JSINFO.namespace)return false;var incl=JSINFO.fastwiki.fastshow_include,excl=JSINFO.fastwiki.fastshow_exclude;if(incl&&!pageid.match('^('+incl.split(/\s*,\s*/).join('|')+')'))return false;if(excl&&pageid.match('^('+excl.split(/\s*,\s*/).join('|')+')'))return false;}return{id:pageid,ns:ns};};this.getSelfRefRegex=function(){var path=document.location.pathname;var idPath=JSINFO.id.replace(/:/g,'/');if(path.indexOf('doku.php')>=0)return new RegExp('doku\\.php\\?id='+JSINFO.id+'$|doku\\.php/'+idPath+'$');return new RegExp('^'+path+'$|://'+document.location.host+path+'$');};this.getBaseUrl=function(){return m_curBaseUrl;};this.switchBasePath=function(newpage){var pageinfo=this.getSwitchId(newpage);if(!pageinfo)return false;var oldid=JSINFO.id;JSINFO.id=pageinfo.id;JSINFO.namespace=pageinfo.ns;$('form').each(function(idx,form){if($(form).find('input[name="do"]').length>0){var input=$('input[name="id"]',form);if(input.val()==oldid)input.val(pageinfo.id);}});m_curBaseUrl=base(newpage);var prevpage=document.location.href;m_loadPageFunc('show',null,{fastwiki_compareid:oldid},true,function(){setTimeout(function(){if(!m_inPopState){history.replaceState({url:prevpage,title:document.title},"",prevpage);history.pushState({url:newpage,title:document.title},"",newpage);$(window).trigger('fastwiki:afterIdChange',[prevpage,m_curBaseUrl]);}m_inPopState=false;self.refreshPageTitle(true);},1);});return true;};this.refreshPageTitle=function(fromIdSwitch){var title=_getWikiTitle();document.title=title;if(!fromIdSwitch){$('a').each(function(idx,elt){var $this=$(this);var href=$this.attr('href');if(href&&href.match(self.getSelfRefRegex())&&$this.text()==m_prevTitle)$this.text(document.title);});}m_prevTitle=title;};}})(jQuery);if(!window.tpl_fastwiki_support){(function($){var m_showRow,m_editRow;var m_utils={makeShowLink:function(url){url=url.replace(/\?do=.*$/,'');return'<a href="'+url+'" class="action show" accesskey="v" rel="nofollow" title="'+JSINFO.fastwiki.text_btn_show+' [V]"><span>'+JSINFO.fastwiki.text_btn_show+'</span></a>';},makeShowRowLI:function(pagetools,mode){var showLink=$("a[href $= 'do=']",pagetools);if(showLink.length>0)m_showRow=$(showLink.parents('li')[0]);else{var link=$("a[href *= 'do=']",pagetools)[0];if(link){m_showRow=$('<li>'+m_utils.makeShowLink(link.href)+'</li>').toggle(mode!='show');pagetools.prepend(m_showRow);}}},fixButtons:function(showParent,allButtons,mode){var showBtn=$('.button.btn_show',showParent);if(showBtn.length==0){var url=$('form.button',allButtons)[0].action;showBtnHtml='<form class="button btn_show" method="get" action="'+url+'"><div class="no"><input type="hidden" name="do" value=""><input type="submit" value="'+JSINFO.fastwiki.text_btn_show+'" class="button" accesskey="v" title="'+JSINFO.fastwiki.text_btn_show+' [V]"></div></form>';showParent.each(function(idx,elt){var newBtn=$(showBtnHtml);showBtn=showBtn.add(newBtn);$(elt).prepend(newBtn.toggle(mode!='show'));});}var editBtn=$('.button.btn_edit',allButtons);if(editBtn.length>0)m_editRow=m_editRow?m_editRow.add(editBtn):editBtn;m_showRow=m_showRow?m_showRow.add(showBtn):showBtn;}};if($('#dokuwiki__pagetools').length>0){window.tpl_fastwiki_startmode_support={show:1};$(window).on({'fastwiki:init':function(e,mode){m_utils.makeShowRowLI($("#dokuwiki__pagetools ul"),mode);},'fastwiki:afterSwitch':function(e,mode,isSectionEdit,prevMode){$("#dokuwiki__top").toggleClass("showSidebar hasSidebar",mode=='show');$("#dokuwiki__aside").css('display',mode=='show'?'':'none');m_showRow.toggle(mode!='show');}});}else if(JSINFO.fastwiki.templatename=='arctic'){window.tpl_fastwiki_startmode_support={show:1};$(window).on({'fastwiki:init':function(e,mode){var buttonBars=$('#bar__bottom, #bar__top');if($('.button',buttonBars).length>0)m_utils.fixButtons($('.bar-left'),buttonBars,mode);else{var pagetools=$('.bar-left');m_editRow=$("a[href *= 'do=edit']",pagetools);m_showRow=$("a[href $= 'do=']",pagetools[0]);if(m_showRow.length==0){var url=$("a[href *= 'do=']")[0].href;m_showRow=$();pagetools.each(function(idx,elt){var show=$(m_utils.makeShowLink(url)).toggle(mode!='show');m_showRow=m_showRow.add(show);$(elt).prepend(show);});}}},'fastwiki:afterSwitch':function(e,mode,isSectionEdit,prevMode){m_showRow.toggle(mode!='show');m_editRow.toggle(mode!='edit'&&mode!='draft');$(".left_sidebar, .right_sidebar").css('display',mode=='show'?'':'none');}});}else if($('ul.nav.navbar-nav').length>0){window.tpl_fastwiki_startmode_support={show:1};$(window).on({'fastwiki:init':function(e,mode){var pagetools=$("ul.nav.navbar-nav");m_utils.makeShowRowLI(pagetools,mode);m_editRow=$($('li',pagetools)[0]);},'fastwiki:afterSwitch':function(e,mode,isSectionEdit,prevMode){m_showRow.toggle(mode!='show');m_editRow.toggle(mode!='edit'&&mode!='draft');},'fastwiki:updateToc':function(e,tocObj){$('#dw_toc').remove();if(tocObj.length>0)$('.content_initial').prepend($('<div id="dw_toc"></div>').append(tocObj.html()));tocObj.remove();}});}else if($('.stylehead .bar_top .bar_top_content').length>0){$(window).on({'fastwiki:init':function(e,mode){var toolbox=$(".sidebar_content .li_toolbox ul");m_utils.makeShowRowLI(toolbox,mode);m_editRow=$('.action.edit',toolbox).parent();m_utils.fixButtons($('.bar_bottom_content .bar-right'),$('.bar_bottom_content .bar-right'),mode);},'fastwiki:afterSwitch':function(e,mode,isSectionEdit,prevMode){$(".right_sidebar, .left_sidebar").css('display',mode=='edit'?'none':'');m_showRow.toggle(mode!='show');m_editRow.toggle(mode!='edit'&&mode!='draft');if(mode=='edit'||mode=='draft'){$('.page_720').css({border:0,textAlign:'inherit'});$('.left_page, .right_page').css({float:'none',width:'auto'});}else{$('.page_720').css({border:'',textAlign:''});$('.left_page, .right_page').css({float:'',width:''});}}});}})(jQuery);}if(window.installPluginHiddenJS){jQuery(window).on('fastwiki:afterSwitch',function(evt,viewMode,isSectionEdit,prevViewMode){jQuery(".hiddenActive, .hiddenSwitch").each(function(){jQuery(this).off('click');});if(viewMode=="show")installPluginHiddenJS();});};(function($){"use strict";var feature={};feature.fileapi=$("<input type='file'/>").get(0).files!==undefined;feature.formdata=window.FormData!==undefined;$.fn.ajaxSubmit=function(options){if(!this.length){log('ajaxSubmit: skipping submit process - no element selected');return this;}var method,action,url,$form=this;if(typeof options=='function'){options={success:options};}method=this.attr('method');action=this.attr('action');url=(typeof action==='string')?$.trim(action):'';url=url||window.location.href||'';if(url){url=(url.match(/^([^#]+)/)||[])[1];}options=$.extend(true,{url:url,success:$.ajaxSettings.success,type:method||'GET',iframeSrc:/^https/i.test(window.location.href||'')?'javascript:false':'about:blank'},options);var veto={};this.trigger('form-pre-serialize',[this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-pre-serialize trigger');return this;}if(options.beforeSerialize&&options.beforeSerialize(this,options)===false){log('ajaxSubmit: submit aborted via beforeSerialize callback');return this;}var traditional=options.traditional;if(traditional===undefined){traditional=$.ajaxSettings.traditional;}var elements=[];var qx,a=this.formToArray(options.semantic,elements);if(options.data){options.extraData=options.data;qx=$.param(options.data,traditional);}if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===false){log('ajaxSubmit: submit aborted via beforeSubmit callback');return this;}this.trigger('form-submit-validate',[a,this,options,veto]);if(veto.veto){log('ajaxSubmit: submit vetoed via form-submit-validate trigger');return this;}var q=$.param(a,traditional);if(qx){q=(q?(q+'&'+qx):qx);}if(options.type.toUpperCase()=='GET'){options.url+=(options.url.indexOf('?')>=0?'&':'?')+q;options.data=null;}else{options.data=q;}var callbacks=[];if(options.resetForm){callbacks.push(function(){$form.resetForm();});}if(options.clearForm){callbacks.push(function(){$form.clearForm(options.includeHidden);});}if(!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?'replaceWith':'html';$(options.target)[fn](data).each(oldSuccess,arguments);});}else if(options.success){callbacks.push(options.success);}options.success=function(data,status,xhr){var context=options.context||this;for(var i=0,max=callbacks.length;i<max;i++){callbacks[i].apply(context,[data,status,xhr||$form,$form]);}};var fileInputs=$('input[type=file]:enabled[value!=""]',this);var hasFileInputs=fileInputs.length>0;var mp='multipart/form-data';var multipart=($form.attr('enctype')==mp||$form.attr('encoding')==mp);var fileAPI=feature.fileapi&&feature.formdata;log("fileAPI :"+fileAPI);var shouldUseFrame=(hasFileInputs||multipart)&&!fileAPI;var jqxhr;if(options.iframe!==false&&(options.iframe||shouldUseFrame)){if(options.closeKeepAlive){$.get(options.closeKeepAlive,function(){jqxhr=fileUploadIframe(a);});}else{jqxhr=fileUploadIframe(a);}}else if((hasFileInputs||multipart)&&fileAPI){jqxhr=fileUploadXhr(a);}else{jqxhr=$.ajax(options);}$form.removeData('jqxhr').data('jqxhr',jqxhr);for(var k=0;k<elements.length;k++)elements[k]=null;this.trigger('form-submit-notify',[this,options]);return this;function deepSerialize(extraData){var serialized=$.param(extraData).split('&');var len=serialized.length;var result={};var i,part;for(i=0;i<len;i++){part=serialized[i].split('=');result[decodeURIComponent(part[0])]=decodeURIComponent(part[1]);}return result;}function fileUploadXhr(a){var formdata=new FormData();for(var i=0;i<a.length;i++){formdata.append(a[i].name,a[i].value);}if(options.extraData){var serializedData=deepSerialize(options.extraData);for(var p in serializedData)if(serializedData.hasOwnProperty(p))formdata.append(p,serializedData[p]);}options.data=null;var s=$.extend(true,{},$.ajaxSettings,options,{contentType:false,processData:false,cache:false,type:method||'POST'});if(options.uploadProgress){s.xhr=function(){var xhr=jQuery.ajaxSettings.xhr();if(xhr.upload){xhr.upload.onprogress=function(event){var percent=0;var position=event.loaded||event.position;var total=event.total;if(event.lengthComputable){percent=Math.ceil(position/total*100);}options.uploadProgress(event,position,total,percent);};}return xhr;};}s.data=null;var beforeSend=s.beforeSend;s.beforeSend=function(xhr,o){o.data=formdata;if(beforeSend)beforeSend.call(this,xhr,o);};return $.ajax(s);}function fileUploadIframe(a){var form=$form[0],el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle;var useProp=!!$.fn.prop;var deferred=$.Deferred();if($('[name=submit],[id=submit]',form).length){alert('Error: Form elements must not have name or id of "submit".');deferred.reject();return deferred;}if(a){for(i=0;i<elements.length;i++){el=$(elements[i]);if(useProp)el.prop('disabled',false);else el.removeAttr('disabled');}}s=$.extend(true,{},$.ajaxSettings,options);s.context=s.context||s;id='jqFormIO'+(new Date().getTime());if(s.iframeTarget){$io=$(s.iframeTarget);n=$io.attr('name');if(!n)$io.attr('name',id);else id=n;}else{$io=$('<iframe name="'+id+'" src="'+s.iframeSrc+'" />');$io.css({position:'absolute',top:'-1000px',left:'-1000px'});}io=$io[0];xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:'n/a',getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(status){var e=(status==='timeout'?'timeout':'aborted');log('aborting upload... '+e);this.aborted=1;if(io.contentWindow.document.execCommand){try{io.contentWindow.document.execCommand('Stop');}catch(ignore){}}$io.attr('src',s.iframeSrc);xhr.error=e;if(s.error)s.error.call(s.context,xhr,e,status);if(g)$.event.trigger("ajaxError",[xhr,s,e]);if(s.complete)s.complete.call(s.context,xhr,e);}};g=s.global;if(g&&0===$.active++){$.event.trigger("ajaxStart");}if(g){$.event.trigger("ajaxSend",[xhr,s]);}if(s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===false){if(s.global){$.active--;}deferred.reject();return deferred;}if(xhr.aborted){deferred.reject();return deferred;}sub=form.clk;if(sub){n=sub.name;if(n&&!sub.disabled){s.extraData=s.extraData||{};s.extraData[n]=sub.value;if(sub.type=="image"){s.extraData[n+'.x']=form.clk_x;s.extraData[n+'.y']=form.clk_y;}}}var CLIENT_TIMEOUT_ABORT=1;var SERVER_ABORT=2;function getDoc(frame){var doc=frame.contentWindow?frame.contentWindow.document:frame.contentDocument?frame.contentDocument:frame.document;return doc;}var csrf_token=$('meta[name=csrf-token]').attr('content');var csrf_param=$('meta[name=csrf-param]').attr('content');if(csrf_param&&csrf_token){s.extraData=s.extraData||{};s.extraData[csrf_param]=csrf_token;}function doSubmit(){var t=$form.attr('target'),a=$form.attr('action');form.setAttribute('target',id);if(!method){form.setAttribute('method','POST');}if(a!=s.url){form.setAttribute('action',s.url);}if(!s.skipEncodingOverride&&(!method||/post/i.test(method))){$form.attr({encoding:'multipart/form-data',enctype:'multipart/form-data'});}if(s.timeout){timeoutHandle=setTimeout(function(){timedOut=true;cb(CLIENT_TIMEOUT_ABORT);},s.timeout);}function checkState(){try{var state=getDoc(io).readyState;log('state = '+state);if(state&&state.toLowerCase()=='uninitialized')setTimeout(checkState,50);}catch(e){log('Server abort: ',e,' (',e.name,')');cb(SERVER_ABORT);if(timeoutHandle)clearTimeout(timeoutHandle);timeoutHandle=undefined;}}var extraInputs=[];try{if(s.extraData){for(var n in s.extraData){if(s.extraData.hasOwnProperty(n)){if($.isPlainObject(s.extraData[n])&&s.extraData[n].hasOwnProperty('name')&&s.extraData[n].hasOwnProperty('value')){extraInputs.push($('<input type="hidden" name="'+s.extraData[n].name+'">').attr('value',s.extraData[n].value).appendTo(form)[0]);}else{extraInputs.push($('<input type="hidden" name="'+n+'">').attr('value',s.extraData[n]).appendTo(form)[0]);}}}}if(!s.iframeTarget){$io.appendTo('body');if(io.attachEvent)io.attachEvent('onload',cb);else io.addEventListener('load',cb,false);}setTimeout(checkState,15);form.submit();}finally{form.setAttribute('action',a);if(t){form.setAttribute('target',t);}else{$form.removeAttr('target');}$(extraInputs).remove();}}if(s.forceSync){doSubmit();}else{setTimeout(doSubmit,10);}var data,doc,domCheckCount=50,callbackProcessed;function cb(e){if(xhr.aborted||callbackProcessed){return;}try{doc=getDoc(io);}catch(ex){log('cannot access response document: ',ex);e=SERVER_ABORT;}if(e===CLIENT_TIMEOUT_ABORT&&xhr){xhr.abort('timeout');deferred.reject(xhr,'timeout');return;}else if(e==SERVER_ABORT&&xhr){xhr.abort('server abort');deferred.reject(xhr,'error','server abort');return;}if(!doc||doc.location.href==s.iframeSrc){if(!timedOut)return;}if(io.detachEvent)io.detachEvent('onload',cb);else io.removeEventListener('load',cb,false);var status='success',errMsg;try{if(timedOut){throw'timeout';}var isXml=s.dataType=='xml'||doc.XMLDocument||$.isXMLDoc(doc);log('isXml='+isXml);if(!isXml&&window.opera&&(doc.body===null||!doc.body.innerHTML)){if(--domCheckCount){log('requeing onLoad callback, DOM not available');setTimeout(cb,250);return;}}var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null;xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc;if(isXml)s.dataType='xml';xhr.getResponseHeader=function(header){var headers={'content-type':s.dataType};return headers[header];};if(docRoot){xhr.status=Number(docRoot.getAttribute('status'))||xhr.status;xhr.statusText=docRoot.getAttribute('statusText')||xhr.statusText;}var dt=(s.dataType||'').toLowerCase();var scr=/(json|script|text)/.test(dt);if(scr||s.textarea){var ta=doc.getElementsByTagName('textarea')[0];if(ta){xhr.responseText=ta.value;xhr.status=Number(ta.getAttribute('status'))||xhr.status;xhr.statusText=ta.getAttribute('statusText')||xhr.statusText;}else if(scr){var pre=doc.getElementsByTagName('pre')[0];var b=doc.getElementsByTagName('body')[0];if(pre){xhr.responseText=pre.textContent?pre.textContent:pre.innerText;}else if(b){xhr.responseText=b.textContent?b.textContent:b.innerText;}}}else if(dt=='xml'&&!xhr.responseXML&&xhr.responseText){xhr.responseXML=toXml(xhr.responseText);}try{data=httpData(xhr,dt,s);}catch(e){status='parsererror';xhr.error=errMsg=(e||status);}}catch(e){log('error caught: ',e);status='error';xhr.error=errMsg=(e||status);}if(xhr.aborted){log('upload aborted');status=null;}if(xhr.status){status=(xhr.status>=200&&xhr.status<300||xhr.status===304)?'success':'error';}if(status==='success'){if(s.success)s.success.call(s.context,data,'success',xhr);deferred.resolve(xhr.responseText,'success',xhr);if(g)$.event.trigger("ajaxSuccess",[xhr,s]);}else if(status){if(errMsg===undefined)errMsg=xhr.statusText;if(s.error)s.error.call(s.context,xhr,status,errMsg);deferred.reject(xhr,'error',errMsg);if(g)$.event.trigger("ajaxError",[xhr,s,errMsg]);}if(g)$.event.trigger("ajaxComplete",[xhr,s]);if(g&&!--$.active){$.event.trigger("ajaxStop");}if(s.complete)s.complete.call(s.context,xhr,status);callbackProcessed=true;if(s.timeout)clearTimeout(timeoutHandle);setTimeout(function(){if(!s.iframeTarget)$io.remove();xhr.responseXML=null;},100);}var toXml=$.parseXML||function(s,doc){if(window.ActiveXObject){doc=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(s);}else{doc=(new DOMParser()).parseFromString(s,'text/xml');}return(doc&&doc.documentElement&&doc.documentElement.nodeName!='parsererror')?doc:null;};var parseJSON=$.parseJSON||function(s){return window['eval']('('+s+')');};var httpData=function(xhr,type,s){var ct=xhr.getResponseHeader('content-type')||'',xml=type==='xml'||!type&&ct.indexOf('xml')>=0,data=xml?xhr.responseXML:xhr.responseText;if(xml&&data.documentElement.nodeName==='parsererror'){if($.error)$.error('parsererror');}if(s&&s.dataFilter){data=s.dataFilter(data,type);}if(typeof data==='string'){if(type==='json'||!type&&ct.indexOf('json')>=0){data=parseJSON(data);}else if(type==="script"||!type&&ct.indexOf("javascript")>=0){$.globalEval(data);}}return data;};return deferred;}};$.fn.ajaxForm=function(options){options=options||{};options.delegation=options.delegation&&$.isFunction($.fn.on);if(!options.delegation&&this.length===0){var o={s:this.selector,c:this.context};if(!$.isReady&&o.s){log('DOM not ready, queuing ajaxForm');$(function(){$(o.s,o.c).ajaxForm(options);});return this;}log('terminating; zero elements found by selector'+($.isReady?'':' (DOM not ready)'));return this;}if(options.delegation){$(document).off('submit.form-plugin',this.selector,doAjaxSubmit).off('click.form-plugin',this.selector,captureSubmittingElement).on('submit.form-plugin',this.selector,options,doAjaxSubmit).on('click.form-plugin',this.selector,options,captureSubmittingElement);return this;}return this.ajaxFormUnbind().bind('submit.form-plugin',options,doAjaxSubmit).bind('click.form-plugin',options,captureSubmittingElement);};function doAjaxSubmit(e){var options=e.data;if(!e.isDefaultPrevented()){e.preventDefault();$(this).ajaxSubmit(options);}}function captureSubmittingElement(e){var target=e.target;var $el=$(target);if(!($el.is("[type=submit],[type=image]"))){var t=$el.closest('[type=submit]');if(t.length===0){return;}target=t[0];}var form=this;form.clk=target;if(target.type=='image'){if(e.offsetX!==undefined){form.clk_x=e.offsetX;form.clk_y=e.offsetY;}else if(typeof $.fn.offset=='function'){var offset=$el.offset();form.clk_x=e.pageX-offset.left;form.clk_y=e.pageY-offset.top;}else{form.clk_x=e.pageX-target.offsetLeft;form.clk_y=e.pageY-target.offsetTop;}}setTimeout(function(){form.clk=form.clk_x=form.clk_y=null;},100);}$.fn.ajaxFormUnbind=function(){return this.unbind('submit.form-plugin click.form-plugin');};$.fn.formToArray=function(semantic,elements){var a=[];if(this.length===0){return a;}var form=this[0];var els=semantic?form.getElementsByTagName('*'):form.elements;if(!els){return a;}var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++){el=els[i];n=el.name;if(!n){continue;}if(semantic&&form.clk&&el.type=="image"){if(!el.disabled&&form.clk==el){a.push({name:n,value:$(el).val(),type:el.type});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}continue;}v=$.fieldValue(el,true);if(v&&v.constructor==Array){if(elements)elements.push(el);for(j=0,jmax=v.length;j<jmax;j++){a.push({name:n,value:v[j]});}}else if(feature.fileapi&&el.type=='file'&&!el.disabled){if(elements)elements.push(el);var files=el.files;if(files.length){for(j=0;j<files.length;j++){a.push({name:n,value:files[j],type:el.type});}}else{a.push({name:n,value:'',type:el.type});}}else if(v!==null&&typeof v!='undefined'){if(elements)elements.push(el);a.push({name:n,value:v,type:el.type,required:el.required});}}if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name;if(n&&!input.disabled&&input.type=='image'){a.push({name:n,value:$input.val()});a.push({name:n+'.x',value:form.clk_x},{name:n+'.y',value:form.clk_y});}}return a;};$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic));};$.fn.fieldSerialize=function(successful){var a=[];this.each(function(){var n=this.name;if(!n){return;}var v=$.fieldValue(this,successful);if(v&&v.constructor==Array){for(var i=0,max=v.length;i<max;i++){a.push({name:n,value:v[i]});}}else if(v!==null&&typeof v!='undefined'){a.push({name:this.name,value:v});}});return $.param(a);};$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i];var v=$.fieldValue(el,successful);if(v===null||typeof v=='undefined'||(v.constructor==Array&&!v.length)){continue;}if(v.constructor==Array)$.merge(val,v);else val.push(v);}return val;};$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(successful===undefined){successful=true;}if(successful&&(!n||el.disabled||t=='reset'||t=='button'||(t=='checkbox'||t=='radio')&&!el.checked||(t=='submit'||t=='image')&&el.form&&el.form.clk!=el||tag=='select'&&el.selectedIndex==-1)){return null;}if(tag=='select'){var index=el.selectedIndex;if(index<0){return null;}var a=[],ops=el.options;var one=(t=='select-one');var max=(one?index+1:ops.length);for(var i=(one?index:0);i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(!v){v=(op.attributes&&op.attributes['value']&&!(op.attributes['value'].specified))?op.text:op.value;}if(one){return v;}a.push(v);}}return a;}return $(el).val();};$.fn.clearForm=function(includeHidden){return this.each(function(){$('input,select,textarea',this).clearFields(includeHidden);});};$.fn.clearFields=$.fn.clearInputs=function(includeHidden){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();if(re.test(t)||tag=='textarea'){this.value='';}else if(t=='checkbox'||t=='radio'){this.checked=false;}else if(tag=='select'){this.selectedIndex=-1;}else if(includeHidden){if((includeHidden===true&&/hidden/.test(t))||(typeof includeHidden=='string'&&$(this).is(includeHidden)))this.value='';}});};$.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=='function'||(typeof this.reset=='object'&&!this.reset.nodeType)){this.reset();}});};$.fn.enable=function(b){if(b===undefined){b=true;}return this.each(function(){this.disabled=!b;});};$.fn.selected=function(select){if(select===undefined){select=true;}return this.each(function(){var t=this.type;if(t=='checkbox'||t=='radio'){this.checked=select;}else if(this.tagName.toLowerCase()=='option'){var $sel=$(this).parent('select');if(select&&$sel[0]&&$sel[0].type=='select-one'){$sel.find('option').selected(false);}this.selected=select;}});};$.fn.ajaxSubmit.debug=false;function log(){if(!$.fn.ajaxSubmit.debug)return;var msg='[jquery.form] '+Array.prototype.join.call(arguments,'');if(window.console&&window.console.log){window.console.log(msg);}else if(window.opera&&window.opera.postError){window.opera.postError(msg);}}})(jQuery);jQuery(document).ready(function(){var COOKIE_DESCRIPTION_NAME='DW_Admin_ConfManager_showDescription';var COOKIE_DEFAULTS_NAME='DW_Admin_ConfManager_showDefaults';var ICON_BASE_URL=DOKU_BASE+'lib/plugins/confmanager/icons/';var collapse_icon=ICON_BASE_URL+'collapse.png';var expand_icon=ICON_BASE_URL+'expand.png';var readCookie=function(cookieKey){var ARRcookies=document.cookie.split(";");for(var i=0;i<ARRcookies.length;i++){var key=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));var value=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);key=key.replace(/^\s+|\s+$/g,"");if(key==cookieKey){return decodeURIComponent(value);}}};var setCookie=function(key,value){var expirationDate=new Date();expirationDate.setDate(expirationDate.getDate()+365);document.cookie=encodeURIComponent(key)+'='+encodeURIComponent(value)+'; expires='+expirationDate.toUTCString();};var getBooleanFromCookie=function(key,defaultValue){var cookie=readCookie(key);if(cookie==null||cookie==undefined){return defaultValue==undefined?false:defaultValue;}return cookie=='true';};var setDescriptionVisible=function(show){if(show){jQuery('#description').show();jQuery('#description_toggle_button').attr('src',collapse_icon);}else{jQuery('#description').hide();jQuery('#description_toggle_button').attr('src',expand_icon);}};var setDefaultsVisible=function(show){if(show){jQuery('.defaults').show();jQuery('#defaults_toggle_button').attr('src',collapse_icon);}else{jQuery('.defaults').hide();jQuery('#defaults_toggle_button').attr('src',expand_icon);}};var showDescription=getBooleanFromCookie(COOKIE_DESCRIPTION_NAME,true);var showDefaults=getBooleanFromCookie(COOKIE_DEFAULTS_NAME,true);setDescriptionVisible(showDescription);setDefaultsVisible(showDefaults);jQuery('#toggleDescription').click(function(){showDescription=!showDescription;setDescriptionVisible(showDescription);setCookie(COOKIE_DESCRIPTION_NAME,showDescription);return false;});jQuery('#toggleDefaults').click(function(){showDefaults=!showDefaults;setDefaultsVisible(showDefaults);setCookie(COOKIE_DEFAULTS_NAME,showDefaults);return false;});});jQuery(document).ready(function(){var isInputValid=function(){var result=true;jQuery('.newItem').each(function(){var inputString=jQuery(this).val();if(inputString==null||inputString==''){result=false;}});return result;};var submitForm=function(id){document.forms[id].submit();};jQuery('.deleteButton').click(function(nr){jQuery(this).parent().parent().remove();jQuery('.newItem').each(function(){jQuery(this).val('');});submitForm('configForm');});jQuery('#confmanager__config__files').change(function(){submitForm('select_config_form');});jQuery('.submitOnTab').keydown(function(event){if(event.which!=9){return true;}if(!isInputValid()){return true;}submitForm('configForm');});});jQuery(document).ready(function(){jQuery('.newItem').first().focus();});jQuery(document).ready(function(){var popupVisible=false;var getEntryKey=function(element){var parent=jQuery(element).parent().parent().children().first();var input=jQuery(parent).children('input').first();var value=jQuery(input).attr('value');return value;};var getEntryValue=function(element){var parent=jQuery(element).parent().parent().children().first().next();var input=jQuery(parent).children('input').first();var value=jQuery(input).attr('value');return value;};var unloadPopup=function(){jQuery('.popup_mask').hide();jQuery('.popup').hide();jQuery('#keyParam').removeAttr('value');jQuery('#configIdParam').removeAttr('value');popupVisible=false;};var validate=function(){var file=jQuery('#file_upload_input').val();if(file==''||file==null||file==undefined){return false;}jQuery('#popup_select_file').hide();jQuery('#popup_show_progress').show();jQuery('.popup').css('cursor','wait');return true;};var submitOk=function(){jQuery('#popup_show_progress').hide();jQuery('#popup_success').show();jQuery('.popup').css('cursor','default');};var onError=function(){jQuery('#popup_show_progress').hide();jQuery('#popup_error').show();jQuery('.popup').css('cursor','default');};var showPopup=function(){var width=jQuery('.popup').width();var height=jQuery('.popup').height();jQuery('.popup').css('left',jQuery(window).width()/2-width/2);jQuery('.popup').css('top',jQuery(window).height()/2-height/2);jQuery('.popup').show();popupVisible=true;};var showPopupMask=function(){var width=jQuery(window).width();jQuery('.popup_mask').css('width',jQuery(window).width());jQuery('.popup_mask').css('height',jQuery(window).height());jQuery('.popup_mask').show();};var options={beforeSubmit:validate,success:submitOk,error:onError};jQuery('#fileuploadform').ajaxForm(options);jQuery('.upload_image_button').click(function(){var key=getEntryKey(this);var value=getEntryValue(this);jQuery('#keyParam').val(key);jQuery('#valueParam').val(value);jQuery('#configIdParam').val(JSINFO.configId);showPopup();showPopupMask();});var delete_image_success=function(){document.forms['configForm'].submit();};var delete_image_failed=function(jqXHR,textStatus,errorThrown){alert(errorThrown);};jQuery('.delete_image_button').click(function(){jQuery.ajax({url:DOKU_BASE+'lib/exe/ajax.php',type:'POST',data:{call:'confmanager_deleteIcon',configId:JSINFO.configId,key:getEntryKey(this)},success:delete_image_success,error:delete_image_failed});});jQuery('#popup_cancel').click(function(){unloadPopup();return false;});jQuery(window).resize(function(){if(!popupVisible){return true;}showPopup();showPopupMask();});jQuery('.continue').attr('href',window.location);});jQuery(function(){var $wrap=jQuery('#plugin__captcha_wrapper');if(!$wrap.length)return;var $code=jQuery('#plugin__captcha_code');if($code.length){var $box=$wrap.find('input[type=text]');$box.first().val($code.text().replace(/([^A-Z])+/g,''));$wrap.hide();}var $audiolink=$wrap.find('a');if($audiolink.length){var audio=document.createElement('audio');if(audio){audio.src=$audiolink.attr('href');$wrap.append(audio);$audiolink.click(function(e){audio.play();e.preventDefault();e.stopPropagation();});}}});jQuery(function(){jQuery('#usrmgr__del').click(function(){return confirm(LANG.del_confirm);});});if(typeof JSON!=='object'){JSON={};}(function(){'use strict';function f(n){return n<10?'0'+n:n;}if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf();};}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}if(typeof rep==='function'){value=rep.call(holder,key,value);}switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v;}if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}return str('',{'':value});};}if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}return reviver.call(holder,key,value);}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}throw new SyntaxError('JSON.parse');};}}());jQuery(function(){jQuery('form.plugin_move_form').each(function(){var $form=jQuery(this);$form.find('.click-page').click(function(){$form.find('input[name=dst]').val($form.find('.click-page code').text());$form.find('.select').hide();}).click();$form.find('.click-ns').click(function(){$form.find('input[name=dst]').val($form.find('.click-ns code').text());$form.find('.select').show();});});jQuery('#plugin_move__progress').each(function(){var $this=jQuery(this);var $progressbar=$this.find('.progress');$progressbar.html('');$progressbar.progressbar({value:$progressbar.data('progress')});var setButtons=function(isError){$this.find('.ctlfrm-start').addClass('hide');if(isError){$this.find('.ctlfrm-skip').removeClass('hide');$this.find('.ctlfrm-retry').removeClass('hide');$this.find('.ctlfrm-continue').addClass('hide');}else{$this.find('.ctlfrm-skip').addClass('hide');$this.find('.ctlfrm-retry').addClass('hide');$this.find('.ctlfrm-continue').addClass('hide');}};var nextStep=function(skip){$this.find('.output').html('');$this.find('.controls img').removeClass('hide');setButtons(false);jQuery.post(DOKU_BASE+'lib/exe/ajax.php',{call:'plugin_move_progress',skip:skip},function(data){$progressbar.progressbar('option','value',data.progress);$this.find('.controls img').addClass('hide');if(data.error){$this.find('.output').html('<p><div class="error">'+data.error+'</div></p>');setButtons(true);}else if(data.complete){$progressbar.progressbar('option','value',100);alert(LANG.plugins.move.complete);window.location.href=DOKU_BASE;}else{nextStep(skip);}});};$this.find('.ctl-continue').click(function(e){e.preventDefault();jQuery('#plugin_move__preview').remove();var skip=e.target.form.skip.value;nextStep(skip);});});jQuery('#plugin_move__preview').each(function(){var $this=jQuery(this);$this.find('ul').hide();$this.find('span').click(function(){$this.find('ul').dw_toggle();$this.find('span').toggleClass('closed');}).addClass('closed');});var $GUI=jQuery('#plugin_move__tree');$GUI.show();jQuery('#plugin_move__treelink').show();var checkForMovement=function($li){var $all=$li.add($li.find('li.moved'));$all.each(function(){var $this=jQuery(this);var oldid=$this.data('id');var newid=determineNewID($this);if(newid!=oldid&&!$this.hasClass('created')){$this.addClass('moved');$this.children('div').attr('title',oldid+' -> '+newid);}else{$this.removeClass('moved');$this.children('div').attr('title','');}});};var checkNameAllowed=function($li,$parent,name){var ok=true;$parent.children('li').each(function(){if(this===$li[0])return;var cname='type-f';if($li.hasClass('type-d'))cname='type-d';var $this=jQuery(this);if($this.data('name')==name&&$this.hasClass(cname))ok=false;});return ok;};var determineNewID=function($li){var myname=$li.data('name');var $parent=$li.parent().closest('li');if($parent.length){return(determineNewID($parent)+':'+myname).replace(/^:/,'');}else{return myname;}};var cleanID=function(id){if(!id)return'';id=id.replace(/[!"#$%§&\'()+,/;<=>?@\[\]^`\{|\}~\\;:\/\*]+/g,'_');id=id.replace(/^_+/,'');id=id.replace(/_+$/,'');id=id.toLowerCase();return id;};var initTree=function(){var $li=jQuery(this);var my_root=$li.closest('.tree_root')[0];$li.draggable({revert:true,revertDuration:0,opacity:0.5,stop:function(event,ui){ui.helper.css({height:"auto",width:"auto"});}}).droppable({tolerance:'pointer',greedy:true,accept:function(draggable){return my_root==draggable.closest('.tree_root')[0];},drop:function(event,ui){var $dropped=ui.draggable;var $me=jQuery(this);if($dropped.children('div.li').children('input').prop('checked')){$dropped=$dropped.add(jQuery(my_root).find('input').filter(function(){return jQuery(this).prop('checked');}).parent().parent());}if($me.parents().addBack().is($dropped)){return;}var insert_child=!($me.hasClass("type-f")||$me.hasClass("closed"));var $new_parent=insert_child?$me.children('ul'):$me.parent();var allowed=true;$dropped.each(function(){var $this=jQuery(this);allowed&=checkNameAllowed($this,$new_parent,$this.data('name'));});if(allowed){if(insert_child){$dropped.prependTo($new_parent);}else{$dropped.insertAfter($me);}}checkForMovement($dropped);}}).find('img.rename').attr('title',LANG.plugins.move.renameitem).end().find('img.add').attr('title',LANG.plugins.move.add);};var add_template='<li class="type-d open created" data-name="%s" data-id="%s"><div class="li"><input type="checkbox"> <a href="%s" class="idx_dir">%s</a><img class="rename" src="'+DOKU_BASE+'lib/plugins/move/images/rename.png"></div><ul class="tree_list"></ul></li>';$GUI.find('div.tree_root > ul.tree_list').click(function(e){var $clicky=jQuery(e.target);var $li=$clicky.parent().parent();if($clicky[0].tagName=='A'&&$li.hasClass('type-d')){e.stopPropagation();if($li.hasClass('open')){$li .removeClass('open').addClass('closed');}else{$li .removeClass('closed').addClass('open');if(!$li.find('ul').length){var is_media=$li.closest('div.tree_root').hasClass('tree_media')?1:0;jQuery.post(DOKU_BASE+'lib/exe/ajax.php',{call:'plugin_move_tree',ns:$clicky.attr('href'),is_media:is_media},function(data){$li.append(data);$li.find('li').each(initTree);});}}e.preventDefault();}else if($clicky[0].tagName=='IMG'){e.stopPropagation();var $a=$clicky.parent().find('a');if($clicky.hasClass('rename')){var newname=window.prompt(LANG.plugins.move.renameitem,$li.data('name'));newname=cleanID(newname);if(newname){if(checkNameAllowed($li,$li.parent(),newname)){$li.data('name',newname);$a.text(newname);checkForMovement($li);}else{alert(LANG.plugins.move.duplicate.replace('%s',newname));}}}else{var newname=window.prompt(LANG.plugins.move.add);newname=cleanID(newname);if(newname){if(checkNameAllowed($li,$li.children('ul'),newname)){var $new_li=jQuery(add_template.replace(/%s/g,newname));$li.children('ul').prepend($new_li);$new_li.each(initTree);}else{alert(LANG.plugins.move.duplicate.replace('%s',newname));}}}e.preventDefault();}}).find('li').each(initTree);jQuery('#plugin_move__tree_execute').submit(function(e){var data=[];$GUI.find('.tree_pages .moved').each(function(idx,el){var $el=jQuery(el);var newid=determineNewID($el);data[data.length]={'class':$el.hasClass('type-d')?'ns':'doc',type:'page',src:$el.data('id'),dst:newid};});$GUI.find('.tree_media .moved').each(function(idx,el){var $el=jQuery(el);var newid=determineNewID($el);data[data.length]={'class':$el.hasClass('type-d')?'ns':'doc',type:'media',src:$el.data('id'),dst:newid};});jQuery(this).find('input[name=json]').val(JSON.stringify(data));});if(JSINFO.move_renameokay)jQuery('.plugin_move_page').show().click(function(e){e.preventDefault();var renameFN=function(){var self=this;var newid=$dialog.find('input[name=id]').val();if(!newid)return false;$dialog.html('<img src="'+DOKU_BASE+'lib/images/throbber.gif" /> '+LANG.plugins.move.inprogress);$dialog.dialog('option','buttons',[]);jQuery.post(DOKU_BASE+'lib/exe/ajax.php',{call:'plugin_move_rename',id:JSINFO.id,newid:newid},function(result){if(result.error){$dialog.html(result.error.msg);}else{window.location.href=result.redirect_url;}});return false;};var $dialog=jQuery('<div>'+'<form>'+'<label>'+LANG.plugins.move.newname+'<br>'+'<input type="text" name="id" style="width:100%">'+'</label>'+'</form>'+'</div>');$dialog.find('input[name=id]').val(JSINFO.id);$dialog.find('form').submit(renameFN);$dialog.dialog({title:LANG.plugins.move.rename+' '+JSINFO.id,width:800,height:180,dialogClass:'plugin_move_dialog',modal:true,buttons:[{text:LANG.plugins.move.cancel,click:function(){$dialog.dialog("close");}},{text:LANG.plugins.move.rename,click:renameFN}],close:function(){jQuery(this).remove();}})});});function QuickstatsShowPage(ns){var page=DOKU_BASE+'doku.php?&id='+ns;window.open(page,'quickstats_win',"width=900,height=600,scrollbars=yes,resizable=yes");}function uncheck(key){var dom=document.getElementById(key);dom.style.backgroundColor='white';key=key+'_1';var dom=document.getElementById(key);dom.style.backgroundColor='white';}function qs_close_panel(which){var dom=document.getElementById(which);dom.style.display='none';}function qs_open_panel(which){var dom=document.getElementById(which);dom.style.display='block';}function qs_open_info(which){var dom=document.getElementById(which);if(dom.style.display=='block'){qs_close_panel(which);return;}qs_open_panel(which);qs_open_panel('quick__stats');qs_close_panel('qs_general_intro');}function toggle_panel(which){qs_close_panel('qs_general_intro');var dom=document.getElementById(which);var display=dom.style.display;if(display=='block'){dom.style.display='none';}else if(display=='none'){dom.style.display='block';}else dom.style.display='block';}function qs_check_year(year){if(!year)year=document.getElementById('year');if(parseInt(year.value)<2010){alert("Year values must have four digits, e.g 2012");return false;}return true;}function checkforJQuery(){}function onChangeQS(which){if(which.selectedIndex==0){alert('You must select a <namespace:>page');return;}QuickstatsShowPage(which.options[which.selectedIndex].value);}function qs_priority_error(err){elems=err.split(';;');alert('You have selected '+elems[0]+' priority, but have not  '+elems[1]+' in your query');}var qs_timer_on=false;var qs_tid;var qs_seconds=0;function set_timer(dom,immediate_display){qs_timer_on=true;var max_script_time=document.getElementById('qs_script_max_time').value;var throbber=DOKU_BASE+'lib/plugins/quickstats/throbber.gif';dom.innerHTML="<div id='qs_throbber_div' style='display:none'><center>Loading<br /><br /><img src='"+throbber+"'><br /><span id='qs_throbber_tm'></span></center></div>";qs_tid=setInterval("qs_timer()",1025);var dom=document.getElementById("qs_throbber_div");if(!immediate_display){dom.style.display='none';}else dom.style.display='block';}function qs_timer(){if(qs_seconds&&!qs_timer_on){clearInterval(qs_tid);return;}qs_seconds++;if(qs_seconds<8)return;var dom=document.getElementById("qs_throbber_div");if(dom.style.display=='none'||dom.style.display=='')dom.style.display='block';var dom=document.getElementById("qs_throbber_tm");if(!dom){clearInterval(qs_tid);return;}dom.innerHTML=qs_seconds;}function getExtendedData(f,DOKU_INCL){var priority_error="";var priority="";var page="";qs_seconds=0;if(!qs_check_year(null))return;var params="doku_inc="+encodeURIComponent(DOKU_INCL);var inp=f.getElementsByTagName('input');for(el in inp){if(inp[el].type=='hidden'){var p='&'+inp[el].name+'='+inp[el].value;params+=p;}}var ignore=document.getElementById('qs_ignore').checked;var p_brief=document.getElementById('qs_p_brief');if(p_brief.checked)params+="&p_brief=1";var months=document.getElementById('month');if(months.selectedIndex==0&&!whole_year.checked){alert("You must select a month");return;}else month=months.selectedIndex;var priority_types=new Array('page','ip','agent','country');for(var p in priority_types){var dom=document.getElementById('qs_priority_'+priority_types[p]);if(dom.checked){priority=priority_types[p];}}if(priority!='ip'){var countries=document.getElementById('country_names');var option=countries.options[countries.selectedIndex];var country_set=false;if(option.value!=0){if(!ignore||priority=='country'){params+="&country_name="+encodeURIComponent(option.text);params+="&country_code="+encodeURIComponent(option.value);country_set=true;}}var ua_set=false;var ua=document.getElementById('user_agent');var option=ua.options[ua.selectedIndex];if(option.value!=0){if(!ignore||priority=='agent'){params+="&user_agent="+encodeURIComponent(option.value);ua_set=true;}}var page=document.getElementById('page').value;}var ip=document.getElementById('ip').value;if(!country_set&&!page&&!ip&&!ua_set){alert('Query term(s) missing: Page/IP/Country/User Agent');return;}if(priority=='page'&&!page){priority_error='page;;entered a page name';}else if(priority=='country'&&!country_set){priority_error='country;;chosen a Country';}else if(priority=='agent'&&!ua_set){priority_error='user agent;;selected a User Agent';}else if(priority=='ip'&&!ip){priority_error='ip;;entered an IP address';}if(priority_error){qs_priority_error(priority_error);return;}params+='&priority='+priority;if(!ignore||priority=='ip'){if(ip!=""){params+="&ip="+ip;}}if(!ignore||priority=='page'){if(page!=""){params+="&page="+page;}}var year=document.getElementById('year').value;date='&date='+month+'_'+year;for(i=months.selectedIndex+1;i<months.options.length;i++){if(months.options[i].selected){date+='&date_'+i+'='+i+'_'+year;}}params+=date;var dom=document.getElementById('extended_data');set_timer(dom,false);jQuery.post(DOKU_BASE+'lib/plugins/quickstats/scripts/extended_data.php',params,function(data){qs_timer_on=false;dom.innerHTML=decodeURIComponent(decodeURIComponent(data));},'html');}function qs_country_search(){var select=document.getElementById('country_names');var params="";params+="doku_inc="+encodeURIComponent(DOKU_BASE);var dom=document.getElementById('cc_extra');params+='&cc_cntry='+dom.value;jQuery.post(DOKU_BASE+'lib/plugins/quickstats/scripts/country_data.php',params,function(data){if(!data){alert("Nothing found  for "+dom.value);return;}var str=decodeURIComponent(data);var entries=str.split(/\n/);for(i=0;i<entries.length;i++){var elems=entries[i].split(/::/);var obj=new Option(elems[1],elems[0],false,false);select.add(obj,1);}},'html');}function qs_agent_search(){var select=document.getElementById('user_agent');var params="";var dom=document.getElementById('other_agent');params+='&other_agent='+encodeURIComponent(dom.value);jQuery.post(DOKU_BASE+'lib/plugins/quickstats/scripts/get_useragent.php',params,function(data){if(!data){alert("Nothing found  for "+dom.value);return;}var str=decodeURIComponent(data);var entries=str.split(/::/);if(!entries.length)return;for(i=0;i<entries.length;i++){var obj=new Option(entries[i],entries[i],false,false);select.add(obj,1);}},'html');}function qs_download_GeoLite(geoip_local){var params="&geoip_local="+geoip_local;var dom=document.getElementById('download_results');qs_seconds=0;set_timer(dom,true);jQuery.post(DOKU_BASE+'lib/plugins/quickstats/scripts/get_geocity.php',params,function(data){dom.innerHTML='<pre>'+data+'</pre>';},'html');}jQuery(document).ready(function(){if(JSINFO['ajax']=='ajax'){var act=JSINFO['act']?JSINFO['act']:"";var params='call=quickstats&id='+JSINFO['id']+"&qs="+location.search+'&act='+act;jQuery.post(DOKU_BASE+'lib/exe/ajax.php',params,function(data){if(data)alert(data);},'html');}});color_icobase="../../plugins/color/images/";if(window.toolbar!=undefined){toolbar[toolbar.length]={"type":"picker","title":"Color Text","icon":color_icobase+"toolbar_icon.png","list":[{"type":"format","title":"Gray Colored Text","icon":color_icobase+"picker_light_gray.png","open":"<color #c3c3c3>","close":"</color>"},{"type":"format","title":"Rose Highlighted Text","icon":color_icobase+"picker_rose.png","open":"<color #ffaec9>","close":"</color>"},{"type":"format","title":"Red Highlighted Text","icon":color_icobase+"picker_red.png","open":"<color #ed1c24>","close":"</color>"},{"type":"format","title":"Orange Highlighted Text","icon":color_icobase+"picker_orange.png","open":"<color #ff7f27>","close":"</color>"},{"type":"format","title":"Gold Highlighted Text","icon":color_icobase+"picker_gold.png","open":"<color #ffc90e>","close":"</color>"},{"type":"format","title":"Yellow Highlighted Text","icon":color_icobase+"picker_yellow.png","open":"<color #fff200>","close":"</color>"},{"type":"format","title":"Light Yellow Highlighted Text","icon":color_icobase+"picker_light_yellow.png","open":"<color #efe4B0>","close":"</color>"},{"type":"format","title":"Green Highlighted Text","icon":color_icobase+"picker_green.png","open":"<color #22b14c>","close":"</color>"},{"type":"format","title":"Lime Highlighted Text","icon":color_icobase+"picker_lime.png","open":"<color #b5e61d>","close":"</color>"},{"type":"format","title":"Turquoise Highlighted Text","icon":color_icobase+"picker_turquoise.png","open":"<color #00a2e8>","close":"</color>"},{"type":"format","title":"Light Turquoise Highlighted Text","icon":color_icobase+"picker_light_turquoise.png","open":"<color #99d9ea>","close":"</color>"},{"type":"format","title":"Blue-Gray Highlighted Text","icon":color_icobase+"picker_blue_gray.png","open":"<color #7092be>","close":"</color>"},{"type":"format","title":"Lavender Highlighted Text","icon":color_icobase+"picker_lavender.png","open":"<color #c8bfe7>","close":"</color>"}]};}jQuery(function(){var $extmgr=jQuery('#extension__manager');$extmgr.find('button.uninstall').click(function(e){if(!window.confirm(LANG.plugins.extension.reallydel)){e.preventDefault();return false;}return true;});$extmgr.find('a.extension_screenshot').click(function(e){e.preventDefault();var image_href=jQuery(this).attr("href");var $lightbox=jQuery('#plugin__extensionlightbox');if(!$lightbox.length){$lightbox=jQuery('<div id="plugin__extensionlightbox"><p>Click to close</p><div></div></div>').appendTo(jQuery('body')).hide().click(function(){$lightbox.hide();});}$lightbox .show().find('div').html('<img src="'+image_href+'" />');return false;});$extmgr.find('button.disable, button.enable').click(function(e){e.preventDefault();var $btn=jQuery(this);var extension=$btn.attr('name').split('[')[2];extension=extension.substr(0,extension.length-1);var act=($btn.hasClass('disable'))?'disable':'enable';$btn.attr('disabled','disabled');$btn.css('cursor','wait');jQuery.get(DOKU_BASE+'lib/exe/ajax.php',{call:'plugin_extension',ext:extension,act:act},function(data){$btn.css('cursor','').removeAttr('disabled').removeClass('disable').removeClass('enable').text(data.label).addClass(data.reverse).parents('li').removeClass('disabled').removeClass('enabled').addClass(data.state);});});$extmgr.find('a.info').click(function(e){e.preventDefault();var $link=jQuery(this);var $details=$link.parent().find('dl.details');if($details.length){$link.toggleClass('close');$details.toggle();return;}$link.addClass('close');jQuery.get(DOKU_BASE+'lib/exe/ajax.php',{call:'plugin_extension',ext:$link.data('extid'),act:'info'},function(data){$link.parent().append(data);});});if($extmgr.find('.plugins, .templates').hasClass('active')){var $extlist=jQuery('#extension__list');$extlist.addClass('hasDisplayOptions');var $displayOpts=jQuery('<p>',{id:'extension__viewoptions'}).appendTo($extmgr.find('.panelHeader'));$displayOpts.append(LANG.plugins.extension.display_viewoptions);var displayOptionsHandler=function(){$extlist.toggleClass(this.name);DokuCookie.setValue('ext_'+this.name,$extlist.hasClass(this.name)?'1':'0');};jQuery(['enabled','disabled','updatable']).each(function(index,chkName){var $label=jQuery('<label></label>').appendTo($displayOpts);var $input=jQuery('<input />',{type:'checkbox',name:chkName}).change(displayOptionsHandler).appendTo($label);var previous=DokuCookie.getValue('ext_'+chkName);if(typeof previous==="undefined"||previous=='1'){$input.click();}jQuery('<span/>').append(' '+LANG.plugins.extension['display_'+chkName]).appendTo($label);});}});if(JSINFO.ga){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create',JSINFO.ga.trackingId,'auto',JSINFO.ga.options);ga('set','forceSSL',true);ga('set','anonymizeIp',JSINFO.ga.anonymizeIp);ga('set','dimension1',JSINFO.ga.action);ga('set','dimension2',JSINFO.ga.id);ga('send','pageview',JSINFO.ga.pageview);ga('send','event','wiki-action',JSINFO.ga.action,JSINFO.id,{nonInteraction:true});if(JSINFO.ga.trackOutboundLinks){jQuery(function(){jQuery('a.urlextern, a.interwiki').click(function(e){e.preventDefault();var url=this.href;ga('send','event','outbound','click',url,{'transport':'beacon','hitCallback':function(){document.location=url;}});});});}}jQuery(function(){jQuery('form.bureaucracy__plugin').each(function(){function updateFieldset(input){jQuery.each(jQuery(input).data('dparray'),function(i,dp){var showOrHide=input.parentNode.parentNode.style.display!=='none'&&((input.checked===dp.tval)||(input.type!=='checkbox'&&(dp.tval===true&&input.value!==''))||input.value===dp.tval);dp.fset.toggle(showOrHide);dp.fset.find('input,select').each(function(){var $inputelem=jQuery(this);if($inputelem.hasClass('required')){if(showOrHide){$inputelem.attr('required','required');}else{$inputelem.removeAttr('required')}}if($inputelem.data('dparray')){$inputelem.change();}});});}jQuery('p.bureaucracy_depends',this).each(function(){var fname=jQuery(this).find('span.bureaucracy_depends_fname').html(),fvalue=jQuery(this).find('span.bureaucracy_depends_fvalue');fvalue=(fvalue.length?fvalue.html():true);var fieldsetinfo={fset:jQuery(this).parent(),tval:fvalue};jQuery("label").has(":first-child:contains('"+fname+"')").first().find("select,input:last").each(function(){if(!jQuery(this).data('dparray')){jQuery(this).data('dparray',[fieldsetinfo]);}else{jQuery(this).data('dparray').push(fieldsetinfo);}}).bind('change keyup',function(){updateFieldset(this);}).change();}).hide();});});jQuery(function(){function ajaxsource(request,response,getterm){jQuery.getJSON(DOKU_BASE+'lib/exe/ajax.php',{call:'bureaucracy_user_field',search:getterm(request)},function(data){response(jQuery.map(data,function(name,user){return{label:name+' ('+user+')',value:user}}))});}function split(val){return val.split(/,\s*/);}function extractLast(term){return split(term).pop();}jQuery(".userpicker").autocomplete({source:function(request,response){ajaxsource(request,response,function(req){return req.term})}});jQuery(".userspicker").bind("keydown",function(event){if(event.keyCode===jQuery.ui.keyCode.TAB&&jQuery(this).data("ui-autocomplete").menu.active){event.preventDefault();}}).autocomplete({minLength:0,source:function(request,response){ajaxsource(request,response,function(req){return extractLast(req.term)})},search:function(){var term=extractLast(this.value);return term.length>=2;},focus:function(){return false;},select:function(event,ui){var terms=split(this.value);terms.pop();terms.push(ui.item.value);terms.push("");this.value=terms.join(", ");return false;}});});jQuery(function(){jQuery('.bureaucracy__plugin .datepicker').datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true});});;(function($){var plugin={};var defaults={mode:'horizontal',slideSelector:'',infiniteLoop:true,hideControlOnEnd:false,speed:500,easing:null,slideMargin:0,startSlide:0,randomStart:false,captions:false,ticker:false,tickerHover:false,adaptiveHeight:false,adaptiveHeightSpeed:500,video:false,useCSS:true,preloadImages:'visible',responsive:true,touchEnabled:true,swipeThreshold:50,oneToOneTouch:true,preventDefaultSwipeX:true,preventDefaultSwipeY:false,pager:true,pagerType:'full',pagerShortSeparator:' / ',pagerSelector:null,buildPager:null,pagerCustom:null,controls:true,nextText:'Next',prevText:'Prev',nextSelector:null,prevSelector:null,autoControls:false,startText:'Start',stopText:'Stop',autoControlsCombine:false,autoControlsSelector:null,auto:false,pause:4000,autoStart:true,autoDirection:'next',autoHover:false,autoDelay:0,minSlides:1,maxSlides:1,moveSlides:0,slideWidth:0,onSliderLoad:function(){},onSlideBefore:function(){},onSlideAfter:function(){},onSlideNext:function(){},onSlidePrev:function(){}};$.fn.bxSlider=function(options){if(this.length==0)return this;if(this.length>1){this.each(function(){$(this).bxSlider(options)});return this;}var slider={};var el=this;plugin.el=this;var windowWidth=$(window).width();var windowHeight=$(window).height();var init=function(){slider.settings=$.extend({},defaults,options);slider.settings.slideWidth=parseInt(slider.settings.slideWidth);slider.children=el.children(slider.settings.slideSelector);if(slider.children.length<slider.settings.minSlides)slider.settings.minSlides=slider.children.length;if(slider.children.length<slider.settings.maxSlides)slider.settings.maxSlides=slider.children.length;if(slider.settings.randomStart)slider.settings.startSlide=Math.floor(Math.random()*slider.children.length);slider.active={index:slider.settings.startSlide};slider.carousel=slider.settings.minSlides>1||slider.settings.maxSlides>1;if(slider.carousel)slider.settings.preloadImages='all';slider.minThreshold=(slider.settings.minSlides*slider.settings.slideWidth)+((slider.settings.minSlides-1)*slider.settings.slideMargin);slider.maxThreshold=(slider.settings.maxSlides*slider.settings.slideWidth)+((slider.settings.maxSlides-1)*slider.settings.slideMargin);slider.working=false;slider.controls={};slider.interval=null;slider.animProp=slider.settings.mode=='vertical'?'top':'left';slider.usingCSS=slider.settings.useCSS&&slider.settings.mode!='fade'&&(function(){var div=document.createElement('div');var props=['WebkitPerspective','MozPerspective','OPerspective','msPerspective'];for(var i in props){if(div.style[props[i]]!==undefined){slider.cssPrefix=props[i].replace('Perspective','').toLowerCase();slider.animProp='-'+slider.cssPrefix+'-transform';return true;}}return false;}());if(slider.settings.mode=='vertical')slider.settings.maxSlides=slider.settings.minSlides;el.data("origStyle",el.attr("style"));el.children(slider.settings.slideSelector).each(function(){$(this).data("origStyle",$(this).attr("style"));});setup();};var setup=function(){el.wrap('<div class="bx-wrapper"><div class="bx-viewport"></div></div>');slider.viewport=el.parent();slider.loader=$('<div class="bx-loading" />');slider.viewport.prepend(slider.loader);el.css({width:slider.settings.mode=='horizontal'?(slider.children.length*100+215)+'%':'auto',position:'relative'});if(slider.usingCSS&&slider.settings.easing){el.css('-'+slider.cssPrefix+'-transition-timing-function',slider.settings.easing);}else if(!slider.settings.easing){slider.settings.easing='swing';}var slidesShowing=getNumberSlidesShowing();slider.viewport.css({width:'100%',overflow:'hidden',position:'relative'});slider.viewport.parent().css({maxWidth:getViewportMaxWidth()});if(!slider.settings.pager){slider.viewport.parent().css({margin:'0 auto 0px'});}slider.children.css({'float':slider.settings.mode=='horizontal'?'left':'none',listStyle:'none',position:'relative'});slider.children.css('width',getSlideWidth());if(slider.settings.mode=='horizontal'&&slider.settings.slideMargin>0)slider.children.css('marginRight',slider.settings.slideMargin);if(slider.settings.mode=='vertical'&&slider.settings.slideMargin>0)slider.children.css('marginBottom',slider.settings.slideMargin);if(slider.settings.mode=='fade'){slider.children.css({position:'absolute',zIndex:0,display:'none'});slider.children.eq(slider.settings.startSlide).css({zIndex:50,display:'block'});}slider.controls.el=$('<div class="bx-controls" />');if(slider.settings.captions)appendCaptions();slider.active.last=slider.settings.startSlide==getPagerQty()-1;if(slider.settings.video)el.fitVids();var preloadSelector=slider.children.eq(slider.settings.startSlide);if(slider.settings.preloadImages=="all")preloadSelector=slider.children;if(!slider.settings.ticker){if(slider.settings.pager)appendPager();if(slider.settings.controls)appendControls();if(slider.settings.auto&&slider.settings.autoControls)appendControlsAuto();if(slider.settings.controls||slider.settings.autoControls||slider.settings.pager)slider.viewport.after(slider.controls.el);}else{slider.settings.pager=false;}loadElements(preloadSelector,start);};var loadElements=function(selector,callback){var total=selector.find('img, iframe').length;if(total==0){callback();return;}var count=0;var checkIfAllLoaded=function(){if(++count==total)callback();};selector.find('img, iframe').each(function(){var el=$(this);if(el.is('img')){var img=new Image(),loaded=false;$(img).on('load',function(){if(loaded)return;loaded=true;setTimeout(checkIfAllLoaded,0);});img.src=el.attr('src');setTimeout(function(){if(img.width&&!loaded){loaded=true;setTimeout(checkIfAllLoaded,0);}},0);return;}el.on('load',function(){setTimeout(checkIfAllLoaded,0);});});};var start=function(){if(slider.settings.infiniteLoop&&slider.settings.mode!='fade'&&!slider.settings.ticker){var slice=slider.settings.mode=='vertical'?slider.settings.minSlides:slider.settings.maxSlides;var sliceAppend=slider.children.slice(0,slice).clone().addClass('bx-clone');var slicePrepend=slider.children.slice(-slice).clone().addClass('bx-clone');el.append(sliceAppend).prepend(slicePrepend);}slider.loader.remove();setSlidePosition();if(slider.settings.mode=='vertical')slider.settings.adaptiveHeight=true;slider.viewport.height(getViewportHeight());el.redrawSlider();slider.settings.onSliderLoad(slider.active.index);slider.initialized=true;if(slider.settings.responsive)$(window).bind('resize',resizeWindow);if(slider.settings.auto&&slider.settings.autoStart&&slider.children.length>1)initAuto();if(slider.settings.ticker)initTicker();if(slider.settings.pager)updatePagerActive(slider.settings.startSlide);if(slider.settings.controls)updateDirectionControls();if(slider.settings.touchEnabled&&!slider.settings.ticker)initTouch();};var getViewportHeight=function(){var height=0;var children=$();if(slider.settings.mode!='vertical'&&!slider.settings.adaptiveHeight){children=slider.children;}else{if(!slider.carousel){children=slider.children.eq(slider.active.index);}else{var currentIndex=slider.settings.moveSlides==1?slider.active.index:slider.active.index*getMoveBy();children=slider.children.eq(currentIndex);for(i=1;i<=slider.settings.maxSlides-1;i++){if(currentIndex+i>=slider.children.length){children=children.add(slider.children.eq(i-1));}else{children=children.add(slider.children.eq(currentIndex+i));}}}}if(slider.settings.mode=='vertical'){children.each(function(index){height+=$(this).outerHeight();});if(slider.settings.slideMargin>0){height+=slider.settings.slideMargin*(slider.settings.minSlides-1);}}else{height=Math.max.apply(Math,children.map(function(){return $(this).outerHeight(false);}).get());}return height;};var getViewportMaxWidth=function(){var width='100%';if(slider.settings.slideWidth>0){if(slider.settings.mode=='horizontal'){width=(slider.settings.maxSlides*slider.settings.slideWidth)+((slider.settings.maxSlides-1)*slider.settings.slideMargin);}else{width=slider.settings.slideWidth;}}return width;};var getSlideWidth=function(){var newElWidth=slider.settings.slideWidth;var wrapWidth=slider.viewport.width();if(slider.settings.slideWidth==0||(slider.settings.slideWidth>wrapWidth&&!slider.carousel)||slider.settings.mode=='vertical'){newElWidth=wrapWidth;}else if(slider.settings.maxSlides>1&&slider.settings.mode=='horizontal'){if(wrapWidth>slider.maxThreshold){}else if(wrapWidth<slider.minThreshold){newElWidth=(wrapWidth-(slider.settings.slideMargin*(slider.settings.minSlides-1)))/slider.settings.minSlides;}}return newElWidth;};var getNumberSlidesShowing=function(){var slidesShowing=1;if(slider.settings.mode=='horizontal'&&slider.settings.slideWidth>0){if(slider.viewport.width()<slider.minThreshold){slidesShowing=slider.settings.minSlides;}else if(slider.viewport.width()>slider.maxThreshold){slidesShowing=slider.settings.maxSlides;}else{var childWidth=slider.children.first().width();slidesShowing=Math.floor(slider.viewport.width()/childWidth);}}else if(slider.settings.mode=='vertical'){slidesShowing=slider.settings.minSlides;}return slidesShowing;};var getPagerQty=function(){var pagerQty=0;if(slider.settings.moveSlides>0){if(slider.settings.infiniteLoop){pagerQty=slider.children.length/getMoveBy();}else{var breakPoint=0;var counter=0;while(breakPoint<slider.children.length){++pagerQty;breakPoint=counter+getNumberSlidesShowing();counter+=slider.settings.moveSlides<=getNumberSlidesShowing()?slider.settings.moveSlides:getNumberSlidesShowing();}}}else{pagerQty=Math.ceil(slider.children.length/getNumberSlidesShowing());}return pagerQty;};var getMoveBy=function(){if(slider.settings.moveSlides>0&&slider.settings.moveSlides<=getNumberSlidesShowing()){return slider.settings.moveSlides;}return getNumberSlidesShowing();};var setSlidePosition=function(){if(slider.children.length>slider.settings.maxSlides&&slider.active.last&&!slider.settings.infiniteLoop){if(slider.settings.mode=='horizontal'){var lastChild=slider.children.last();var position=lastChild.position();setPositionProperty(-(position.left-(slider.viewport.width()-lastChild.width())),'reset',0);}else if(slider.settings.mode=='vertical'){var lastShowingIndex=slider.children.length-slider.settings.minSlides;var position=slider.children.eq(lastShowingIndex).position();setPositionProperty(-position.top,'reset',0);}}else{var position=slider.children.eq(slider.active.index*getMoveBy()).position();if(slider.active.index==getPagerQty()-1)slider.active.last=true;if(position!=undefined){if(slider.settings.mode=='horizontal')setPositionProperty(-position.left,'reset',0);else if(slider.settings.mode=='vertical')setPositionProperty(-position.top,'reset',0);}}};var setPositionProperty=function(value,type,duration,params){if(slider.usingCSS){var propValue=slider.settings.mode=='vertical'?'translate3d(0, '+value+'px, 0)':'translate3d('+value+'px, 0, 0)';el.css('-'+slider.cssPrefix+'-transition-duration',duration/1000+'s');if(type=='slide'){el.css(slider.animProp,propValue);el.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd',function(){el.unbind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');updateAfterSlideTransition();});}else if(type=='reset'){el.css(slider.animProp,propValue);}else if(type=='ticker'){el.css('-'+slider.cssPrefix+'-transition-timing-function','linear');el.css(slider.animProp,propValue);el.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd',function(){el.unbind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');setPositionProperty(params['resetValue'],'reset',0);tickerLoop();});}}else{var animateObj={};animateObj[slider.animProp]=value;if(type=='slide'){el.animate(animateObj,duration,slider.settings.easing,function(){updateAfterSlideTransition();});}else if(type=='reset'){el.css(slider.animProp,value)}else if(type=='ticker'){el.animate(animateObj,speed,'linear',function(){setPositionProperty(params['resetValue'],'reset',0);tickerLoop();});}}};var populatePager=function(){var pagerHtml='';var pagerQty=getPagerQty();if(pagerQty<=1)return;for(var i=0;i<pagerQty;i++){var linkContent='';if(slider.settings.buildPager&&$.isFunction(slider.settings.buildPager)){linkContent=slider.settings.buildPager(i);slider.pagerEl.addClass('bx-custom-pager');}else{linkContent=i+1;slider.pagerEl.addClass('bx-default-pager');}pagerHtml+='<div class="bx-pager-item"><a href="" data-slide-index="'+i+'" class="bx-pager-link">'+linkContent+'</a></div>';};slider.pagerEl.html(pagerHtml);};var appendPager=function(){if(!slider.settings.pagerCustom){slider.pagerEl=$('<div class="bx-pager" />');if(slider.settings.pagerSelector){$(slider.settings.pagerSelector).html(slider.pagerEl);}else{slider.controls.el.addClass('bx-has-pager').append(slider.pagerEl);}populatePager();}else{slider.pagerEl=$(slider.settings.pagerCustom);}slider.pagerEl.delegate('a','click',clickPagerBind);};var appendControls=function(){slider.controls.next=$('<a class="bx-next" href="">'+slider.settings.nextText+'</a>');slider.controls.prev=$('<a class="bx-prev" href="">'+slider.settings.prevText+'</a>');slider.controls.next.bind('click',clickNextBind);slider.controls.prev.bind('click',clickPrevBind);if(slider.settings.nextSelector){$(slider.settings.nextSelector).append(slider.controls.next);}if(slider.settings.prevSelector){$(slider.settings.prevSelector).append(slider.controls.prev);}if(!slider.settings.nextSelector&&!slider.settings.prevSelector){slider.controls.directionEl=$('<div class="bx-controls-direction" />');slider.controls.directionEl.append(slider.controls.prev).append(slider.controls.next);slider.controls.el.addClass('bx-has-controls-direction').append(slider.controls.directionEl);}};var appendControlsAuto=function(){slider.controls.start=$('<div class="bx-controls-auto-item"><a class="bx-start" href="">'+slider.settings.startText+'</a></div>');slider.controls.stop=$('<div class="bx-controls-auto-item"><a class="bx-stop" href="">'+slider.settings.stopText+'</a></div>');slider.controls.autoEl=$('<div class="bx-controls-auto" />');slider.controls.autoEl.delegate('.bx-start','click',clickStartBind);slider.controls.autoEl.delegate('.bx-stop','click',clickStopBind);if(slider.settings.autoControlsCombine){slider.controls.autoEl.append(slider.controls.start);}else{slider.controls.autoEl.append(slider.controls.start).append(slider.controls.stop);}if(slider.settings.autoControlsSelector){$(slider.settings.autoControlsSelector).html(slider.controls.autoEl);}else{slider.controls.el.addClass('bx-has-controls-auto').append(slider.controls.autoEl);}updateAutoControls(slider.settings.autoStart?'stop':'start');};var appendCaptions=function(){slider.children.each(function(index){var title=$(this).find('img:first').attr('title');if(title!=undefined&&(''+title).length){$(this).append('<div class="bx-caption"><span>'+title+'</span></div>');}});};var clickNextBind=function(e){if(slider.settings.auto)el.stopAuto();el.goToNextSlide();e.preventDefault();};var clickPrevBind=function(e){if(slider.settings.auto)el.stopAuto();el.goToPrevSlide();e.preventDefault();};var clickStartBind=function(e){el.startAuto();e.preventDefault();};var clickStopBind=function(e){el.stopAuto();e.preventDefault();};var clickPagerBind=function(e){if(slider.settings.auto)el.stopAuto();var pagerLink=$(e.currentTarget);var pagerIndex=parseInt(pagerLink.attr('data-slide-index'));if(pagerIndex!=slider.active.index)el.goToSlide(pagerIndex);e.preventDefault();};var updatePagerActive=function(slideIndex){var len=slider.children.length;if(slider.settings.pagerType=='short'){if(slider.settings.maxSlides>1){len=Math.ceil(slider.children.length/slider.settings.maxSlides);}slider.pagerEl.html((slideIndex+1)+slider.settings.pagerShortSeparator+len);return;}slider.pagerEl.find('a').removeClass('active');slider.pagerEl.each(function(i,el){$(el).find('a').eq(slideIndex).addClass('active');});};var updateAfterSlideTransition=function(){if(slider.settings.infiniteLoop){var position='';if(slider.active.index==0){position=slider.children.eq(0).position();}else if(slider.active.index==getPagerQty()-1&&slider.carousel){position=slider.children.eq((getPagerQty()-1)*getMoveBy()).position();}else if(slider.active.index==slider.children.length-1){position=slider.children.eq(slider.children.length-1).position();}if(slider.settings.mode=='horizontal'){setPositionProperty(-position.left,'reset',0);;}else if(slider.settings.mode=='vertical'){setPositionProperty(-position.top,'reset',0);;}}slider.working=false;slider.settings.onSlideAfter(slider.children.eq(slider.active.index),slider.oldIndex,slider.active.index);};var updateAutoControls=function(state){if(slider.settings.autoControlsCombine){slider.controls.autoEl.html(slider.controls[state]);}else{slider.controls.autoEl.find('a').removeClass('active');slider.controls.autoEl.find('a:not(.bx-'+state+')').addClass('active');}};var updateDirectionControls=function(){if(getPagerQty()==1){slider.controls.prev.addClass('disabled');slider.controls.next.addClass('disabled');}else if(!slider.settings.infiniteLoop&&slider.settings.hideControlOnEnd){if(slider.active.index==0){slider.controls.prev.addClass('disabled');slider.controls.next.removeClass('disabled');}else if(slider.active.index==getPagerQty()-1){slider.controls.next.addClass('disabled');slider.controls.prev.removeClass('disabled');}else{slider.controls.prev.removeClass('disabled');slider.controls.next.removeClass('disabled');}}};var initAuto=function(){if(slider.settings.autoDelay>0){var timeout=setTimeout(el.startAuto,slider.settings.autoDelay);}else{el.startAuto();}if(slider.settings.autoHover){el.hover(function(){if(slider.interval){el.stopAuto(true);slider.autoPaused=true;}},function(){if(slider.autoPaused){el.startAuto(true);slider.autoPaused=null;}});}};var initTicker=function(){var startPosition=0;if(slider.settings.autoDirection=='next'){el.append(slider.children.clone().addClass('bx-clone'));}else{el.prepend(slider.children.clone().addClass('bx-clone'));var position=slider.children.first().position();startPosition=slider.settings.mode=='horizontal'?-position.left:-position.top;}setPositionProperty(startPosition,'reset',0);slider.settings.pager=false;slider.settings.controls=false;slider.settings.autoControls=false;if(slider.settings.tickerHover&&!slider.usingCSS){slider.viewport.hover(function(){el.stop();},function(){var totalDimens=0;slider.children.each(function(index){totalDimens+=slider.settings.mode=='horizontal'?$(this).outerWidth(true):$(this).outerHeight(true);});var ratio=slider.settings.speed/totalDimens;var property=slider.settings.mode=='horizontal'?'left':'top';var newSpeed=ratio*(totalDimens-(Math.abs(parseInt(el.css(property)))));tickerLoop(newSpeed);});}tickerLoop();};var tickerLoop=function(resumeSpeed){speed=resumeSpeed?resumeSpeed:slider.settings.speed;var position={left:0,top:0};var reset={left:0,top:0};if(slider.settings.autoDirection=='next'){position=el.find('.bx-clone').first().position();}else{reset=slider.children.first().position();}var animateProperty=slider.settings.mode=='horizontal'?-position.left:-position.top;var resetValue=slider.settings.mode=='horizontal'?-reset.left:-reset.top;var params={resetValue:resetValue};setPositionProperty(animateProperty,'ticker',speed,params);};var initTouch=function(){slider.touch={start:{x:0,y:0},end:{x:0,y:0}};slider.viewport.bind('touchstart',onTouchStart);};var onTouchStart=function(e){if(slider.working){e.preventDefault();}else{slider.touch.originalPos=el.position();var orig=e.originalEvent;slider.touch.start.x=orig.changedTouches[0].pageX;slider.touch.start.y=orig.changedTouches[0].pageY;slider.viewport.bind('touchmove',onTouchMove);slider.viewport.bind('touchend',onTouchEnd);}};var onTouchMove=function(e){var orig=e.originalEvent;var xMovement=Math.abs(orig.changedTouches[0].pageX-slider.touch.start.x);var yMovement=Math.abs(orig.changedTouches[0].pageY-slider.touch.start.y);if((xMovement*3)>yMovement&&slider.settings.preventDefaultSwipeX){e.preventDefault();}else if((yMovement*3)>xMovement&&slider.settings.preventDefaultSwipeY){e.preventDefault();}if(slider.settings.mode!='fade'&&slider.settings.oneToOneTouch){var value=0;if(slider.settings.mode=='horizontal'){var change=orig.changedTouches[0].pageX-slider.touch.start.x;value=slider.touch.originalPos.left+change;}else{var change=orig.changedTouches[0].pageY-slider.touch.start.y;value=slider.touch.originalPos.top+change;}setPositionProperty(value,'reset',0);}};var onTouchEnd=function(e){slider.viewport.unbind('touchmove',onTouchMove);var orig=e.originalEvent;var value=0;slider.touch.end.x=orig.changedTouches[0].pageX;slider.touch.end.y=orig.changedTouches[0].pageY;if(slider.settings.mode=='fade'){var distance=Math.abs(slider.touch.start.x-slider.touch.end.x);if(distance>=slider.settings.swipeThreshold){slider.touch.start.x>slider.touch.end.x?el.goToNextSlide():el.goToPrevSlide();el.stopAuto();}}else{var distance=0;if(slider.settings.mode=='horizontal'){distance=slider.touch.end.x-slider.touch.start.x;value=slider.touch.originalPos.left;}else{distance=slider.touch.end.y-slider.touch.start.y;value=slider.touch.originalPos.top;}if(!slider.settings.infiniteLoop&&((slider.active.index==0&&distance>0)||(slider.active.last&&distance<0))){setPositionProperty(value,'reset',200);}else{if(Math.abs(distance)>=slider.settings.swipeThreshold){distance<0?el.goToNextSlide():el.goToPrevSlide();el.stopAuto();}else{setPositionProperty(value,'reset',200);}}}slider.viewport.unbind('touchend',onTouchEnd);};var resizeWindow=function(e){var windowWidthNew=$(window).width();var windowHeightNew=$(window).height();if(windowWidth!=windowWidthNew||windowHeight!=windowHeightNew){windowWidth=windowWidthNew;windowHeight=windowHeightNew;el.redrawSlider();}};el.goToSlide=function(slideIndex,direction){if(slider.working||slider.active.index==slideIndex)return;slider.working=true;slider.oldIndex=slider.active.index;if(slideIndex<0){slider.active.index=getPagerQty()-1;}else if(slideIndex>=getPagerQty()){slider.active.index=0;}else{slider.active.index=slideIndex;}slider.settings.onSlideBefore(slider.children.eq(slider.active.index),slider.oldIndex,slider.active.index);if(direction=='next'){slider.settings.onSlideNext(slider.children.eq(slider.active.index),slider.oldIndex,slider.active.index);}else if(direction=='prev'){slider.settings.onSlidePrev(slider.children.eq(slider.active.index),slider.oldIndex,slider.active.index);}slider.active.last=slider.active.index>=getPagerQty()-1;if(slider.settings.pager)updatePagerActive(slider.active.index);if(slider.settings.controls)updateDirectionControls();if(slider.settings.mode=='fade'){if(slider.settings.adaptiveHeight&&slider.viewport.height()!=getViewportHeight()){slider.viewport.animate({height:getViewportHeight()},slider.settings.adaptiveHeightSpeed);}slider.children.filter(':visible').fadeOut(slider.settings.speed).css({zIndex:0});slider.children.eq(slider.active.index).css('zIndex',51).fadeIn(slider.settings.speed,function(){$(this).css('zIndex',50);updateAfterSlideTransition();});}else{if(slider.settings.adaptiveHeight&&slider.viewport.height()!=getViewportHeight()){slider.viewport.animate({height:getViewportHeight()},slider.settings.adaptiveHeightSpeed);}var moveBy=0;var position={left:0,top:0};if(!slider.settings.infiniteLoop&&slider.carousel&&slider.active.last){if(slider.settings.mode=='horizontal'){var lastChild=slider.children.eq(slider.children.length-1);position=lastChild.position();moveBy=slider.viewport.width()-lastChild.outerWidth();}else{var lastShowingIndex=slider.children.length-slider.settings.minSlides;position=slider.children.eq(lastShowingIndex).position();}}else if(slider.carousel&&slider.active.last&&direction=='prev'){var eq=slider.settings.moveSlides==1?slider.settings.maxSlides-getMoveBy():((getPagerQty()-1)*getMoveBy())-(slider.children.length-slider.settings.maxSlides);var lastChild=el.children('.bx-clone').eq(eq);position=lastChild.position();}else if(direction=='next'&&slider.active.index==0){position=el.find('> .bx-clone').eq(slider.settings.maxSlides).position();slider.active.last=false;}else if(slideIndex>=0){var requestEl=slideIndex*getMoveBy();position=slider.children.eq(requestEl).position();}if("undefined"!==typeof(position)){var value=slider.settings.mode=='horizontal'?-(position.left-moveBy):-position.top;setPositionProperty(value,'slide',slider.settings.speed);}}};el.goToNextSlide=function(){if(!slider.settings.infiniteLoop&&slider.active.last)return;var pagerIndex=parseInt(slider.active.index)+1;el.goToSlide(pagerIndex,'next');};el.goToPrevSlide=function(){if(!slider.settings.infiniteLoop&&slider.active.index==0)return;var pagerIndex=parseInt(slider.active.index)-1;el.goToSlide(pagerIndex,'prev');};el.startAuto=function(preventControlUpdate){if(slider.interval)return;slider.interval=setInterval(function(){slider.settings.autoDirection=='next'?el.goToNextSlide():el.goToPrevSlide();},slider.settings.pause);if(slider.settings.autoControls&&preventControlUpdate!=true)updateAutoControls('stop');};el.stopAuto=function(preventControlUpdate){if(!slider.interval)return;clearInterval(slider.interval);slider.interval=null;if(slider.settings.autoControls&&preventControlUpdate!=true)updateAutoControls('start');};el.getCurrentSlide=function(){return slider.active.index;};el.getSlideCount=function(){return slider.children.length;};el.redrawSlider=function(){slider.children.add(el.find('.bx-clone')).outerWidth(getSlideWidth());slider.viewport.css('height',getViewportHeight());if(!slider.settings.ticker)setSlidePosition();if(slider.active.last)slider.active.index=getPagerQty()-1;if(slider.active.index>=getPagerQty())slider.active.last=true;if(slider.settings.pager&&!slider.settings.pagerCustom){populatePager();updatePagerActive(slider.active.index);}};el.destroySlider=function(){if(!slider.initialized)return;slider.initialized=false;$('.bx-clone',this).remove();slider.children.each(function(){$(this).data("origStyle")!=undefined?$(this).attr("style",$(this).data("origStyle")):$(this).removeAttr('style');});$(this).data("origStyle")!=undefined?this.attr("style",$(this).data("origStyle")):$(this).removeAttr('style');$(this).unwrap().unwrap();if(slider.controls.el)slider.controls.el.remove();if(slider.controls.next)slider.controls.next.remove();if(slider.controls.prev)slider.controls.prev.remove();if(slider.pagerEl)slider.pagerEl.remove();$('.bx-caption',this).remove();if(slider.controls.autoEl)slider.controls.autoEl.remove();clearInterval(slider.interval);if(slider.settings.responsive)$(window).unbind('resize',resizeWindow);};el.reloadSlider=function(settings){if(settings!=undefined)options=settings;el.destroySlider();init();};init();return this;}})(jQuery);jQuery(function(){jQuery('ul.plugin_slider').bxSlider(JSINFO['plugin_slider']);});var plugin_cellbg_colors={"Yellow":"yellow","Red":"red","Orange":"orange","Salmon":"salmon","Pink":"pink","Plum":"plum","Purple":"purple","Fuchsia":"fuchsia","Silver":"silver","Aqua":"aqua","Teal":"teal","Cornflower":"#6495ed","Sky Blue":"skyblue","Aquamarine":"aquamarine","Pale Green":"palegreen","Lime":"lime","Green":"green","Olive":"olive"};function plugin_cellbg_make_color_button(name,value){var btn=document.createElement('button');btn.className='pickerbutton';btn.value='';btn.title=name;btn.style.height='2em';btn.style.padding='1em';btn.style.backgroundColor=value;var open="@"+value+":";eval("btn.onclick = function(){ insertAtCarret( '"+jsEscape('wiki__text')+"','"+jsEscape(open)+"','"+"'); return false; } ");return(btn);}function plugin_cellbg_toolbar_picker(){if(!document.getElementById('spell__action'))return;var toolbar=document.getElementById('tool__bar');if(!toolbar)return;var p_id='picker_plugin_cellbg';var p_ico=document.createElement('img');p_ico.src=DOKU_BASE+'lib/plugins/cellbg/images/cellbg.png';var p_btn=document.createElement('button');p_btn.className='toolbutton';p_btn.title='Cell background';p_btn.appendChild(p_ico);eval("p_btn.onclick = function() { showPicker('"+p_id+"',this); return false; }");var picker=document.createElement('div');picker.className='picker';picker.id=p_id;picker.style.position='absolute';picker.style.display='none';for(var color in plugin_cellbg_colors){var btn=plugin_cellbg_make_color_button(color,plugin_cellbg_colors[color]);picker.appendChild(btn);}if(typeof user_cellbg_colors!='undefined'){for(var color in user_cellbg_colors){var btn=plugin_cellbg_make_color_button(color,user_cellbg_colors[color]);picker.appendChild(btn);}}var body=document.getElementsByTagName('body')[0];body.appendChild(picker);toolbar.appendChild(p_btn);}jQuery(plugin_cellbg_toolbar_picker);jQuery(function(){jQuery('.btn_incledit').mouseover(function(){jQuery(this).closest('.plugin_include_content').addClass('section_highlight');}).mouseout(function(){jQuery('.section_highlight').removeClass('section_highlight');});});var dw_acl={init:function(){var $tree;if(jQuery('#acl_manager').length===0){return;}jQuery('#acl__user select').change(dw_acl.userselhandler);jQuery('#acl__user button').click(dw_acl.loadinfo);$tree=jQuery('#acl__tree');$tree.dw_tree({toggle_selector:'img',load_data:function(show_sublist,$clicky){var $frm=jQuery('#acl__detail form');jQuery.post(DOKU_BASE+'lib/exe/ajax.php',jQuery.extend(dw_acl.parseatt($clicky.parent().find('a')[0].search),{call:'plugin_acl',ajax:'tree',current_ns:$frm.find('input[name=ns]').val(),current_id:$frm.find('input[name=id]').val()}),show_sublist,'html');},toggle_display:function($clicky,opening){$clicky.attr('src',DOKU_BASE+'lib/images/'+(opening?'minus':'plus')+'.gif');}});$tree.delegate('a','click',dw_acl.treehandler);},userselhandler:function(){jQuery('#acl__user input').toggle(this.value==='__g__'||this.value==='__u__');dw_acl.loadinfo();},loadinfo:function(){jQuery('#acl__info').attr('role','alert').html('<img src="'+DOKU_BASE+'lib/images/throbber.gif" alt="..." />').load(DOKU_BASE+'lib/exe/ajax.php',jQuery('#acl__detail form').serialize()+'&call=plugin_acl&ajax=info');return false;},parseatt:function(str){if(str[0]==='?'){str=str.substr(1);}var attributes={};var all=str.split('&');for(var i=0;i<all.length;i++){var att=all[i].split('=');attributes[att[0]]=decodeURIComponent(att[1]);}return attributes;},treehandler:function(){var $link,$frm;$link=jQuery(this);jQuery('#acl__tree a.cur').removeClass('cur');$link.addClass('cur');$frm=jQuery('#acl__detail form');if($link.hasClass('wikilink1')){$frm.find('input[name=ns]').val('');$frm.find('input[name=id]').val(dw_acl.parseatt($link[0].search).id);}else if($link.hasClass('idx_dir')){$frm.find('input[name=ns]').val(dw_acl.parseatt($link[0].search).ns);$frm.find('input[name=id]').val('');}dw_acl.loadinfo();return false;}};jQuery(dw_acl.init);if(window.toolbar!==undefined){toolbar[toolbar.length]={"type":"format","title":"Adds an ImageCaption tag","icon":"../../plugins/imagereference/button.png","key":"","open":"<imgcaption image1|>","close":"</imgcaption>"};toolbar[toolbar.length]={"type":"format","title":"Adds an ImageReference tag","icon":"../../plugins/imagereference/refbutton.png","key":"","open":"<imgref ","sample":"image1","close":">"};}function checkImages(){jQuery('span.imgcaption').each(function(){var $imgcaption=jQuery(this);var $amedia=$imgcaption.find('a.media');var $img=$imgcaption.find('img');if($amedia[0]){var link=$amedia.attr('href');$imgcaption.find('span.undercaption a').last().attr('href',link).children().show();}var captionparts=$imgcaption.find('span.undercaption').text().split(':',2);if(!jQuery.trim(captionparts[1])){var title=$img.attr('title');if(title){$imgcaption.find('span.undercaption a').first().before(': '+title);}}if(!($imgcaption.hasClass('left')||$imgcaption.hasClass('right')||$imgcaption.hasClass('center'))){if($img.hasClass('medialeft')){$imgcaption.addClass('left');}else if($img.hasClass('mediaright')){$imgcaption.addClass('right');}else if($img.hasClass('mediacenter')){$imgcaption.addClass('center');}}if($imgcaption.hasClass('center')){$imgcaption.wrap('<span class="imgcaption_centerwrapper"></span>');}});}jQuery(function(){checkImages();});jQuery(window).load(function(){jQuery('span.imgcaption').each(function(){var $imgcaption=jQuery(this);var width=$imgcaption.find('img').width();$imgcaption.width((width+8)+"px");});jQuery('div.tabcaption').each(function(){var $imgcaption=jQuery(this);if($imgcaption.hasClass('center')){$imgcaption.wrap('<span class="imgcaption_centerwrapper"></span>');}})});jQuery(function(){if(!JSINFO||!JSINFO['plugin_folded'])return;var folded_reveal=JSINFO['plugin_folded']['reveal'];var folded_hide=JSINFO['plugin_folded']['hide'];jQuery('a.folder[href*="#folded_"]').attr('title',folded_reveal);jQuery('.dokuwiki .folder').click(function folded_toggle(evt){var id=this.href.match(/#(.*)$/)[1];var $id=jQuery(document.getElementById(id));if($id.hasClass('hidden')){$id.addClass('open').removeClass('hidden');jQuery(this).addClass('open').attr('title',folded_hide);}else{$id.addClass('hidden').removeClass('open');jQuery(this).removeClass('open').attr('title',folded_reveal);}evt.preventDefault();return false;});});function fold_unfold_all(){var i;var hide=-1;var cpt=1;var elements;elements=document.getElementsByClassName("folder");for(i=0;i<elements.length;i++){if(hide==-1){if(elements[i].className.search("open")==-1){hide=0;}else{hide=1;}}if(hide==1){elements[i].className=elements[i].className.replace(/open/g,"");}else{elements[i].className=elements[i].className+" open";}}elements=document.getElementsByClassName("folded");for(i=0;i<elements.length;i++){if(hide==1){elements[i].className=elements[i].className.replace(/open/g,"");elements[i].className=elements[i].className+" hidden";}else{elements[i].className=elements[i].className.replace(/hidden/g,"");elements[i].className=elements[i].className+" open";}}}document.write('<style type="text/css" media="screen"><!--/*--><![CDATA[/*><!--*/ .folded.hidden { display: none; } .folder .indicator { visibility: visible; } /*]]>*/--></style>');(function(){var floater=null;var tracking=false;var timer=null;function createFloater(){return jQuery('<div id="insitu__fn" />').addClass('insitu-footnote JSpopup').css({visibility:'hidden',left:'0px',top:'0px'}).mouseleave(function(){jQuery(this).hide();}).appendTo('.dokuwiki:first');}function getFloater(){if(!floater){floater=jQuery('#insitu__fn');if(floater.length==0){floater=createFloater();}}return floater;}var preview={setNoteId:function(id){var note=jQuery('#'+id.replace(/:/g,'\\:')+'\\:text');if(note.length==0){return false;}getFloater().html(note.html().replace(/\bid\s*=\s*".*?"/gi,'')).css('visibility','hidden').show();return true;},show:function(){getFloater().css('visibility','visible').show();},hide:function(){if(floater&&floater.is(':visible')){floater.hide();}},move:function(event,dx,dy){getFloater().position({my:'left top',of:event,offset:dx+' '+dy,collision:'flip'});}};function getNoteId(event){return event.target.href.replace(/^.*?#([\w:]+)$/gi,'$1');}plugin_refnotes={popup:{show:function(event){plugin_refnotes.tooltip.hide(event);if(preview.setNoteId(getNoteId(event))){preview.move(event,2,2);preview.show();}}},tooltip:{show:function(event){plugin_refnotes.tooltip.hide(event);if(preview.setNoteId(getNoteId(event))){timer=setTimeout(function(){preview.show();},500);tracking=true;}},hide:function(event){if(tracking){clearTimeout(timer);tracking=false;}preview.hide();},track:function(event){if(tracking){preview.move(event,10,12);}}}};})();jQuery(function(){jQuery('a.refnotes-ref.note-popup').mouseenter(plugin_refnotes.popup.show);jQuery('a.refnotes-ref.note-tooltip').mouseenter(plugin_refnotes.tooltip.show).mouseleave(plugin_refnotes.tooltip.hide);jQuery(document).mousemove(plugin_refnotes.tooltip.track);jQuery(window).scroll(plugin_refnotes.tooltip.hide);});jQuery(function(){dw_locktimer.init(840,1);});
